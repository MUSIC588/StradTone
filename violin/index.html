<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>StradTone Violin</title>

  <!-- 外部樣式表 -->
  <link rel="stylesheet" href="violin.css?v=20251215a" />
</head>

<body>
  <!-- 頁首錨點 -->
  <div id="page-top"></div>

  <div class="page">
    <header id="site-header">
      <h1>StradTone Violin</h1>
      <h2>提琴聲學實驗室</h2>
    </header>

    <main class="layout">
      <!-- 左：留言 / 發表 -->
      <section class="panel panel-left" id="comments-section">
        <p class="hint">小提琴</p>

        <div class="toolbar">
          <button type="button" id="btn-new">新增</button>
        </div>

        <form id="community-form" class="hidden">
          <label>
            username（5–12 字必填,修改編輯用）：
            <input type="text" id="nickname-input" maxlength="12" />
          </label>

          <label>
            項目（100 字內）：
            <input type="text" id="text-input" maxlength="100" />
          </label>

          <!-- 媒體選擇 -->
          <div class="form-row-inline media-select-row">
            <button type="button" class="media-select-btn" id="btn-media-youtube">YouTube</button>
            <button type="button" class="media-select-btn" id="btn-media-upload">影片</button>
            <button type="button" class="media-select-btn" id="btn-media-audio">錄音</button>
          </div>

          <!-- 影片欄位 -->
          <div id="video-fields" class="hidden">
            <div class="form-row-inline" id="youtube-row">
              <input type="text" id="youtube-url-input" placeholder="https://youtu.be/..." />
              <input type="text" id="start-input" placeholder="開始 mm:ss" />
              <input type="text" id="end-input" placeholder="結束 mm:ss" />
            </div>

            <div class="form-row-inline" id="video-upload-row">
              <input type="file" id="video-file-input" />
              <span id="video-file-label" class="sub-hint"></span>
            </div>

            <div class="form-row-inline" id="video-link-row">
              <input type="text" id="video-link-input" placeholder="https://... 影片或網頁網址" />
            </div>
          </div>

          <!-- 錄音欄位 -->
          <div id="audio-fields" class="hidden">
            <div class="media-record-toolbar">
              <button type="button" id="audio-rec-start">●</button>
              <button type="button" id="audio-rec-pause" disabled>⏸</button>
              <button type="button" id="audio-rec-stop" disabled>■</button>
              <button type="button" id="audio-rec-cancel" disabled>✕</button>
              <span id="audio-rec-status">錄音預備</span>
            </div>

            <div class="form-row-inline">
              <input type="file" id="audio-file-input" accept="audio/*" />
              <span id="audio-file-label" class="sub-hint"></span>
            </div>

            <div class="form-row-inline">
              <audio id="audio-rec-preview" controls></audio>
            </div>
          </div>

          <div class="form-row-inline">
            <button type="submit" id="submit-btn">發表</button>
          </div>
        </form>

        <div class="comments-wrapper">
          <table id="comments-table">
            <thead>
              <tr>
                <th class="col-nick">username</th>
                <th class="col-text">
                  項目
                  <button type="button" id="btn-edit" class="edit-header-btn">編輯</button>
                </th>
                <th class="col-media">錄音 / 影片</th>
              </tr>
            </thead>
            <tbody id="comments-tbody"></tbody>
          </table>
        </div>

        <button id="back-button" type="button">Back</button>
      </section>

      <!-- 右：視覺區 -->
      <section class="panel panel-right" id="visual-panel">
        <div class="visual-wrapper">
          <div class="visual-body">

            <div class="top-row">
              <!-- 🎯 影片框（含遮罩） -->
              <div class="video-frame-wrap">
                <!-- 第一擊遮罩：用來確保 iframe 播放能停輪播 -->
                <div id="media-tap-guard" class="media-tap-guard"></div>

                <iframe
                  id="video-iframe"
                  src=""
                  tabindex="0"
                  allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                  allowfullscreen
                ></iframe>

                <audio id="audio-player" controls></audio>

                <div class="video-placeholder" id="video-placeholder">
                  請從左側表格選取一筆帶有影片或錄音的項目
                </div>
              </div>

              <!-- 多層圓 -->
              <div class="circle-area">
                <div class="circle-stack" id="circle-stack">
                  <div class="ring ring-main ring-1" data-layer="1"></div>
                  <div class="ring ring-main ring-2" data-layer="2"></div>
                  <div class="ring ring-main ring-3" data-layer="3"></div>
                  <div class="ring ring-main ring-4" data-layer="4"></div>
                  <div class="ring ring-boundary ring-b15" data-layer="1.5"></div>
                  <div class="ring ring-boundary ring-b25" data-layer="2.5"></div>
                  <div class="ring ring-boundary ring-b35" data-layer="3.5"></div>
                  <div class="ring ring-b45" data-layer="4.5"></div>
                </div>
              </div>
            </div>

            <!-- 回覆區 -->
            <div class="bottom-row">
              <div class="reply-area">
                <button type="button" id="reply-target-btn" disabled>From: —</button>
                <textarea id="admin-reply"></textarea>

                <div id="reply-actions" class="hidden">
                  <button type="button" id="reply-save-btn">儲存</button>
                  <button type="button" id="reply-cancel-btn">取消</button>
                </div>
              </div>
            </div>

          </div>
        </div>
      </section>
    </main>

    <footer id="site-footer">
      © StradTone Violin
    </footer>
  </div>

  <!-- JS -->
  <script src="violin.js?v=20251215a"></script>
</body>
</html>
