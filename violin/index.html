<!DOCTYPE html>
<html lang="zh-Hant">
<head>
Â Â <meta charset="UTF-8" />
Â Â <meta name="viewport" content="width=device-width, initial-scale=1.0" />
Â Â <title>StradTone Violin</title>

Â Â <style>
Â Â Â Â * { box-sizing: border-box; }

Â Â Â Â body {
Â Â Â Â Â Â margin: 0;
Â Â Â Â Â Â font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Arial, "Microsoft JhengHei", sans-serif;
Â Â Â Â Â Â background: #222629;
Â Â Â Â Â Â color: #f5f5f5;
Â Â Â Â }

Â Â Â Â /* æ•´å€‹é é¢çš„å®¹å™¨ï¼šæ¡Œæ©Ÿç½®ä¸­ã€å›ºå®šå¯¬åº¦ï¼Œé¿å…ç¸®æ”¾æ™‚æ•´å¡Šäº‚é£„ */
Â Â Â Â .page {
Â Â Â Â Â Â min-height: 100vh;
Â Â Â Â Â Â padding: 12px;
Â Â Â Â Â Â max-width: 1100px;
Â Â Â Â Â Â margin: 0 auto;
Â Â Â Â }

Â Â Â Â header {
Â Â Â Â Â Â margin-bottom: 10px;
Â Â Â Â Â Â display: flex;
Â Â Â Â Â Â justify-content: space-between;
Â Â Â Â Â Â align-items: baseline;
Â Â Â Â Â Â gap: 8px;
Â Â Â Â Â Â flex-wrap: wrap;
Â Â Â Â }

Â Â Â Â header h1 { font-size: 20px; margin: 0; }
Â Â Â Â header h2 { font-size: 14px; margin: 0; opacity: 0.8; }
Â Â Â Â header small { font-size: 12px; opacity: 0.7; }

Â Â Â Â main.layout {
Â Â Â Â Â Â display: flex;
Â Â Â Â Â Â gap: 12px;
Â Â Â Â Â Â align-items: stretch;
Â Â Â Â }

Â Â Â Â .panel {
Â Â Â Â Â Â background: #2d3236;
Â Â Â Â Â Â border-radius: 8px;
Â Â Â Â Â Â padding: 10px;
Â Â Â Â Â Â box-shadow: 0 0 8px rgba(0, 0, 0, 0.35);
Â Â Â Â Â Â min-height: 220px;
Â Â Â Â }

Â Â Â Â /* å·¦ 40%ã€å³ 60%ï¼ˆæ¡Œæ©Ÿï¼‰ */
Â Â Â Â .panel-leftÂ  { flex: 0 0 40%; max-width: 40%; display: flex; flex-direction: column; }
Â Â Â Â .panel-right { flex: 0 0 60%; max-width: 60%; display: flex; flex-direction: column; }

Â Â Â Â h2 { font-size: 16px; margin: 0 0 4px; }

Â Â Â Â /* ã€Œçµ¦ç«™ä¸»çœ‹çš„èªªæ˜ã€æ–‡å­— â†’ æ”¹æˆè·ŸèƒŒæ™¯ä¸€æ¨£è‰²ï¼Œç­‰æ–¼éš±è— */
Â Â Â Â .hint,
Â Â Â Â .reply-note {
Â Â Â Â Â Â font-size: 12px;
Â Â Â Â Â Â line-height: 1.4;
Â Â Â Â Â Â color: #222629;Â  /* å’Œ body èƒŒæ™¯ä¸€æ¨£ */
Â Â Â Â }

Â Â Â Â .hidden { display: none !important; }

Â Â Â Â /* placeholder é¡è‰²å†æ·¡ä¸€é» */
Â Â Â Â input::placeholder,
Â Â Â Â textarea::placeholder {
Â Â Â Â Â Â color: #999;
Â Â Â Â Â Â opacity: 0.7;
Â Â Â Â }
Â Â Â Â input::-webkit-input-placeholder,
Â Â Â Â textarea::-webkit-input-placeholder {
Â Â Â Â Â Â color: #999;
Â Â Â Â Â Â opacity: 0.7;
Â Â Â Â }

Â Â Â Â /* =====================================================
Â Â Â Â Â * [CSS-1] å·¦å´ï¼šå·¥å…·åˆ— + è¡¨å–®
Â Â Â Â Â * ===================================================== */

Â Â Â Â .toolbar {
Â Â Â Â Â Â display: flex;
Â Â Â Â Â Â gap: 6px;
Â Â Â Â Â Â margin-bottom: 6px;
Â Â Â Â Â Â flex-wrap: wrap;
Â Â Â Â }

Â Â Â Â .toolbar button {
Â Â Â Â Â Â padding: 4px 10px;
Â Â Â Â Â Â border-radius: 14px;
Â Â Â Â Â Â border: 1px solid #777;
Â Â Â Â Â Â background: #3a3f44;
Â Â Â Â Â Â color: #f5f5f5;
Â Â Â Â Â Â font-size: 12px;
Â Â Â Â Â Â cursor: pointer;
Â Â Â Â }
Â Â Â Â .toolbar button:hover { background: #4a5056; }

Â Â Â Â form#community-form {
Â Â Â Â Â Â display: flex;
Â Â Â Â Â Â flex-direction: column;
Â Â Â Â Â Â gap: 6px;
Â Â Â Â Â Â margin-bottom: 8px;
Â Â Â Â Â Â padding: 6px 8px;
Â Â Â Â Â Â border-radius: 6px;
Â Â Â Â Â Â border: 1px solid #444;
Â Â Â Â Â Â background: #202427;
Â Â Â Â }
Â Â Â Â form#community-form label {
Â Â Â Â Â Â font-size: 13px;
Â Â Â Â Â Â display: block;
Â Â Â Â }

Â Â Â Â form#community-form input[type="text"] {
Â Â Â Â Â Â width: 100%;
Â Â Â Â Â Â padding: 4px 6px;
Â Â Â Â Â Â margin-top: 2px;
Â Â Â Â Â Â border-radius: 4px;
Â Â Â Â Â Â border: 1px solid #555;
Â Â Â Â Â Â background: #1f2326;
Â Â Â Â Â Â color: #f5f5f5;
Â Â Â Â Â Â font-size: 13px;
Â Â Â Â }

Â Â Â Â /* ç·¨è¼¯ / ç™¼è¡¨æ™‚å¯è¼¸å…¥ â†’ ç™½åº• */
Â Â Â Â form#community-form input[type="text"]:not(:disabled) {
Â Â Â Â Â Â background: #ffffff;
Â Â Â Â Â Â color: #111;
Â Â Â Â }

Â Â Â Â /* é–å®šç‹€æ…‹ï¼ˆç­‰åç¨±é©—è­‰ï¼‰â†’ æ·±åº• */
Â Â Â Â form#community-form input[type="text"]:disabled {
Â Â Â Â Â Â background: #1f2326;
Â Â Â Â Â Â color: #999;
Â Â Â Â }

Â Â Â Â #record-btn {
Â Â Â Â Â Â padding: 4px 10px;
Â Â Â Â Â Â border-radius: 16px;
Â Â Â Â Â Â border: 1px solid #777;
Â Â Â Â Â Â background: #3a3f44;
Â Â Â Â Â Â color: #f5f5f5;
Â Â Â Â Â Â font-size: 12px;
Â Â Â Â Â Â cursor: not-allowed; /* é ç•™éŒ„éŸ³ */
Â Â Â Â Â Â opacity: 0.6;
Â Â Â Â }

Â Â Â Â .form-row-inline {
Â Â Â Â Â Â display: flex;
Â Â Â Â Â Â flex-wrap: wrap;
Â Â Â Â Â Â gap: 6px;
Â Â Â Â Â Â align-items: center;
Â Â Â Â }

Â Â Â Â #video-file-input {
Â Â Â Â Â Â font-size: 11px;
Â Â Â Â }

Â Â Â Â #video-file-label {
Â Â Â Â Â Â font-size: 11px;
Â Â Â Â Â Â opacity: 0.8;
Â Â Â Â }

Â Â Â Â #submit-btn {
Â Â Â Â Â Â padding: 4px 14px;
Â Â Â Â Â Â border-radius: 16px;
Â Â Â Â Â Â border: none;
Â Â Â Â Â Â background: #d1a343;
Â Â Â Â Â Â color: #1d1d1d;
Â Â Â Â Â Â font-size: 13px;
Â Â Â Â Â Â cursor: pointer;
Â Â Â Â }
Â Â Â Â #submit-btn:hover { background: #e0b85f; }

Â Â Â Â .sub-hint {
Â Â Â Â Â Â font-size: 11px;
Â Â Â Â Â Â opacity: 0.8;
Â Â Â Â }

Â Â Â Â /* ä¸‰é¡†åª’é«”é¸æ“‡æŒ‰éˆ• */
Â Â Â Â .media-select-row {
Â Â Â Â Â Â margin: 4px 0 2px;
Â Â Â Â Â Â gap: 6px;
Â Â Â Â }

Â Â Â Â .media-select-btn {
Â Â Â Â Â Â padding: 3px 10px;
Â Â Â Â Â Â border-radius: 14px;
Â Â Â Â Â Â border: 1px solid #777;
Â Â Â Â Â Â background: #3a3f44;
Â Â Â Â Â Â color: #f5f5f5;
Â Â Â Â Â Â font-size: 12px;
Â Â Â Â Â Â cursor: pointer;
Â Â Â Â Â Â opacity: 0.9;
Â Â Â Â }
Â Â Â Â .media-select-btn.active {
Â Â Â Â Â Â border-color: #d1a343;
Â Â Â Â Â Â background: #e0b85f;
Â Â Â Â Â Â color: #1d1d1d;
Â Â Â Â Â Â font-weight: 600;
Â Â Â Â }

Â Â Â Â /* è¡¨å–®å…§ï¼šéŒ„å½±/éŒ„éŸ³æ§åˆ¶åˆ—ï¼ˆç›®å‰åªçµ¦éŒ„éŸ³ç”¨ï¼‰ */
Â Â Â Â .media-record-toolbar {
Â Â Â Â Â Â display: flex;
Â Â Â Â Â Â align-items: center;
Â Â Â Â Â Â gap: 6px;
Â Â Â Â Â Â margin-top: 4px;
Â Â Â Â Â Â font-size: 11px;
Â Â Â Â }
Â Â Â Â .media-record-btn {
Â Â Â Â Â Â width: 26px;
Â Â Â Â Â Â height: 26px;
Â Â Â Â Â Â border-radius: 50%;
Â Â Â Â Â Â border: 1px solid #777;
Â Â Â Â Â Â background: #3a3f44;
Â Â Â Â Â Â color: #f5f5f5;
Â Â Â Â Â Â font-size: 14px;
Â Â Â Â Â Â cursor: pointer;
Â Â Â Â Â Â display: flex;
Â Â Â Â Â Â align-items: center;
Â Â Â Â Â Â justify-content: center;
Â Â Â Â }
Â Â Â Â .media-record-btn[disabled] {
Â Â Â Â Â Â opacity: 0.5;
Â Â Â Â Â Â cursor: default;
Â Â Â Â }
Â Â Â Â .media-record-status {
Â Â Â Â Â Â font-size: 11px;
Â Â Â Â Â Â opacity: 0.8;
Â Â Â Â }

Â Â Â Â /* éŒ„å½± / éŒ„éŸ³é è¦½å€ */
Â Â Â Â .rec-preview {
Â Â Â Â Â Â width: 100%;
Â Â Â Â Â Â max-height: 140px;
Â Â Â Â Â Â border-radius: 4px;
Â Â Â Â Â Â border: 1px solid #444;
Â Â Â Â Â Â background: #111;
Â Â Â Â }

Â Â Â Â /* =====================================================
Â Â Â Â Â * [CSS-2] å·¦å´ï¼šç•™è¨€åˆ—è¡¨è¡¨æ ¼
Â Â Â Â Â * ===================================================== */

Â Â Â Â .comments-wrapper {
Â Â Â Â Â Â flex: 1 1 auto;
Â Â Â Â Â Â overflow: auto;
Â Â Â Â Â Â border-radius: 6px;
Â Â Â Â Â Â border: 1px solid #444;
Â Â Â Â Â Â background: #202427;
Â Â Â Â }
Â Â Â Â table#comments-table {
Â Â Â Â Â Â width: 100%;
Â Â Â Â Â Â border-collapse: collapse;
Â Â Â Â Â Â font-size: 12px;
Â Â Â Â Â Â min-width: 420px;
Â Â Â Â Â Â table-layout: fixed; /* å›ºå®šæ¬„å¯¬ï¼Œé¿å…å±•é–‹å¾€å·¦å³æ“´å…… */
Â Â Â Â }
Â Â Â Â table#comments-table thead {
Â Â Â Â Â Â position: sticky;
Â Â Â Â Â Â top: 0;
Â Â Â Â Â Â background: #33383c;
Â Â Â Â Â Â z-index: 1;
Â Â Â Â }
Â Â Â Â table#comments-table th,
Â Â Â Â table#comments-table td {
Â Â Â Â Â Â border-bottom: 1px solid #333;
Â Â Â Â Â Â padding: 4px 6px;
Â Â Â Â Â Â text-align: left;
Â Â Â Â Â Â vertical-align: top;
Â Â Â Â Â Â word-wrap: break-word;
Â Â Â Â Â Â word-break: break-word;
Â Â Â Â }
Â Â Â Â table#comments-table th {
Â Â Â Â Â Â font-weight: 600;
Â Â Â Â Â Â font-size: 12px;
Â Â Â Â }
Â Â Â Â table#comments-table tbody tr:nth-child(even) {
Â Â Â Â Â Â background: #252a2e;
Â Â Â Â }

Â Â Â Â .col-nickÂ  { width: 80px; white-space: nowrap; }
Â Â Â Â .col-textÂ  { width: 50%; position: relative; }
Â Â Â Â .col-media { width: 90px; }

Â Â Â Â .media-icons {
Â Â Â Â Â Â display: flex;
Â Â Â Â Â Â gap: 4px;
Â Â Â Â Â Â align-items: center;
Â Â Â Â Â Â flex-wrap: wrap;
Â Â Â Â Â Â font-size: 13px;
Â Â Â Â }

Â Â Â Â .media-flag {
Â Â Â Â Â Â font-size: 14px;
Â Â Â Â }

Â Â Â Â .play-video-btn {
Â Â Â Â Â Â padding: 2px 6px;
Â Â Â Â Â Â border-radius: 12px;
Â Â Â Â Â Â border: 1px solid #888;
Â Â Â Â Â Â background: #3a3f44;
Â Â Â Â Â Â color: #f5f5f5;
Â Â Â Â Â Â font-size: 11px;
Â Â Â Â Â Â cursor: pointer;
Â Â Â Â Â Â margin-top: 2px;
Â Â Â Â }

Â Â Â Â /* è¡¨é ­çš„ã€Œç·¨è¼¯ã€å°éˆ• */
Â Â Â Â .edit-header-btn {
Â Â Â Â Â Â margin-left: 6px;
Â Â Â Â Â Â padding: 1px 6px;
Â Â Â Â Â Â border-radius: 10px;
Â Â Â Â Â Â border: 1px solid #666;
Â Â Â Â Â Â background: #2f3438;
Â Â Â Â Â Â color: #d0d0d0;
Â Â Â Â Â Â font-size: 10px;
Â Â Â Â Â Â cursor: pointer;
Â Â Â Â Â Â opacity: 0.8;
Â Â Â Â }
Â Â Â Â .edit-header-btn:hover {
Â Â Â Â Â Â opacity: 1;
Â Â Â Â Â Â background: #4a5056;
Â Â Â Â }

Â Â Â Â .expand-arrow {
Â Â Â Â Â Â font-size: 10px;
Â Â Â Â Â Â opacity: 0.7;
Â Â Â Â Â Â float: right;
Â Â Â Â Â Â margin-left: 4px;
Â Â Â Â Â Â cursor: pointer;
Â Â Â Â }

Â Â Â Â #comments-tbody tr.selected {
Â Â Â Â Â Â background: #4f7a3b !important; /* æ¯”åŸæœ¬å†äº®ä¸€é» */
Â Â Â Â }

Â Â Â Â /* é¸åˆ°çš„åˆ—é–ƒä¸€ä¸‹ï¼ˆçµ¦å›è¦†å€åç¨±æŒ‰éˆ•ç”¨ï¼‰ */
Â Â Â Â .row-flash {
Â Â Â Â Â Â animation: rowFlash 0.8s ease-out;
Â Â Â Â }
Â Â Â Â @keyframes rowFlash {
Â Â Â Â Â Â 0% Â  { background-color: #7fbf4f; }
Â Â Â Â Â Â 100% { background-color: inherit; }
Â Â Â Â }

Â Â Â Â /* å·¦å´ Back æŒ‰éˆ•ï¼ˆç§»åˆ°è¡¨æ ¼åº•ä¸‹ï¼‰ */
Â Â Â Â #back-button {
Â Â Â Â Â Â margin-top: 6px;
Â Â Â Â Â Â align-self: flex-start;
Â Â Â Â Â Â padding: 4px 10px;
Â Â Â Â Â Â border-radius: 14px;
Â Â Â Â Â Â border: 1px solid #777;
Â Â Â Â Â Â background: #3a3f44;
Â Â Â Â Â Â color: #f5f5f5;
Â Â Â Â Â Â font-size: 12px;
Â Â Â Â Â Â cursor: pointer;
Â Â Â Â }

Â Â Â Â /* =====================================================
Â Â Â Â Â * [CSS-3] å³å´ï¼šè¦–è¦ºå€æ¡†æ¶
Â Â Â Â Â * ===================================================== */

Â Â Â Â .visual-wrapper {
Â Â Â Â Â Â display: flex;
Â Â Â Â Â Â flex-direction: column;
Â Â Â Â Â Â gap: 8px;
Â Â Â Â Â Â height: 100%;
Â Â Â Â }
Â Â Â Â .visual-header {
Â Â Â Â Â Â font-size: 13px;
Â Â Â Â Â Â display: flex;
Â Â Â Â Â Â justify-content: space-between;
Â Â Â Â Â Â align-items: center;
Â Â Â Â Â Â gap: 8px;
Â Â Â Â }
Â Â Â Â .current-point { font-size: 12px; opacity: 0.9; }

Â Â Â Â /* å³ä¸Šè§’ã€Œå°šæœªé¸å–ç•™è¨€ / æ’­æ”¾ä¸­â€¦ã€æš«æ™‚ä¸é¡¯ç¤º */
Â Â Â Â .current-point {
Â Â Â Â Â Â display: none;
Â Â Â Â }

Â Â Â Â .visual-body {
Â Â Â Â Â Â flex: 1 1 auto;
Â Â Â Â Â Â display: flex;
Â Â Â Â Â Â flex-direction: column;
Â Â Â Â Â Â gap: 8px;
Â Â Â Â Â Â min-height: 260px;
Â Â Â Â }

Â Â Â Â .top-row {
Â Â Â Â Â Â display: flex;
Â Â Â Â Â Â gap: 8px;
Â Â Â Â Â Â min-height: 170px;
Â Â Â Â }

Â Â Â Â /* å·¦ï¼šå½±ç‰‡ï¼éŒ„éŸ³æ ¼å­ */
Â Â Â Â .video-frame-wrap {
Â Â Â Â Â Â flex: 1 1 60%;
Â Â Â Â Â Â background: #111315;
Â Â Â Â Â Â border-radius: 6px;
Â Â Â Â Â Â overflow: hidden;
Â Â Â Â Â Â border: 1px solid #555;
Â Â Â Â Â Â position: relative;
Â Â Â Â Â Â min-height: 150px;
Â Â Â Â }
Â Â Â Â .video-frame-wrap iframe {
Â Â Â Â Â Â width: 100%;
Â Â Â Â Â Â height: 100%;
Â Â Â Â Â Â border: none;
Â Â Â Â }
Â Â Â Â .video-placeholder {
Â Â Â Â Â Â position: absolute;
Â Â Â Â Â Â inset: 0;
Â Â Â Â Â Â display: flex;
Â Â Â Â Â Â align-items: center;
Â Â Â Â Â Â justify-content: center;
Â Â Â Â Â Â font-size: 12px;
Â Â Â Â Â Â color: #999;
Â Â Â Â Â Â text-align: center;
Â Â Â Â Â Â padding: 8px;
Â Â Â Â }

Â Â Â Â /* =====================================================
Â Â Â Â Â * [CSS-4] å³å´ï¼šå¤šå±¤åœ“
Â Â Â Â Â * ===================================================== */

Â Â Â Â .circle-area {
Â Â Â Â Â Â flex: 1 1 40%;
Â Â Â Â Â Â display: flex;
Â Â Â Â Â Â justify-content: center;
Â Â Â Â Â Â align-items: center;
Â Â Â Â }

Â Â Â Â .circle-stack {
Â Â Â Â Â Â position: relative;
Â Â Â Â Â Â width: 160px;
Â Â Â Â Â Â height: 160px;
Â Â Â Â Â Â border-radius: 50%;
Â Â Â Â Â Â --ring-main-color: #5c7a5c;
Â Â Â Â Â Â --ring-boundary-color: #9ad09a;
Â Â Â Â Â Â --ring-highlight-color: #70ff70;
Â Â Â Â Â Â --ring-outer-fog: rgba(112, 255, 112, 0.35);
Â Â Â Â Â Â background: radial-gradient(circle at 20% 20%, #555, #111);
Â Â Â Â }

Â Â Â Â .ring {
Â Â Â Â Â Â position: absolute;
Â Â Â Â Â Â border-radius: 50%;
Â Â Â Â Â Â transition: border-color 0.12s ease, box-shadow 0.12s ease, opacity 0.12s ease;
Â Â Â Â }

Â Â Â Â .ring-main {
Â Â Â Â Â Â border: 3px solid var(--ring-main-color);
Â Â Â Â Â Â opacity: 0.8;
Â Â Â Â }
Â Â Â Â .ring-boundary {
Â Â Â Â Â Â border: 1.2px solid var(--ring-boundary-color);
Â Â Â Â Â Â opacity: 0.7;
Â Â Â Â }
Â Â Â Â .ring-b45 {
Â Â Â Â Â Â border: 1px solid transparent;
Â Â Â Â Â Â box-shadow: 0 0 16px var(--ring-outer-fog);
Â Â Â Â Â Â opacity: 0.9;
Â Â Â Â }

Â Â Â Â .ring-b45 { inset: 4%;Â  } /* 4.5 */
Â Â Â Â .ring-4 Â  { inset: 10%; } /* 4 Â  */
Â Â Â Â .ring-b35 { inset: 20%; } /* 3.5 */
Â Â Â Â .ring-3 Â  { inset: 26%; } /* 3 Â  */
Â Â Â Â .ring-b25 { inset: 36%; } /* 2.5 */
Â Â Â Â .ring-2 Â  { inset: 42%; } /* 2 Â  */
Â Â Â Â .ring-b15 { inset: 52%; } /* 1.5 */
Â Â Â Â .ring-1 Â  { inset: 60%; } /* 1 Â  */

Â Â Â Â .ring.active {
Â Â Â Â Â Â border-color: var(--ring-highlight-color);
Â Â Â Â Â Â opacity: 1;
Â Â Â Â Â Â box-shadow: 0 0 10px rgba(140, 255, 140, 0.9);
Â Â Â Â }

Â Â Â Â .layer-label {
Â Â Â Â Â Â position: absolute;
Â Â Â Â Â Â bottom: 6px;
Â Â Â Â Â Â right: 8px;
Â Â Â Â Â Â font-size: 11px;
Â Â Â Â Â Â color: #cfe9cf;
Â Â Â Â Â Â text-shadow: 0 0 3px #000;
Â Â Â Â }

Â Â Â Â /* æš«æ™‚éš±è—å±¤ç´šæ–‡å­— */
Â Â Â Â .layer-label {
Â Â Â Â Â Â display: none;
Â Â Â Â }

Â Â Â Â /* =====================================================
Â Â Â Â Â * [CSS-5] å³å´ä¸‹åŠï¼šå›è¦†å€ + æŒ‡æ¿
Â Â Â Â Â * ===================================================== */

Â Â Â Â .bottom-row {
Â Â Â Â Â Â display: flex;
Â Â Â Â Â Â gap: 8px;
Â Â Â Â Â Â align-items: stretch;
Â Â Â Â }

Â Â Â Â /* å›è¦†å€å¯¬åº¦æ”¹æˆå’Œå½±ç‰‡åŒæ¨£æ¯”ä¾‹ï¼ˆç´„ 6:4ï¼‰ */
Â Â Â Â .reply-area {
Â Â Â Â Â Â flex: 1 1 60%;
Â Â Â Â }

Â Â Â Â .reply-area-header {
Â Â Â Â Â Â font-size: 13px;
Â Â Â Â Â Â margin: 0 0 4px;
Â Â Â Â }

Â Â Â Â .reply-target {
Â Â Â Â Â Â font-size: 12px;
Â Â Â Â Â Â margin-bottom: 4px;
Â Â Â Â Â Â opacity: 0.85;
Â Â Â Â }

Â Â Â Â .reply-target-btn {
Â Â Â Â Â Â padding: 3px 10px;
Â Â Â Â Â Â border-radius: 14px;
Â Â Â Â Â Â border: 1px solid #bbb;
Â Â Â Â Â Â background: #f5f5f5;
Â Â Â Â Â Â color: #222629;
Â Â Â Â Â Â font-size: 12px;
Â Â Â Â Â Â cursor: pointer;
Â Â Â Â Â Â transition: background-color 0.15s ease, border-color 0.15s ease, color 0.15s ease;
Â Â Â Â }
Â Â Â Â .reply-target-btn:disabled {
Â Â Â Â Â Â opacity: 0.6;
Â Â Â Â Â Â cursor: default;
Â Â Â Â }

Â Â Â Â /* è¢«é …ç›®é€£å‹•æ™‚ï¼Œé¡è‰²è·Ÿ .selected row ä¸€è‡´ */
Â Â Â Â .reply-target-btn.linked {
Â Â Â Â Â Â background: #4f7a3b;
Â Â Â Â Â Â border-color: #4f7a3b;
Â Â Â Â Â Â color: #f5f5f5;
Â Â Â Â }

Â Â Â Â .reply-note {
Â Â Â Â Â Â font-size: 11px;
Â Â Â Â Â Â opacity: 0.75;
Â Â Â Â Â Â margin-bottom: 4px;
Â Â Â Â }

Â Â Â Â #admin-reply {
Â Â Â Â Â Â width: 100%;
Â Â Â Â Â Â background: #1f2326;
Â Â Â Â Â Â border: 1px solid #555;
Â Â Â Â Â Â color: #f5f5f5;
Â Â Â Â Â Â font-size: 12px;
Â Â Â Â Â Â border-radius: 4px;
Â Â Â Â Â Â min-height: 80px;
Â Â Â Â Â Â resize: none; Â  Â  Â  Â  Â  /* å…ˆç”± JS æ§åˆ¶æ‹–æ‹‰ */
Â Â Â Â Â Â overflow: hidden; Â  Â  Â  /* ç”± JS æ§åˆ¶æ˜¯å¦å‡ºç¾å·è»¸ */
Â Â Â Â Â Â line-height: 1.4;
Â Â Â Â }

Â Â Â Â .fingerboard-row {
Â Â Â Â Â Â flex: 1 1 40%;
Â Â Â Â Â Â display: flex;
Â Â Â Â Â Â justify-content: center;
Â Â Â Â Â Â align-items: center;
Â Â Â Â }

Â Â Â Â .fingerboard {
Â Â Â Â Â Â position: relative;
Â Â Â Â Â Â width: 120px;
Â Â Â Â Â Â max-width: 140px;
Â Â Â Â Â Â height: 260px;
Â Â Â Â Â Â background: linear-gradient(180deg, #181a1d, #34383d);
Â Â Â Â Â Â border-radius: 14px;
Â Â Â Â Â Â overflow: hidden;
Â Â Â Â Â Â border: 2px solid #676f78;
Â Â Â Â Â Â box-shadow: 0 0 10px rgba(0, 0, 0, 0.55);
Â Â Â Â }

Â Â Â Â .fb-string {
Â Â Â Â Â Â position: absolute;
Â Â Â Â Â Â top: 6%;
Â Â Â Â Â Â bottom: 6%;
Â Â Â Â Â Â width: 2px;
Â Â Â Â Â Â background: linear-gradient(180deg, #cfcfcf, #888);
Â Â Â Â Â Â opacity: 0.9;
Â Â Â Â }
Â Â Â Â .fb-s1 { left: 20%; transform: skewX(-3deg); }
Â Â Â Â .fb-s2 { left: 40%; transform: skewX(-1.5deg); }
Â Â Â Â .fb-s3 { left: 62%; transform: skewX( 1.5deg); }
Â Â Â Â .fb-s4 { left: 80%; transform: skewX( 3deg); }

Â Â Â Â .fingerboard-note {
Â Â Â Â Â Â position: absolute;
Â Â Â Â Â Â font-size: 10px;
Â Â Â Â Â Â color: #fdf5c5;
Â Â Â Â Â Â opacity: 0.95;
Â Â Â Â Â Â text-shadow: 0 0 2px #000;
Â Â Â Â Â Â pointer-events: none;
Â Â Â Â }

Â Â Â Â /* =====================================================
Â Â Â Â Â * [CSS-6] æ‰‹æ©Ÿç‰ˆ
Â Â Â Â Â * ===================================================== */

Â Â Â Â @media (max-width: 820px) {
Â Â Â Â Â Â .page {
Â Â Â Â Â Â Â Â padding: 0; Â  Â  Â  Â  /* æ‰‹æ©Ÿç‰ˆæ»¿ç‰ˆ */
Â Â Â Â Â Â Â Â max-width: 100%;
Â Â Â Â Â Â }

Â Â Â Â Â Â main.layout {
Â Â Â Â Â Â Â Â flex-direction: column;
Â Â Â Â Â Â }

Â Â Â Â Â Â /* æ‰‹æ©Ÿç‰ˆï¼šé †åºæ”¹æˆ å³ï¼ˆå½±ç‰‡+å¤šå±¤åœ“+å›è¦†+æŒ‡æ¿ï¼‰åœ¨ä¸Šï¼Œå·¦ï¼ˆè¡¨æ ¼ï¼‰åœ¨ä¸‹ */
Â Â Â Â Â Â #visual-panel {
Â Â Â Â Â Â Â Â order: 1;
Â Â Â Â Â Â }
Â Â Â Â Â Â #comments-section {
Â Â Â Â Â Â Â Â order: 2;
Â Â Â Â Â Â }

Â Â Â Â Â Â .panel-left,
Â Â Â Â Â Â .panel-right {
Â Â Â Â Â Â Â Â max-width: 100%;
Â Â Â Â Â Â Â Â width: 100%;
Â Â Â Â Â Â Â Â border-radius: 0;
Â Â Â Â Â Â }

Â Â Â Â Â Â .panel-right .visual-body {
Â Â Â Â Â Â Â Â min-height: 420px;
Â Â Â Â Â Â }

Â Â Â Â Â Â /* æ‰‹æ©Ÿç‰ˆï¼šä¸Šå±¤åªè¦å½±ç‰‡ï¼Œå½±ç‰‡é«˜åº¦å›ºå®š */
Â Â Â Â Â Â .top-row {
Â Â Â Â Â Â Â Â flex-direction: column;
Â Â Â Â Â Â Â Â min-height: 0;
Â Â Â Â Â Â }

Â Â Â Â Â Â .video-frame-wrap {
Â Â Â Â Â Â Â Â width: 100%;
Â Â Â Â Â Â Â Â height: 160px !important;
Â Â Â Â Â Â Â Â min-height: 160px;
Â Â Â Â Â Â }

Â Â Â Â Â Â .circle-area {
Â Â Â Â Â Â Â Â justify-content: center;
Â Â Â Â Â Â Â Â margin-top: 6px;
Â Â Â Â Â Â }

Â Â Â Â Â Â .circle-stack {
Â Â Â Â Â Â Â Â width: 160px;
Â Â Â Â Â Â Â Â height: 160px;
Â Â Â Â Â Â }

Â Â Â Â Â Â .fingerboard {
Â Â Â Â Â Â Â Â height: 220px;
Â Â Â Â Â Â }

Â Â Â Â Â Â /* æ‰‹æ©Ÿç‰ˆï¼šä¸­å±¤ å›è¦†å€ + æŒ‡æ¿ å·¦å³ä¸¦æ’ */
Â Â Â Â Â Â .bottom-row {
Â Â Â Â Â Â Â Â flex-direction: row;
Â Â Â Â Â Â }

Â Â Â Â Â Â .reply-area {
Â Â Â Â Â Â Â Â flex: 1 1 60%;
Â Â Â Â Â Â }

Â Â Â Â Â Â .fingerboard-row {
Â Â Â Â Â Â Â Â flex: 1 1 40%;
Â Â Â Â Â Â }
Â Â Â Â }
Â Â </style>
</head>

<body>
Â Â <div class="page">
Â Â Â Â <header>
Â Â Â Â Â Â <h1>StradTone Violin</h1>
Â Â Â Â Â Â <h2>æç´è²å­¸å¯¦é©—å®¤</h2>
Â Â Â Â </header>

Â Â Â Â <main class="layout">
Â Â Â Â Â Â <!-- å·¦ï¼šç•™è¨€ / ç™¼è¡¨ / éŒ„éŸ³ / å½±ç‰‡ -->
Â Â Â Â Â Â <section class="panel panel-left" id="comments-section">
Â Â Â Â Â Â Â Â <p class="hint">
Â Â Â Â Â Â Â Â Â Â å°æç´
Â Â Â Â Â Â Â Â </p>

Â Â Â Â Â Â Â Â <div class="toolbar">
Â Â Â Â Â Â Â Â Â Â <button type="button" id="btn-new">æ–°å¢</button>
Â Â Â Â Â Â Â Â </div>

Â Â Â Â Â Â Â Â <!-- èµ·å§‹æ”¶èµ·ä¾† -->
Â Â Â Â Â Â Â Â <form id="community-form" class="hidden">
Â Â Â Â Â Â Â Â Â Â <label>
Â Â Â Â Â Â Â Â Â Â Â Â usernameï¼ˆ5â€“12 å­—å¿…å¡«,ä¿®æ”¹ç·¨è¼¯ç”¨ï¼‰ï¼š
Â Â Â Â Â Â Â Â Â Â Â Â <input
Â Â Â Â Â Â Â Â Â Â Â Â Â Â type="text"
Â Â Â Â Â Â Â Â Â Â Â Â Â Â id="nickname-input"
Â Â Â Â Â Â Â Â Â Â Â Â Â Â maxlength="12"
Â Â Â Â Â Â Â Â Â Â Â Â Â Â placeholder="Mr,s 09â€¦."
Â Â Â Â Â Â Â Â Â Â Â Â />
Â Â Â Â Â Â Â Â Â Â </label>
Â Â Â Â Â Â Â Â Â Â <label>
Â Â Â Â Â Â Â Â Â Â Â Â é …ç›®ï¼ˆ100 å­—å…§ï¼‰ï¼š
Â Â Â Â Â Â Â Â Â Â Â Â <input
Â Â Â Â Â Â Â Â Â Â Â Â Â Â type="text"
Â Â Â Â Â Â Â Â Â Â Â Â Â Â id="text-input"
Â Â Â Â Â Â Â Â Â Â Â Â Â Â maxlength="100"
Â Â Â Â Â Â Â Â Â Â Â Â Â Â placeholder="..."
Â Â Â Â Â Â Â Â Â Â Â Â />
Â Â Â Â Â Â Â Â Â Â </label>

Â Â Â Â Â Â Â Â Â Â <!-- ä¸‰é¡†åª’é«”æŒ‰éˆ•ï¼šåªèƒ½é¸ä¸€ç¨®åª’é«” -->
Â Â Â Â Â Â Â Â Â Â <div class="form-row-inline media-select-row">
Â Â Â Â Â Â Â Â Â Â Â Â <button
Â Â Â Â Â Â Â Â Â Â Â Â Â Â type="button"
Â Â Â Â Â Â Â Â Â Â Â Â Â Â class="media-select-btn"
Â Â Â Â Â Â Â Â Â Â Â Â Â Â id="btn-media-youtube"
Â Â Â Â Â Â Â Â Â Â Â Â Â Â data-media="youtube"
Â Â Â Â Â Â Â Â Â Â Â Â >
Â Â Â Â Â Â Â Â Â Â Â Â Â Â YouTube
Â Â Â Â Â Â Â Â Â Â Â Â </button>
Â Â Â Â Â Â Â Â Â Â Â Â <button
Â Â Â Â Â Â Â Â Â Â Â Â Â Â type="button"
Â Â Â Â Â Â Â Â Â Â Â Â Â Â class="media-select-btn"
Â Â Â Â Â Â Â Â Â Â Â Â Â Â id="btn-media-upload"
Â Â Â Â Â Â Â Â Â Â Â Â Â Â data-media="upload"
Â Â Â Â Â Â Â Â Â Â Â Â >
Â Â Â Â Â Â Â Â Â Â Â Â Â Â å½±ç‰‡
Â Â Â Â Â Â Â Â Â Â Â Â </button>
Â Â Â Â Â Â Â Â Â Â Â Â <button
Â Â Â Â Â Â Â Â Â Â Â Â Â Â type="button"
Â Â Â Â Â Â Â Â Â Â Â Â Â Â class="media-select-btn"
Â Â Â Â Â Â Â Â Â Â Â Â Â Â id="btn-media-audio"
Â Â Â Â Â Â Â Â Â Â Â Â Â Â data-media="audio"
Â Â Â Â Â Â Â Â Â Â Â Â >
Â Â Â Â Â Â Â Â Â Â Â Â Â Â éŒ„éŸ³
Â Â Â Â Â Â Â Â Â Â Â Â </button>
Â Â Â Â Â Â Â Â Â Â </div>

Â Â Â Â Â Â Â Â Â Â <!-- å½±ç‰‡æ¬„ä½ï¼ˆåŒ…å« YouTube / ä¸Šå‚³ï¼‰ -->
Â Â Â Â Â Â Â Â Â Â <div id="video-fields" class="hidden">
Â Â Â Â Â Â Â Â Â Â Â Â <!-- YouTube å€å¡Šï¼ˆåªåœ¨ã€ŒYouTubeã€æ¨¡å¼é¡¯ç¤ºï¼‰ -->
Â Â Â Â Â Â Â Â Â Â Â Â <div class="form-row-inline" id="youtube-row" style="margin-top:4px;">
Â Â Â Â Â Â Â Â Â Â Â Â Â Â <input
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â type="text"
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â id="youtube-url-input"
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â placeholder="https://youtu.be/....(Link)â€¦"
Â Â Â Â Â Â Â Â Â Â Â Â Â Â />
Â Â Â Â Â Â Â Â Â Â Â Â Â Â <input
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â type="text"
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â id="start-input"
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â placeholder="é–‹å§‹ mm:ss "
Â Â Â Â Â Â Â Â Â Â Â Â Â Â />
Â Â Â Â Â Â Â Â Â Â Â Â Â Â <input
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â type="text"
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â id="end-input"
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â placeholder="çµæŸ mm:ss "
Â Â Â Â Â Â Â Â Â Â Â Â Â Â />
Â Â Â Â Â Â Â Â Â Â Â Â </div>

Â Â Â Â Â Â Â Â Â Â Â Â <!-- ä¸Šå‚³å½±ç‰‡ / åœ–ç‰‡æª”æ¡ˆï¼ˆåªåœ¨ã€Œå½±ç‰‡ã€æ¨¡å¼é¡¯ç¤ºï¼‰ -->
Â Â Â Â Â Â Â Â Â Â Â Â <div class="form-row-inline" id="video-upload-row" style="margin-top:4px;">
Â Â Â Â Â Â Â Â Â Â Â Â Â Â <input type="file" id="video-file-input" accept="video/*,image/*" />
Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span id="video-file-label" class="sub-hint"></span>
Â Â Â Â Â Â Â Â Â Â Â Â </div>
Â Â Â Â Â Â Â Â Â Â </div>

Â Â Â Â Â Â Â Â Â Â <!-- éŒ„éŸ³æ¬„ä½ -->
Â Â Â Â Â Â Â Â Â Â <div id="audio-fields" class="hidden">
Â Â Â Â Â Â Â Â Â Â Â Â <!-- éŒ„éŸ³æ§åˆ¶åˆ— -->
Â Â Â Â Â Â Â Â Â Â Â Â <div class="media-record-toolbar" id="audio-record-toolbar">
Â Â Â Â Â Â Â Â Â Â Â Â Â Â <button type="button" class="media-record-btn" id="audio-rec-start">â—</button>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â <button type="button" class="media-record-btn" id="audio-rec-stop" disabled>â– </button>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â <button type="button" class="media-record-btn" id="audio-rec-cancel" disabled>âœ•</button>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class="media-record-status" id="audio-rec-status">éŒ„éŸ³é å‚™</span>
Â Â Â Â Â Â Â Â Â Â Â Â </div>

Â Â Â Â Â Â Â Â Â Â Â Â <!-- ä¸Šå‚³ç¾æœ‰éŸ³æª” -->
Â Â Â Â Â Â Â Â Â Â Â Â <div class="form-row-inline" id="audio-upload-row" style="margin-top:4px;">
Â Â Â Â Â Â Â Â Â Â Â Â Â Â <input type="file" id="audio-file-input" accept="audio/*" />
Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span id="audio-file-label" class="sub-hint"></span>
Â Â Â Â Â Â Â Â Â Â Â Â </div>

Â Â Â Â Â Â Â Â Â Â Â Â <!-- éŒ„éŸ³é è¦½ -->
Â Â Â Â Â Â Â Â Â Â Â Â <div class="form-row-inline" id="audio-preview-row" style="margin-top:4px;">
Â Â Â Â Â Â Â Â Â Â Â Â Â Â <audio id="audio-rec-preview" class="rec-preview" controls></audio>
Â Â Â Â Â Â Â Â Â Â Â Â </div>
Â Â Â Â Â Â Â Â Â Â </div>

Â Â Â Â Â Â Â Â Â Â <div class="form-row-inline">
Â Â Â Â Â Â Â Â Â Â Â Â <button type="submit" id="submit-btn">ç™¼è¡¨</button>
Â Â Â Â Â Â Â Â Â Â </div>
Â Â Â Â Â Â Â Â </form>

Â Â Â Â Â Â Â Â <div class="comments-wrapper">
Â Â Â Â Â Â Â Â Â Â <table id="comments-table">
Â Â Â Â Â Â Â Â Â Â Â Â <thead>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â <tr>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <th class="col-nick">username</th>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <th class="col-text">
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â é …ç›®
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <button
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â type="button"
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â id="btn-edit"
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â class="edit-header-btn"
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â >
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ç·¨è¼¯
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â </button>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â </th>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <th class="col-media">éŒ„éŸ³ / å½±ç‰‡</th>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â </tr>
Â Â Â Â Â Â Â Â Â Â Â Â </thead>
Â Â Â Â Â Â Â Â Â Â Â Â <tbody id="comments-tbody">
Â Â Â Â Â Â Â Â Â Â Â Â Â Â <!-- JS å‹•æ…‹æ’å…¥ -->
Â Â Â Â Â Â Â Â Â Â Â Â </tbody>
Â Â Â Â Â Â Â Â Â Â </table>
Â Â Â Â Â Â Â Â </div>

Â Â Â Â Â Â Â Â <!-- Back æŒ‰éˆ•ç§»åˆ°å·¦é‚Šè¡¨æ ¼åº•ä¸‹ -->
Â Â Â Â Â Â Â Â <button id="back-button" type="button">Back</button>
Â Â Â Â Â Â </section>

Â Â Â Â Â Â <!-- å³ï¼šå½±ç‰‡ + å¤šå±¤åœ“ + å›è¦† + æŒ‡æ¿ -->
Â Â Â Â Â Â <section class="panel panel-right" id="visual-panel">
Â Â Â Â Â Â Â Â <div class="visual-wrapper">
Â Â Â Â Â Â Â Â Â Â <div class="visual-header">
Â Â Â Â Â Â Â Â Â Â Â Â <div class="current-point" id="current-info">
Â Â Â Â Â Â Â Â Â Â Â Â Â Â å°šæœªé¸å–ç•™è¨€
Â Â Â Â Â Â Â Â Â Â Â Â </div>
Â Â Â Â Â Â Â Â Â Â </div>

Â Â Â Â Â Â Â Â Â Â <div class="visual-body">
Â Â Â Â Â Â Â Â Â Â Â Â <!-- ä¸Šå±¤ï¼šå½±ç‰‡ + å¤šå±¤åœ“ï¼ˆæ¡Œæ©Ÿï¼‰ï¼›æ‰‹æ©Ÿæ™‚æœƒèª¿æ•´æ’ç‰ˆ -->
Â Â Â Â Â Â Â Â Â Â Â Â <div class="top-row">
Â Â Â Â Â Â Â Â Â Â Â Â Â Â <!-- å·¦ï¼šå½±ç‰‡æ ¼ -->
Â Â Â Â Â Â Â Â Â Â Â Â Â Â <div class="video-frame-wrap">
<iframe
Â Â id="video-iframe"
Â Â src=""
Â Â allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
Â Â referrerpolicy="origin-when-cross-origin"
Â Â allowfullscreen
></iframe>

Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <div class="video-placeholder" id="video-placeholder">
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <!-- åˆå§‹å ä½æ–‡å­—å¯åœ¨ CSS æˆ– JS æ§åˆ¶ -->
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â </div>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â </div>

Â Â Â Â Â Â Â Â Â Â Â Â Â Â <!-- å³ï¼šå¤šå±¤åœ“ -->
Â Â Â Â Â Â Â Â Â Â Â Â Â Â <div class="circle-area">
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <div class="circle-stack" id="circle-stack">
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <div class="ring ring-main ring-1" data-layer="1"></div>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <div class="ring ring-main ring-2" data-layer="2"></div>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <div class="ring ring-main ring-3" data-layer="3"></div>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <div class="ring ring-main ring-4" data-layer="4"></div>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <div
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â class="ring ring-boundary ring-b15"
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â data-layer="1.5"
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ></div>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <div
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â class="ring ring-boundary ring-b25"
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â data-layer="2.5"
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ></div>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <div
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â class="ring ring-boundary ring-b35"
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â data-layer="3.5"
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ></div>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <div
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â class="ring ring-b45"
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â data-layer="4.5"
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ></div>

Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <div class="layer-label" id="layer-label">
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â layers: â€“
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â </div>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â </div>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â </div>
Â Â Â Â Â Â Â Â Â Â Â Â </div>

Â Â Â Â Â Â Â Â Â Â Â Â <!-- ä¸­å±¤ï¼šå›è¦†å€ + é»é»ä½ç½®åœ– -->
Â Â Â Â Â Â Â Â Â Â Â Â <div class="bottom-row">
Â Â Â Â Â Â Â Â Â Â Â Â Â Â <div class="reply-area">
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <div class="reply-target" id="reply-target">
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <button
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â type="button"
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â id="reply-target-btn"
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â class="reply-target-btn"
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â disabled
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â >
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â From: â€”
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â </button>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â </div>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <p class="reply-note">
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <!-- çµ¦ç®¡ç†å“¡çœ‹çš„èªªæ˜ï¼Œå·²åœ¨ CSS éš±è— -->
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â </p>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <textarea
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â id="admin-reply"
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â placeholder="æç´è²å­¸å¯¦é©—å®¤ï¼š"
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ></textarea>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â </div>

Â Â Â Â Â Â Â Â Â Â Â Â Â Â <div class="fingerboard-row">
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <div class="fingerboard" id="fingerboard">
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <div class="fb-string fb-s1"></div>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <div class="fb-string fb-s2"></div>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <div class="fb-string fb-s3"></div>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <div class="fb-string fb-s4"></div>

Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <!-- ç¤ºæ„é» -->
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <div
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â class="fingerboard-note"
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â style="left:24%; top:8%;"
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â >
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â G0
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â </div>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <div
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â class="fingerboard-note"
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â style="left:24%; top:26%;"
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â >
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â G3
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â </div>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <div
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â class="fingerboard-note"
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â style="left:38%; top:18%;"
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â >
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â D5
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â </div>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <div
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â class="fingerboard-note"
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â style="left:38%; top:40%;"
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â >
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â D8
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â </div>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <div
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â class="fingerboard-note"
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â style="left:62%; top:22%;"
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â >
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â A7
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â </div>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <div
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â class="fingerboard-note"
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â style="left:62%; top:44%;"
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â >
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â A10
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â </div>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <div
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â class="fingerboard-note"
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â style="left:76%; top:30%;"
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â >
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â E9
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â </div>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <div
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â class="fingerboard-note"
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â style="left:76%; top:52%;"
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â >
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â E12
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â </div>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â </div>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â </div>
Â Â Â Â Â Â Â Â Â Â Â Â </div>
Â Â Â Â Â Â Â Â Â Â </div>
Â Â Â Â Â Â Â Â </div>
Â Â Â Â Â Â </section>
Â Â Â Â </main>
Â Â </div>

<script>
// ====== [JS-0] å…¨åŸŸç‹€æ…‹ ======
const API_URL =
Â Â "https://script.google.com/macros/s/AKfycbxn5aDCimtZmvgK4uEGr5fIyNItY2wZgQyO2LVEZkggFkO0VZ_YdDMyspGpzpkYy5W6-A/exec";

let commentsCache = [];
let currentSelectedId = null;

// æ–°å¢ / ç·¨è¼¯æ¬„æ˜¯å¦å±•é–‹
let isFormOpen = false;

// ç·¨è¼¯ç‹€æ…‹ï¼šæŒ‰ä¸‹ã€Œç·¨è¼¯ã€å¾Œæ‰æœƒå•Ÿå‹•
let editState = {
Â Â active: false,
Â Â id: null,
Â Â nickname: "",
Â Â originalText: "",
Â Â waitForSelect: false
};

// éŒ„éŸ³ / éŒ„å½± blobï¼ˆé ç•™ï¼‰
window.recordedAudioBlob = null;
window.recordedVideoBlob = null;
// å·¦å´ã€ŒéŒ„éŸ³ã€é¢æ¿ç”¨çš„éŒ„éŸ³æ§åˆ¶
let audioRecStream = null;
let audioRecRecorder = null;
let audioRecChunks = [];
let audioRecActive = false;
// ====== [JS-1] å°å·¥å…· ======

// é®è”½åç¨±
function maskName(name) {
Â Â const s = String(name || "").trim();
Â Â if (!s) return "åŒ¿å";
Â Â if (s.length <= 2) return s[0] + "*";
Â Â const first = s[0];
Â Â const last = s[s.length - 1];
Â Â const middle = "*".repeat(s.length - 2);
Â Â return first + middle + last;
}

// åç¨±éœ€ 5ï½12 å­— & ç¦æ­¢ç‰¹æ®Šç¬¦è™Ÿï¼ˆå…è¨±ç´”æ•¸å­—ã€è‹±æ–‡ã€ä¸­æ–‡å­—ï¼‰
function validateNameLength(name) {
Â Â const s = String(name || "").trim();
Â Â if (s.length < 5 || s.length > 12) return false;
Â Â if (!/^[A-Za-z0-9\u4E00-\u9FFF]+$/.test(s)) return false;
Â Â return true;
}

// æ™‚é–“å­—ä¸² â†’ ç§’æ•¸
function parseTimeToSec(str) {
Â Â if (!str) return "";
Â Â const s = String(str).trim();
Â Â let m = s.match(/^(\d+):(\d{1,2})$/);
Â Â if (m) {
Â Â Â Â const min = Number(m[1]);
Â Â Â Â const sec = Number(m[2]);
Â Â Â Â if (!isNaN(min) && !isNaN(sec)) return min * 60 + sec;
Â Â }
Â Â m = s.match(/^(\d{3,4})$/);
Â Â if (m) {
Â Â Â Â const digits = m[1];
Â Â Â Â const sec = Number(digits.slice(-2));
Â Â Â Â const min = Number(digits.slice(0, -2));
Â Â Â Â if (!isNaN(min) && !isNaN(sec)) return min * 60 + sec;
Â Â }
Â Â return "";
}

function escapeHtml(str) {
Â Â return String(str || "").replace(/[&<>"']/g, (c) => {
Â Â Â Â return (
Â Â Â Â Â Â {
Â Â Â Â Â Â Â Â "&": "&amp;",
Â Â Â Â Â Â Â Â "<": "&lt;",
Â Â Â Â Â Â Â Â ">": "&gt;",
Â Â Â Â Â Â Â Â '"': "&quot;",
Â Â Â Â Â Â Â Â "'": "&#39;",
Â Â Â Â Â Â }[c] || c
Â Â Â Â );
Â Â });
}

// YouTube ID
function extractYoutubeId(url) {
Â Â if (!url) return "";
Â Â const m1 = url.match(/youtu\.be\/([^?]+)/);
Â Â if (m1) return m1[1];
Â Â const m2 = url.match(/[?&]v=([^&]+)/);
Â Â if (m2) return m2[1];
Â Â return "";
}


//å½±ç‰‡ youtube è¨­å®š
/*
// åˆ¤æ–·æ˜¯å¦ç‚º iOSï¼ˆiPhone / iPadï¼‰
function isIOS() {
Â Â return /iP(ad|hone|od)/.test(navigator.userAgent);
}
*/


// YouTube embed
function buildYoutubeEmbedUrl(url, startSec, endSec) {
Â Â const id = extractYoutubeId(url);
Â Â if (!id) return "";

/*
Â Â // ä½¿ç”¨éš±ç§åŠ å¼·çš„ youtube-nocookie ç¶²åŸŸ
Â Â const base = "https://www.youtube-nocookie.com/embed/" + id;
Â Â const params = [];
*/
Â Â 
Â Â // æ‰€æœ‰è£ç½®éƒ½å˜—è©¦è‡ªå‹•æ’­æ”¾
Â Â params.push("autoplay=1");Â 

/*
Â Â // æ ¹æ“šè¨­å‚™é¡å‹è¨­ç½®éœéŸ³åƒæ•¸
Â Â if (isIOS()) {
Â Â Â Â // åˆ¤æ–·ç‚º iOS æ™‚ï¼Œå¿…é ˆè¨­å®šéœéŸ³ (mute=1)ï¼Œæ‰èƒ½è¦é¿é™åˆ¶ä¸¦å¢åŠ è‡ªå‹•æ’­æ”¾æˆåŠŸç‡
Â Â Â Â // åŒæ™‚ï¼Œé€™ä¹Ÿæ˜¯è¦é¿ iOS Webview 153 éŒ¯èª¤çš„æœ€ä½³å¯¦å‹™
Â Â Â Â params.push("mute=1");
Â Â }Â 
*/

Â Â // --- é˜²è·³è½‰èˆ‡åŸºæœ¬åƒæ•¸ (æ‰€æœ‰è£ç½®é€šç”¨) ---
Â Â // 1. é˜²è·³è½‰ (rel=0)ï¼šæ’­æ”¾çµæŸä¸é¡¯ç¤ºç›¸é—œå½±ç‰‡
Â Â // 2. æ¸›å°‘æ¨™èªŒ (modestbranding=1)ï¼šç›¡å¯èƒ½éš±è— YouTube æ¨™èªŒï¼Œæ¸›å°‘é»æ“Šè·³è½‰é»
Â Â // 3. Playsinline (playsinline=1)ï¼šå…è¨±åœ¨ iOS è¨­å‚™ä¸Šç¶²é å…§æ’­æ”¾
Â Â params.push("rel=0", "modestbranding=1", "playsinline=1");

/*
Â Â // å‘Šè¨´ YouTube é€™å€‹å…§åµŒçš„ä¾†æº
Â Â try {
Â Â Â Â if (window.location && window.location.origin) {
Â Â Â Â Â Â params.push("origin=" + encodeURIComponent(window.location.origin));
Â Â Â Â }
Â Â } catch (e) {
Â Â Â Â // å¿½ç•¥ä¾‹å¤–
Â Â }
*/


Â Â // è¨­å®šé–‹å§‹èˆ‡çµæŸæ™‚é–“
Â Â if (startSec !== "" && !isNaN(startSec)) {
Â Â Â Â params.push("start=" + startSec);
Â Â }
Â Â if (endSec !== "" && !isNaN(endSec)) {
Â Â Â Â params.push("end=" + endSec);
Â Â }

Â Â return params.length ? base + "?" + params.join("&") : base;
}


// Google Drive embed
function buildDriveEmbedUrl(fid) {
Â Â return fid
Â Â Â Â ? "https://drive.google.com/file/d/" + fid + "/preview"
Â Â Â Â : "";
}

// å·è»¸å¾€å›ï¼ˆå½±ç‰‡ä¸Šæ–¹ï¼Œæ¡Œæ©Ÿ + æ‰‹æ©Ÿå…±ç”¨ï¼‰
function scrollToVideoTop() {
Â Â const el = document.querySelector(".video-frame-wrap");
Â Â if (el) {
Â Â Â Â el.scrollIntoView({
Â Â Â Â Â Â behavior: "smooth",
Â Â Â Â Â Â block: "start",
Â Â Â Â });
Â Â }
}

// Base64
function readFileAsBase64(file) {
Â Â return new Promise((resolve, reject) => {
Â Â Â Â const r = new FileReader();
Â Â Â Â r.onload = () => {
Â Â Â Â Â Â const result = r.result || "";
Â Â Â Â Â Â const idx = String(result).indexOf(",");
Â Â Â Â Â Â resolve(idx >= 0 ? result.slice(idx + 1) : result);
Â Â Â Â };
Â Â Â Â r.onerror = () => reject(r.error);
Â Â Â Â r.readAsDataURL(file);
Â Â });
}

// ====== [JS-2] è¼‰å…¥èˆ‡è¡¨æ ¼åˆ—è¡¨ ======

async function loadComments() {
Â Â const res = await fetch(API_URL + "?action=list", { cache: "no-cache" });
Â Â const data = await res.json();
Â Â commentsCache = data.posts || [];
Â Â renderCommentsTable();
}

// ====== [JS-3] æ¸²æŸ“è¡¨æ ¼ ======

function renderCommentsTable() {
Â Â const tbody = document.getElementById("comments-tbody");
Â Â if (!tbody) return;

Â Â if (!commentsCache.length) {
Â Â Â Â tbody.innerHTML = `<tr><td colspan="3">ç›®å‰å°šç„¡é …ç›®</td></tr>`;
Â Â Â Â return;
Â Â }

Â Â const rows = commentsCache.slice().reverse();

Â Â const html = rows
Â Â Â Â .map((row) => {
Â Â Â Â Â Â const nick = maskName(row.nickname);
Â Â Â Â Â Â const full = String(row.text || "");
Â Â Â Â Â Â const long = full.length > 30;
Â Â Â Â Â Â const shortText = long
Â Â Â Â Â Â Â Â ? escapeHtml(full.slice(0, 30)) + "..."
Â Â Â Â Â Â Â Â : escapeHtml(full);

Â Â Â Â Â Â const type = row.type || "text";

Â Â Â Â Â Â const hasYoutube = type === "youtube" && row.youtubeUrl;
Â Â Â Â Â Â const hasDrive = type === "upload" && row.driveFileId;
Â Â Â Â Â Â const hasAudio = type === "audio" && (row.hasAudio || row.driveAudioId);

Â Â Â Â Â Â // åª’é«”é¡¯ç¤ºç¬¦è™Ÿ
Â Â Â Â Â Â let mediaHtml = `<span style="opacity:.5">â€”</span>`;
Â Â Â Â Â Â const icons = [];

Â Â Â Â Â Â if (hasAudio) {
Â Â Â Â Â Â Â Â // éŸ³æ¨‚ç¬¦è™Ÿ ğŸµï¼ˆä¸è¦å–‡å­ï¼‰
Â Â Â Â Â Â Â Â icons.push(`<span class="media-flag" title="éŒ„éŸ³">ğŸµ</span>`);
Â Â Â Â Â Â }

Â Â Â Â Â Â if (hasYoutube || hasDrive) {
Â Â Â Â Â Â Â Â icons.push(
Â Â Â Â Â Â Â Â Â Â `<button class="play-video-btn" data-id="${row.id}">
Â Â Â Â Â Â Â Â Â Â Â Â Â ğŸ¬ æ’­æ”¾
Â Â Â Â Â Â Â Â Â Â Â </button>`
Â Â Â Â Â Â Â Â );
Â Â Â Â Â Â }

Â Â Â Â Â Â if (icons.length) {
Â Â Â Â Â Â Â Â mediaHtml = `<div class="media-icons">${icons.join("")}</div>`;
Â Â Â Â Â Â }

Â Â Â Â Â Â const selected =
Â Â Â Â Â Â Â Â String(row.id) === String(currentSelectedId) ? ` class="selected"` : "";

Â Â Â Â Â Â return `
Â Â Â Â Â Â Â Â <tr data-id="${row.id}"${selected}>
Â Â Â Â Â Â Â Â Â Â <td class="col-nick">${escapeHtml(nick)}</td>
Â Â Â Â Â Â Â Â Â Â <td class="col-text" data-long="${long ? "1" : "0"}">
Â Â Â Â Â Â Â Â Â Â Â Â ${shortText}${long ? `<span class="expand-arrow">â–¼</span>` : ""}
Â Â Â Â Â Â Â Â Â Â </td>
Â Â Â Â Â Â Â Â Â Â <td class="col-media">${mediaHtml}</td>
Â Â Â Â Â Â Â Â </tr>
Â Â Â Â Â Â `;
Â Â Â Â })
Â Â Â Â .join("");

Â Â tbody.innerHTML = html;
}

// ====== [JS-4] é¡¯ç¤ºå½±ç‰‡ã€éŸ³è¨Š ======

function clearVideo() {
Â Â const iframe = document.getElementById("video-iframe");
Â Â const ph = document.getElementById("video-placeholder");
Â Â if (iframe) iframe.src = "";
Â Â if (ph) ph.style.display = "flex";
}

function showVideoForRow(row) {
Â Â if (!row) return;
Â Â clearVideo();

Â Â let url = "";

Â Â if (row.type === "youtube" && row.youtubeUrl) {
Â Â Â Â url = buildYoutubeEmbedUrl(row.youtubeUrl, row.startSec, row.endSec);
Â Â } else if (row.type === "upload" && row.driveFileId) {
Â Â Â Â url = buildDriveEmbedUrl(row.driveFileId);
Â Â }

Â Â if (url) {
Â Â Â Â const iframe = document.getElementById("video-iframe");
Â Â Â Â const ph = document.getElementById("video-placeholder");
Â Â Â Â iframe.src = url;
Â Â Â Â ph.style.display = "none";
Â Â }
}

// ====== [JS-5] å¤šå±¤åœ“ï¼ˆé ç•™ï¼‰ ======
function highlightLayers(layerStr) {
Â Â const rings = document.querySelectorAll(".ring");
Â Â rings.forEach((r) => r.classList.remove("active"));

Â Â if (!layerStr) return;

Â Â const parts = String(layerStr)
Â Â Â Â .split(",")
Â Â Â Â .map((s) => s.trim())
Â Â Â Â .filter(Boolean);

Â Â rings.forEach((r) => {
Â Â Â Â const v = r.getAttribute("data-layer");
Â Â Â Â if (parts.includes(v)) r.classList.add("active");
Â Â });
}

// ====== [JS-6] æŸ¥æ‰¾ row ======
function findRowById(id) {
Â Â return commentsCache.find((r) => String(r.id) === String(id));
}

// ====== [JS-7] å›è¦†å€å›ºå®šå‰ç¶´ ======
const REPLY_PREFIX = "æç´è²å­¸å¯¦é©—å®¤ï¼š";

function ensureReplyPrefix() {
Â Â const box = document.getElementById("admin-reply");
Â Â if (!box) return;

Â Â let val = box.value || "";
Â Â if (!val) {
Â Â Â Â box.value = REPLY_PREFIX + "\n";
Â Â Â Â return;
Â Â }
Â Â if (!val.startsWith(REPLY_PREFIX)) {
Â Â Â Â val = val.replace(/^æç´è²å­¸å¯¦é©—å®¤ï¼š\s*/g, "");
Â Â Â Â box.value = REPLY_PREFIX + "\n" + val;
Â Â }
}

function autoResizeReply() {
Â Â const box = document.getElementById("admin-reply");
Â Â if (!box) return;

Â Â let maxH = 260;
Â Â const fb = document.getElementById("fingerboard");
Â Â if (fb) {
Â Â Â Â const rect = fb.getBoundingClientRect();
Â Â Â Â if (rect.height > 0) maxH = rect.height;
Â Â }

Â Â box.style.height = "auto";
Â Â const scrollH = box.scrollHeight;

Â Â if (scrollH <= maxH) {
Â Â Â Â box.style.height = scrollH + "px";
Â Â Â Â box.style.overflowY = "hidden";
Â Â Â Â box.style.resize = "none";
Â Â } else {
Â Â Â Â box.style.height = maxH + "px";
Â Â Â Â box.style.overflowY = "auto";
Â Â Â Â box.style.resize = "vertical";
Â Â }
}

// ====== [JS-8] é¸å–é …ç›®ï¼ˆè‡ªå‹•å±•é–‹ + è‡ªå‹•æ’­æ”¾ + å›è¦†é€£å‹• + From: é¡è‰²åŒæ­¥ï¼‰ ======

function resetReplyTargetButton() {
Â Â const btn = document.getElementById("reply-target-btn");
Â Â if (!btn) return;
Â Â btn.textContent = "From: â€”";
Â Â btn.disabled = true;
Â Â btn.removeAttribute("data-id");
Â Â btn.classList.remove("linked");
}

function selectRowForReply(row) {
Â Â if (!row) return;

Â Â // è‹¥æ­£åœ¨ç·¨è¼¯ â†’ ç›´æ¥å–æ¶ˆå›åˆ°åŸå§‹ç‹€æ…‹ï¼ˆä¸è·³ alertï¼‰
Â Â if (editState.active) {
Â Â Â Â resetFormToAddMode();
Â Â }

Â Â currentSelectedId = row.id;

Â Â // é¸å–åˆ—é«˜äº®
Â Â const tbody = document.getElementById("comments-tbody");
Â Â if (tbody) {
Â Â Â Â Array.from(tbody.querySelectorAll("tr")).forEach((tr) => {
Â Â Â Â Â Â tr.classList.toggle(
Â Â Â Â Â Â Â Â "selected",
Â Â Â Â Â Â Â Â tr.getAttribute("data-id") === String(row.id)
Â Â Â Â Â Â );
Â Â Â Â });
Â Â }

Â Â // æ›´æ–° From: æ¨™ç±¤
Â Â const btn = document.getElementById("reply-target-btn");
Â Â if (btn) {
Â Â Â Â btn.textContent = "From: " + maskName(row.nickname);
Â Â Â Â btn.disabled = false;
Â Â Â Â btn.setAttribute("data-id", String(row.id));
Â Â Â Â // é¡è‰²åŒæ­¥é¸å–åˆ—
Â Â Â Â btn.classList.add("linked");
Â Â }

Â Â // ç®¡ç†å“¡å›è¦†å€å¡«å…¥åŸæœ¬ reply
Â Â const box = document.getElementById("admin-reply");
Â Â if (box) {
Â Â Â Â const raw = row.reply || "";
Â Â Â Â if (!raw) {
Â Â Â Â Â Â box.value = REPLY_PREFIX + "\n";
Â Â Â Â } else if (raw.startsWith(REPLY_PREFIX)) {
Â Â Â Â Â Â box.value = raw;
Â Â Â Â } else {
Â Â Â Â Â Â box.value = REPLY_PREFIX + "\n" + raw;
Â Â Â Â }
Â Â Â Â ensureReplyPrefix();
Â Â Â Â autoResizeReply();
Â Â }

Â Â // å±•é–‹æ–‡å­—ï¼ˆè‹¥ >30 å­—ï¼‰
Â Â if (tbody) {
Â Â Â Â const tr = tbody.querySelector(`tr[data-id="${row.id}"]`);
Â Â Â Â if (tr) {
Â Â Â Â Â Â const cell = tr.querySelector("td.col-text");
Â Â Â Â Â Â if (cell && String(row.text || "").length > 30) {
Â Â Â Â Â Â Â Â cell.innerHTML =
Â Â Â Â Â Â Â Â Â Â escapeHtml(row.text) +
Â Â Â Â Â Â Â Â Â Â `<span class="expand-arrow" title="æ”¶åˆ">â–²</span>`;
Â Â Â Â Â Â Â Â cell.setAttribute("data-expanded", "1");
Â Â Â Â Â Â }
Â Â Â Â }
Â Â }

Â Â // æ’­æ”¾å½±ç‰‡
Â Â showVideoForRow(row);

Â Â // æ²åˆ°å½±ç‰‡é ‚éƒ¨ï¼ˆé˜²è·³æ ¼ç‰ˆï¼‰
Â Â scrollToVideoTop();
}

// ====== [JS-9] å„²å­˜å›è¦† ======
async function saveAdminReply() {
Â Â const box = document.getElementById("admin-reply");
Â Â if (!box || !currentSelectedId) return;

Â Â ensureReplyPrefix();
Â Â autoResizeReply();

Â Â const text = box.value.trim();

Â Â try {
Â Â Â Â const params = new URLSearchParams({
Â Â Â Â Â Â action: "reply",
Â Â Â Â Â Â id: String(currentSelectedId),
Â Â Â Â Â Â reply: text,
Â Â Â Â });

Â Â Â Â const res = await fetch(API_URL + "?" + params.toString());
Â Â Â Â const data = await res.json();

Â Â Â Â if (!data || data.status !== "ok") {
Â Â Â Â Â Â throw new Error(data.error || "reply å¤±æ•—");
Â Â Â Â }

Â Â Â Â const r = findRowById(currentSelectedId);
Â Â Â Â if (r) r.reply = text;
Â Â } catch (err) {
Â Â Â Â console.error(err);
Â Â }
}

// ====== [JS-10] åª’é«”æ¨¡å¼åˆ‡æ›ï¼ˆYouTube / å½±ç‰‡ / éŒ„éŸ³ äº’æ–¥ï¼‰ ======
function clearRecordedMediaState() {
Â Â window.recordedAudioBlob = null;
Â Â window.recordedVideoBlob = null;
Â Â const aStatus = document.getElementById("audio-rec-status");
Â Â if (aStatus) aStatus.textContent = "éŒ„éŸ³é å‚™";
}

// ====== [JS-A] å·¦å´è¡¨å–®ï¼šéŒ„éŸ³é¢æ¿æ§åˆ¶ï¼ˆä½¿ç”¨ MediaRecorderï¼‰ ======
function stopAudioRecordingInternal(cancelOnly) {
Â Â const statusEl = document.getElementById("audio-rec-status");
Â Â const previewEl = document.getElementById("audio-rec-preview");
Â Â const btnStart = document.getElementById("audio-rec-start");
Â Â const btnStop = document.getElementById("audio-rec-stop");
Â Â const btnCancel = document.getElementById("audio-rec-cancel");

Â Â // åœæ‰ recorder
Â Â if (audioRecRecorder && audioRecRecorder.state !== "inactive") {
Â Â Â Â try {
Â Â Â Â Â Â audioRecRecorder.stop();
Â Â Â Â } catch (e) {}
Â Â }
Â Â audioRecRecorder = null;

Â Â // é—œæ‰éº¥å…‹é¢¨ stream
Â Â if (audioRecStream) {
Â Â Â Â audioRecStream.getTracks().forEach((t) => t.stop());
Â Â }
Â Â audioRecStream = null;

Â Â audioRecActive = false;

Â Â if (cancelOnly) {
Â Â Â Â // å–æ¶ˆï¼šæ¸…é™¤é€™æ¬¡éŒ„éŸ³
Â Â Â Â audioRecChunks = [];
Â Â Â Â window.recordedAudioBlob = null;
Â Â Â Â if (previewEl) {
Â Â Â Â Â Â previewEl.src = "";
Â Â Â Â Â Â previewEl.removeAttribute("src");
Â Â Â Â }
Â Â Â Â if (statusEl) statusEl.textContent = "éŒ„éŸ³é å‚™";
Â Â } else {
Â Â Â Â if (statusEl) statusEl.textContent = "éŒ„éŸ³å®Œæˆï¼Œå¯æŒ‰ã€Œç™¼è¡¨ã€å„²å­˜ã€‚";
Â Â }

Â Â if (btnStart) btnStart.disabled = false;
Â Â if (btnStop) btnStop.disabled = true;
Â Â if (btnCancel) btnCancel.disabled = false;
}

function setupAudioRecording() {
Â Â const btnStart = document.getElementById("audio-rec-start");
Â Â const btnStop = document.getElementById("audio-rec-stop");
Â Â const btnCancel = document.getElementById("audio-rec-cancel");
Â Â const statusEl = document.getElementById("audio-rec-status");
Â Â const previewEl = document.getElementById("audio-rec-preview");

Â Â if (!btnStart || !btnStop || !btnCancel || !statusEl || !previewEl) {
Â Â Â Â return; // HTML æ²’è¼‰åˆ°å°±ç›´æ¥è·³é
Â Â }

Â Â // ä¸€é–‹å§‹ï¼šåªé–‹ã€Œé–‹å§‹éŒ„éŸ³ã€ï¼Œåœæ­¢/å–æ¶ˆç‹€æ…‹è·Ÿä½ åŸæœ¬è¨­å®šç‚ºä¸»
Â Â btnStart.disabled = false;

Â Â btnStart.addEventListener("click", async () => {
Â Â Â Â if (audioRecActive) return;
Â Â Â Â if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
Â Â Â Â Â Â statusEl.textContent = "æ­¤ç€è¦½å™¨ä¸æ”¯æ´éº¥å…‹é¢¨éŒ„éŸ³ã€‚";
Â Â Â Â Â Â return;
Â Â Â Â }

Â Â Â Â try {
Â Â Â Â Â Â btnStart.disabled = true;
Â Â Â Â Â Â btnStop.disabled = true;
Â Â Â Â Â Â btnCancel.disabled = true;
Â Â Â Â Â Â statusEl.textContent = "æ­£åœ¨å•Ÿç”¨éº¥å…‹é¢¨â€¦";

Â Â Â Â Â Â const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
Â Â Â Â Â Â audioRecStream = stream;
Â Â Â Â Â Â audioRecChunks = [];
Â Â Â Â Â Â window.recordedAudioBlob = null;

Â Â Â Â Â Â const mimeType =
Â Â Â Â Â Â Â Â MediaRecorder.isTypeSupported &&
Â Â Â Â Â Â Â Â MediaRecorder.isTypeSupported("audio/webm;codecs=opus")
Â Â Â Â Â Â Â Â Â Â ? "audio/webm;codecs=opus"
Â Â Â Â Â Â Â Â Â Â : "audio/webm";

Â Â Â Â Â Â const recorder = new MediaRecorder(stream, { mimeType });
Â Â Â Â Â Â audioRecRecorder = recorder;
Â Â Â Â Â Â audioRecActive = true;

Â Â Â Â Â Â recorder.addEventListener("dataavailable", (ev) => {
Â Â Â Â Â Â Â Â if (ev.data && ev.data.size > 0) {
Â Â Â Â Â Â Â Â Â Â audioRecChunks.push(ev.data);
Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â });

Â Â Â Â Â Â recorder.addEventListener("stop", () => {
Â Â Â Â Â Â Â Â // è‹¥æ˜¯ã€Œå–æ¶ˆã€å°è‡´çš„ stopï¼Œåœ¨ stopAudioRecordingInternal è£¡å·²ç¶“æŠŠ cancelOnly=true è™•ç†äº†
Â Â Â Â Â Â Â Â if (!audioRecChunks.length) return;

Â Â Â Â Â Â Â Â const blob = new Blob(audioRecChunks, { type: mimeType });
Â Â Â Â Â Â Â Â window.recordedAudioBlob = blob;

Â Â Â Â Â Â Â Â const url = URL.createObjectURL(blob);
Â Â Â Â Â Â Â Â previewEl.src = url;
Â Â Â Â Â Â Â Â previewEl.play().catch(() => {});

Â Â Â Â Â Â Â Â statusEl.textContent = "éŒ„éŸ³å®Œæˆï¼Œå¯æŒ‰ã€Œç™¼è¡¨ã€å„²å­˜ã€‚";

Â Â Â Â Â Â Â Â btnStart.disabled = false;
Â Â Â Â Â Â Â Â btnStop.disabled = true;
Â Â Â Â Â Â Â Â btnCancel.disabled = false;

Â Â Â Â Â Â Â Â audioRecActive = false;
Â Â Â Â Â Â });

Â Â Â Â Â Â recorder.start();
Â Â Â Â Â Â statusEl.textContent = "éŒ„éŸ³ä¸­â€¦ å†æŒ‰ã€Œâ– ã€åœæ­¢ã€‚";
Â Â Â Â Â Â btnStop.disabled = false;
Â Â Â Â Â Â btnCancel.disabled = false;
Â Â Â Â } catch (err) {
Â Â Â Â Â Â console.error(err);
Â Â Â Â Â Â statusEl.textContent = "ç„¡æ³•å•Ÿç”¨éº¥å…‹é¢¨ï¼ˆå¯èƒ½è¢«æ‹’çµ•æˆ–è£ç½®ä¸æ”¯æ´ï¼‰ã€‚";
Â Â Â Â Â Â btnStart.disabled = false;
Â Â Â Â Â Â btnStop.disabled = true;
Â Â Â Â Â Â btnCancel.disabled = false;
Â Â Â Â }
Â Â });

Â Â btnStop.addEventListener("click", () => {
Â Â Â Â if (!audioRecActive || !audioRecRecorder) return;
Â Â Â Â // æ­£å¸¸çµæŸéŒ„éŸ³ï¼šè®“ recorder çš„ onstop æŠŠ blob å­˜åˆ° recordedAudioBlob
Â Â Â Â audioRecRecorder.stop();
Â Â Â Â // stream åœ¨ onstop è£¡é€é stopAudioRecordingInternal é—œæ‰
Â Â Â Â statusEl.textContent = "è™•ç†éŒ„éŸ³ä¸­â€¦";
Â Â Â Â btnStop.disabled = true;
Â Â });

Â Â btnCancel.addEventListener("click", () => {
Â Â Â Â // å–æ¶ˆï¼šå…¨éƒ¨æ¸…æ‰ï¼Œä¸å­˜ blob
Â Â Â Â if (audioRecActive && audioRecRecorder) {
Â Â Â Â Â Â // é€™è£¡æˆ‘å€‘ç›´æ¥ stopï¼Œå†ç•¶ä½œ cancelOnly è™•ç†
Â Â Â Â Â Â audioRecRecorder.stop();
Â Â Â Â }
Â Â Â Â stopAudioRecordingInternal(true);
Â Â });
}

function setMediaMode(mode) {
Â Â window.currentMediaMode = mode || null;

Â Â const btnYoutube = document.getElementById("btn-media-youtube");
Â Â const btnUploadÂ  = document.getElementById("btn-media-upload");
Â Â const btnAudio Â  = document.getElementById("btn-media-audio");

Â Â const videoFieldsÂ  Â  = document.getElementById("video-fields");
Â Â const audioFieldsÂ  Â  = document.getElementById("audio-fields");
Â Â const youtubeRow Â  Â  = document.getElementById("youtube-row");
Â Â const videoUploadRow = document.getElementById("video-upload-row");

Â Â // æ¸…é™¤ active æ¨£å¼
Â Â [btnYoutube, btnUpload, btnAudio].forEach((b) => {
Â Â Â Â if (b) b.classList.remove("active");
Â Â });

Â Â if (videoFields) videoFields.classList.add("hidden");
Â Â if (audioFields) audioFields.classList.add("hidden");
Â Â if (youtubeRow) youtubeRow.style.display = "none";
Â Â if (videoUploadRow) videoUploadRow.style.display = "none";

Â Â if (!mode) return;

Â Â if (mode === "youtube") {
Â Â Â Â if (btnYoutube) btnYoutube.classList.add("active");
Â Â Â Â if (videoFields) videoFields.classList.remove("hidden");
Â Â Â Â if (youtubeRow) youtubeRow.style.display = "flex";
Â Â } else if (mode === "upload") {
Â Â Â Â if (btnUpload) btnUpload.classList.add("active");
Â Â Â Â if (videoFields) videoFields.classList.remove("hidden");
Â Â Â Â if (videoUploadRow) videoUploadRow.style.display = "flex";
Â Â } else if (mode === "audio") {
Â Â Â Â if (btnAudio) btnAudio.classList.add("active");
Â Â Â Â if (audioFields) audioFields.classList.remove("hidden");
Â Â }
}

// ====== [JS-11] å¾ã€Œæ–°å¢/ç·¨è¼¯ã€å¾©åŸæˆåˆå§‹ç‹€æ…‹ ======
function resetFormToAddMode() {
Â Â const form Â  Â  Â  = document.getElementById("community-form");
Â Â const btnNew Â  Â  = document.getElementById("btn-new");
Â Â const nickEl Â  Â  = document.getElementById("nickname-input");
Â Â const textEl Â  Â  = document.getElementById("text-input");
Â Â const ytEl Â  Â  Â  = document.getElementById("youtube-url-input");
Â Â const startElÂ  Â  = document.getElementById("start-input");
Â Â const endElÂ  Â  Â  = document.getElementById("end-input");
Â Â const videoFileÂ  = document.getElementById("video-file-input");
Â Â const videoLabel = document.getElementById("video-file-label");
Â Â const audioFileÂ  = document.getElementById("audio-file-input");
Â Â const audioLabel = document.getElementById("audio-file-label");

Â Â if (nickEl) {
Â Â Â Â nickEl.value = "";
Â Â Â Â nickEl.placeholder = "Mr,s 09â€¦.";
Â Â Â Â nickEl.disabled = false;
Â Â }
Â Â if (textEl) {
Â Â Â Â textEl.value = "";
Â Â Â Â textEl.disabled = false;
Â Â Â Â textEl.style.opacity = "1";
Â Â }
Â Â if (ytEl) {
Â Â Â Â ytEl.value = "";
Â Â }
Â Â if (startEl) startEl.value = "";
Â Â if (endEl) Â  endEl.value Â  = "";

Â Â if (videoFile) {
Â Â Â Â videoFile.disabled = false;
Â Â Â Â videoFile.value = "";
Â Â }
Â Â if (videoLabel) videoLabel.textContent = "";

Â Â if (audioFile) {
Â Â Â Â audioFile.disabled = false;
Â Â Â Â audioFile.value = "";
Â Â }
Â Â if (audioLabel) audioLabel.textContent = "";

Â Â setMediaMode(null);
Â Â clearRecordedMediaState();

Â Â if (form) {
Â Â Â Â form.classList.add("hidden");
Â Â Â Â form.style.display = "none";
Â Â }
Â Â if (btnNew) {
Â Â Â Â btnNew.textContent = "æ–°å¢";
Â Â }

Â Â isFormOpen = false;

Â Â editState.active = false;
Â Â editState.id = null;
Â Â editState.nickname = "";
Â Â editState.originalText = "";
Â Â editState.waitForSelect = false;

Â Â resetReplyTargetButton();
}

// ====== [JS-12] ç·¨è¼¯æµç¨‹ï¼šæŒ‰ã€Œç·¨è¼¯ã€â†’ è·³å‡ºè¦–çª—è¦æ±‚å…ˆé¸é …ç›® ======
function setupEditHeaderButton() {
Â Â const btn = document.getElementById("btn-edit");
Â Â if (!btn) return;

Â Â btn.addEventListener("click", () => {
Â Â Â Â alert("è«‹åœ¨è¡¨æ ¼é¸æ“‡ä½ è¦ç·¨è¼¯çš„é …ç›®ã€‚");
Â Â Â Â // é€²å…¥ã€Œç­‰å¾…é¸æ“‡é …ç›®ã€æ¨¡å¼
Â Â Â Â editState.waitForSelect = true;
Â Â });
}

function startEditForRow(row) {
Â Â if (!row) return;

Â Â editState.active Â  Â  Â  = true;
Â Â editState.id Â  Â  Â  Â  Â  = row.id;
Â Â editState.nickname Â  Â  = String(row.nickname || "").trim();
Â Â editState.originalText = row.text || "";

Â Â const form Â  = document.getElementById("community-form");
Â Â const btnNew = document.getElementById("btn-new");
Â Â const nickEl = document.getElementById("nickname-input");
Â Â const textEl = document.getElementById("text-input");

Â Â if (form) {
Â Â Â Â form.classList.remove("hidden");
Â Â Â Â form.style.display = "block";
Â Â }
Â Â if (btnNew) {
Â Â Â Â btnNew.textContent = "å–æ¶ˆç·¨è¼¯";
Â Â }
Â Â isFormOpen = true;

Â Â // æ¸…ç©º username â†’ è®“ç”¨æˆ¶è¼¸å…¥åŸæœ¬å§“å
Â Â if (nickEl) {
Â Â Â Â nickEl.disabled = false;
Â Â Â Â nickEl.value = "";
Â Â Â Â nickEl.placeholder = "è«‹è¼¸å…¥åŸæœ¬ username ä»¥é€²è¡Œç·¨è¼¯";
Â Â }

Â Â // èªªæ˜æ¬„å…ˆé–ä½ï¼Œåªé¡¯ç¤ºåŸæœ¬çš„å…§å®¹
Â Â if (textEl) {
Â Â Â Â textEl.value = editState.originalText;
Â Â Â Â textEl.disabled = true;
Â Â Â Â textEl.style.opacity = "0.6";
Â Â }

Â Â // ç·¨è¼¯æ™‚ä¸å…è¨±è®Šå‹•åª’é«”
Â Â setMediaMode(null);
}

// åç¨±é©—è­‰é€šé â†’ è§£é–èªªæ˜æ¬„ä½
function tryUnlockEditByName() {
Â Â if (!editState.active) return;
Â Â if (isComposingName) return;

Â Â const nickEl = document.getElementById("nickname-input");
Â Â const textEl = document.getElementById("text-input");
Â Â if (!nickEl || !textEl) return;

Â Â const typedÂ  = String(nickEl.value || "").trim();
Â Â const target = String(editState.nickname || "").trim();
Â Â if (!typed || !target) return;

Â Â // å…ˆåšæ ¼å¼é©—è­‰ï¼ˆ5â€“12ã€ä¸­è‹±æ–‡/æ•¸å­—ï¼‰
Â Â if (!validateNameLength(typed)) {
Â Â Â Â return;
Â Â }

Â Â // å¿…é ˆã€Œå®Œå…¨ä¸€æ¨£ã€æ‰è§£é–ï¼ˆç´”æ•¸å­—ä¹Ÿå¯ä»¥ï¼‰
Â Â if (typed !== target) return;

Â Â // é€šéï¼šé–ä½ usernameï¼Œè§£é–é …ç›®æ¬„
Â Â nickEl.disabled = true;

Â Â textEl.disabled = false;
Â Â textEl.style.opacity = "1";
Â Â textEl.focus();
Â Â const len = textEl.value.length;
Â Â try {
Â Â Â Â textEl.setSelectionRange(len, len);
Â Â } catch (e) {}
Â Â alert("åç¨±é©—è­‰é€šéï¼Œç¾åœ¨å¯ä»¥ä¿®æ”¹èªªæ˜å…§å®¹ã€‚");
}

// ====== [JS-13] è¡¨æ ¼é»æ“Šï¼šé¸å– / é€²å…¥ç·¨è¼¯ ======
function setupTableClicks() {
Â Â const tbody = document.getElementById("comments-tbody");
Â Â if (!tbody) return;

Â Â tbody.addEventListener("click", (e) => {
Â Â Â Â const playBtn = e.target.closest("button.play-video-btn");
Â Â Â Â if (playBtn) {
Â Â Â Â Â Â const id = playBtn.getAttribute("data-id");
Â Â Â Â Â Â const row = findRowById(id);
Â Â Â Â Â Â if (!row) return;
Â Â Â Â Â Â selectRowForReply(row);
Â Â Â Â Â Â return;
Â Â Â Â }

Â Â Â Â const tr = e.target.closest("tr[data-id]");
Â Â Â Â if (!tr) return;

Â Â Â Â const id = tr.getAttribute("data-id");
Â Â Â Â const row = findRowById(id);
Â Â Â Â if (!row) return;

Â Â Â Â // è‹¥ç·¨è¼¯æ¨¡å¼æ­£ç­‰å¾…é¸é …ç›® â†’ ç›´æ¥é€²å…¥ç·¨è¼¯
Â Â Â Â if (editState.waitForSelect) {
Â Â Â Â Â Â editState.waitForSelect = false;
Â Â Â Â Â Â startEditForRow(row);
Â Â Â Â Â Â return;
Â Â Â Â }

Â Â Â Â // ä¸€èˆ¬é¸å–
Â Â Â Â selectRowForReply(row);
Â Â });
}

// ====== [JS-14] Back éµï¼šå›åˆ°å½±ç‰‡é ‚ç«¯ ======
function setupBackButton() {
Â Â const btn = document.getElementById("back-button");
Â Â if (!btn) return;

Â Â btn.addEventListener("click", () => {
Â Â Â Â scrollToVideoTop();
Â Â });
}

// ====== [JS-15] ç®¡ç†å“¡å›è¦†å€ ======
function setupAdminReply() {
Â Â const box = document.getElementById("admin-reply");
Â Â if (!box) return;

Â Â ensureReplyPrefix();
Â Â autoResizeReply();

Â Â box.addEventListener("input", () => {
Â Â Â Â ensureReplyPrefix();
Â Â Â Â autoResizeReply();
Â Â });

Â Â box.addEventListener("blur", () => {
Â Â Â Â saveAdminReply();
Â Â });
}

// ====== [JS-16] From: æŒ‰éˆ• â†’ å›åˆ°è©²åˆ—ä¸¦å±•é–‹æ–‡å­— ======
function setupReplyTargetButton() {
Â Â const btn = document.getElementById("reply-target-btn");
Â Â if (!btn) return;

Â Â btn.addEventListener("click", () => {
Â Â Â Â const id = btn.getAttribute("data-id");
Â Â Â Â if (!id) return;

Â Â Â Â const tbody = document.getElementById("comments-tbody");
Â Â Â Â if (!tbody) return;

Â Â Â Â const tr = tbody.querySelector(`tr[data-id="${id}"]`);
Â Â Â Â if (!tr) return;

Â Â Â Â const row = findRowById(id);
Â Â Â Â if (!row) return;

Â Â Â Â tr.scrollIntoView({ behavior: "smooth", block: "center" });
Â Â Â Â tr.classList.add("row-flash");
Â Â Â Â setTimeout(() => tr.classList.remove("row-flash"), 800);

Â Â Â Â // è‡ªå‹•å±•é–‹æ–‡å­—ï¼ˆè‹¥ >30 å­—ï¼‰
Â Â Â Â const cell = tr.querySelector("td.col-text");
Â Â Â Â if (cell && String(row.text || "").length > 30) {
Â Â Â Â Â Â cell.innerHTML =
Â Â Â Â Â Â Â Â escapeHtml(row.text) +
Â Â Â Â Â Â Â Â `<span class="expand-arrow" title="æ”¶åˆ">â–²</span>`;
Â Â Â Â Â Â cell.setAttribute("data-expanded", "1");
Â Â Â Â }
Â Â });
}

// ====== [JS-17] username æ³¨éŸ³ä¿è­· + Enter é˜²é€å‡º ======
let isComposingName = false;

function setupEditNameGuard() {
Â Â const nickEl = document.getElementById("nickname-input");
Â Â if (!nickEl) return;

Â Â nickEl.addEventListener("compositionstart", () => {
Â Â Â Â isComposingName = true;
Â Â });
Â Â nickEl.addEventListener("compositionend", () => {
Â Â Â Â isComposingName = false;
Â Â Â Â tryUnlockEditByName();
Â Â });

Â Â nickEl.addEventListener("input",Â  tryUnlockEditByName);
Â Â nickEl.addEventListener("change", tryUnlockEditByName);
Â Â nickEl.addEventListener("blur", Â  tryUnlockEditByName);

Â Â // Enter ä¸é€å‡ºï¼Œåªå˜—è©¦è§£é–
Â Â nickEl.addEventListener("keydown", (ev) => {
Â Â Â Â if (ev.key === "Enter") {
Â Â Â Â Â Â ev.preventDefault();
Â Â Â Â Â Â tryUnlockEditByName();
Â Â Â Â }
Â Â });
}

// é …ç›®æ¬„ä½ Enter å®Œå…¨ç¦æ­¢é€å‡º
function setupTextInputEnterGuard() {
Â Â const textEl = document.getElementById("text-input");
Â Â if (!textEl) return;

Â Â textEl.addEventListener("keydown", (ev) => {
Â Â Â Â if (ev.key === "Enter") {
Â Â Â Â Â Â ev.preventDefault();
Â Â Â Â }
Â Â });
}

// ====== [JS-18] å·¥å…·åˆ— / è¡¨å–® + é€å‡ºè™•ç† ======
async function handleSubmit(e) {
Â Â e.preventDefault();

Â Â const nickElÂ  Â  = document.getElementById("nickname-input");
Â Â const textElÂ  Â  = document.getElementById("text-input");
Â Â const ytElÂ  Â  Â  = document.getElementById("youtube-url-input");
Â Â const startEl Â  = document.getElementById("start-input");
Â Â const endEl Â  Â  = document.getElementById("end-input");
Â Â const videoFile = document.getElementById("video-file-input");
Â Â const audioFile = document.getElementById("audio-file-input");

Â Â const nicknameÂ  = (nickEl?.value || "").trim();
Â Â const textÂ  Â  Â  = (textEl?.value || "").trim();
Â Â const youtubeUrl= (ytEl?.value || "").trim();
Â Â const startSecÂ  = parseTimeToSec(startEl?.value);
Â Â const endSecÂ  Â  = parseTimeToSec(endEl?.value);
Â Â const vFile Â  Â  = videoFile && videoFile.files[0];
Â Â const aFile Â  Â  = audioFile && audioFile.files[0];

Â Â const isEditing = editState.active && editState.id;

Â Â // username é©—è­‰
Â Â if (!validateNameLength(nickname)) {
Â Â Â Â alert("username è«‹ä½¿ç”¨ 5â€“12 å€‹ä¸­è‹±æ–‡æˆ–æ•¸å­—ï¼ˆä¸å«ç©ºç™½èˆ‡ç¬¦è™Ÿï¼‰ã€‚");
Â Â Â Â if (nickEl) nickEl.focus();
Â Â Â Â return;
Â Â }

Â Â if (isEditing) {
Â Â Â Â const target = String(editState.nickname || "").trim();
Â Â Â Â if (nickname !== target) {
Â Â Â Â Â Â alert("è«‹è¼¸å…¥ç•¶åˆå¡«å¯«çš„ usernameï¼ˆéœ€èˆ‡åŸå§‹ç´€éŒ„å®Œå…¨ä¸€è‡´ï¼‰ã€‚");
Â Â Â Â Â Â if (nickEl) nickEl.focus();
Â Â Â Â Â Â return;
Â Â Â Â }
Â Â }

Â Â if (!text) {
Â Â Â Â alert("è«‹å…ˆè¼¸å…¥ã€Œé …ç›®ã€èªªæ˜ï¼ˆ100 å­—å…§ï¼‰ã€‚");
Â Â Â Â if (textEl) textEl.focus();
Â Â Â Â return;
Â Â }
Â Â if (text.length > 100) {
Â Â Â Â alert("èªªæ˜è«‹æ§åˆ¶åœ¨ 100 å­—ä»¥å…§ã€‚");
Â Â Â Â if (textEl) textEl.focus();
Â Â Â Â return;
Â Â }

Â Â // åª’é«”äº’æ–¥ï¼š
Â Â // - YouTube ä¸å¯åŒæ™‚æœ‰å½±ç‰‡æª” / éŒ„éŸ³
Â Â // - å½±ç‰‡ä¸Šå‚³ vs éŒ„å½±ï¼ˆæš«ç„¡éŒ„å½±ï¼Œå¿½ç•¥ï¼‰
Â Â // - éŸ³æª”ä¸Šå‚³ vs éŒ„éŸ³ æ“‡ä¸€
Â Â if (youtubeUrl) {
Â Â Â Â if (vFile || aFile || window.recordedAudioBlob) {
Â Â Â Â Â Â alert("YouTube é€£çµä¸å¯åŒæ™‚æ­é…å½±ç‰‡æª” / éŒ„éŸ³ï¼Œè«‹æ“‡ä¸€ç¨®åª’é«”ä¾†æºã€‚");
Â Â Â Â Â Â return;
Â Â Â Â }
Â Â }

Â Â if (aFile && window.recordedAudioBlob) {
Â Â Â Â alert("éŸ³æª”ä¸Šå‚³èˆ‡éŒ„éŸ³è«‹æ“‡ä¸€ã€‚");
Â Â Â Â return;
Â Â }

Â Â try {
Â Â Â Â // ===== ç·¨è¼¯æ¨¡å¼ï¼šåªæ”¹æ–‡å­— =====
Â Â Â Â if (isEditing) {
Â Â Â Â Â Â const params = new URLSearchParams({
Â Â Â Â Â Â Â Â action: "edit",
Â Â Â Â Â Â Â Â id: String(editState.id),
Â Â Â Â Â Â Â Â text
Â Â Â Â Â Â });
Â Â Â Â Â Â const resÂ  = await fetch(API_URL + "?" + params.toString());
Â Â Â Â Â Â const data = await res.json();

Â Â Â Â Â Â if (!data || data.status !== "ok") {
Â Â Â Â Â Â Â Â throw new Error(data && data.error ? data.error : "edit å¤±æ•—");
Â Â Â Â Â Â }

Â Â Â Â Â Â resetFormToAddMode();
Â Â Â Â Â Â await loadComments();
Â Â Â Â Â Â return;
Â Â Â Â }

Â Â Â Â // ===== æ–°å¢æ¨¡å¼ =====
Â Â Â Â let type = "text";
Â Â Â Â const payload = {
Â Â Â Â Â Â action: "add",
Â Â Â Â Â Â nickname,
Â Â Â Â Â Â text,
Â Â Â Â Â Â startSec: (startSec === "" ? "" : String(startSec)),
Â Â Â Â Â Â endSec: Â  (endSec Â  === "" ? "" : String(endSec))
Â Â Â Â };

Â Â Â Â if (youtubeUrl) {
Â Â Â Â Â Â type = "youtube";
Â Â Â Â Â Â payload.type = type;
Â Â Â Â Â Â payload.youtubeUrl = youtubeUrl;
Â Â Â Â } else if (vFile) {
Â Â Â Â Â Â // å½±ç‰‡ / åœ–ç‰‡ä¸Šå‚³ â†’ ä¸€å¾‹ç•¶æˆ upload
Â Â Â Â Â Â type = "upload";
Â Â Â Â Â Â payload.type = type;

Â Â Â Â Â Â const base64 Â  = await readFileAsBase64(vFile);
Â Â Â Â Â Â const mimeType = vFile.type || "application/octet-stream";
Â Â Â Â Â Â const fileName = vFile.name || ("video_" + Date.now());

Â Â Â Â Â Â payload.videoBase64 = base64;
Â Â Â Â Â Â payload.mimeType = mimeType;
Â Â Â Â Â Â payload.fileName = fileName;
Â Â Â Â } else if (aFile || window.recordedAudioBlob) {
Â Â Â Â Â Â // éŒ„éŸ³ï¼ˆä¸Šå‚³éŸ³æª” or ç›´æ¥éŒ„éŸ³ï¼‰
Â Â Â Â Â Â type = "audio";
Â Â Â Â Â Â payload.type = type;

Â Â Â Â Â Â let blobToUse = null;
Â Â Â Â Â Â let mimeTypeÂ  = "audio/webm";
Â Â Â Â Â Â let fileNameÂ  = "audio_" + Date.now() + ".webm";

Â Â Â Â Â Â if (aFile) {
Â Â Â Â Â Â Â Â blobToUse = aFile;
Â Â Â Â Â Â Â Â mimeTypeÂ  = aFile.type || mimeType;
Â Â Â Â Â Â Â Â fileNameÂ  = aFile.name || fileName;
Â Â Â Â Â Â } else if (window.recordedAudioBlob) {
Â Â Â Â Â Â Â Â blobToUse = window.recordedAudioBlob;
Â Â Â Â Â Â Â Â mimeTypeÂ  = window.recordedAudioBlob.type || mimeType;
Â Â Â Â Â Â }

Â Â Â Â Â Â if (blobToUse) {
Â Â Â Â Â Â Â Â const base64 = await readFileAsBase64(blobToUse);
Â Â Â Â Â Â Â Â payload.audioBase64Â  Â  = base64;
Â Â Â Â Â Â Â Â payload.audioMimeTypeÂ  = mimeType;
Â Â Â Â Â Â Â Â payload.audioFileNameÂ  = fileName;
Â Â Â Â Â Â }
Â Â Â Â } else {
Â Â Â Â Â Â payload.type = "text";
Â Â Â Â }

Â Â Â Â const res = await fetch(API_URL, {
Â Â Â Â Â Â method: "POST",
Â Â Â Â Â Â headers: { "Content-Type": "text/plain;charset=utf-8" },
Â Â Â Â Â Â body: JSON.stringify(payload),
Â Â Â Â });

Â Â Â Â let data;
Â Â Â Â try {
Â Â Â Â Â Â data = await res.json();
Â Â Â Â } catch (err) {
Â Â Â Â Â Â throw new Error("ç„¡æ³•è§£æä¼ºæœå™¨å›æ‡‰ï¼ˆå¯èƒ½æ˜¯æ¬Šé™æˆ– CORS å•é¡Œï¼‰");
Â Â Â Â }

Â Â Â Â if (!data || data.status !== "ok") {
Â Â Â Â Â Â throw new Error(data && data.error ? data.error : "add å¤±æ•—");
Â Â Â Â }

Â Â Â Â resetFormToAddMode();
Â Â Â Â await loadComments();
Â Â } catch (err) {
Â Â Â Â console.error(err);
Â Â Â Â alert((isEditing ? "å„²å­˜æ–‡å­—ä¿®æ”¹å¤±æ•—ï¼š" : "é€å‡ºç•™è¨€å¤±æ•—ï¼š") + err.message);
Â Â }
}

function bindToolbarAndForm() {
Â Â const formÂ  Â  Â  Â  Â  = document.getElementById("community-form");
Â Â const btnNewÂ  Â  Â  Â  = document.getElementById("btn-new");
Â Â const btnYoutubeÂ  Â  = document.getElementById("btn-media-youtube");
Â Â const btnUpload Â  Â  = document.getElementById("btn-media-upload");
Â Â const btnAudioÂ  Â  Â  = document.getElementById("btn-media-audio");
Â Â const videoFile Â  Â  = document.getElementById("video-file-input");
Â Â const videoLabelÂ  Â  = document.getElementById("video-file-label");
Â Â const audioFile Â  Â  = document.getElementById("audio-file-input");
Â Â const audioLabelÂ  Â  = document.getElementById("audio-file-label");
Â Â const ytElÂ  Â  Â  Â  Â  = document.getElementById("youtube-url-input");
Â Â const startEl Â  Â  Â  = document.getElementById("start-input");
Â Â const endEl Â  Â  Â  Â  = document.getElementById("end-input");

Â Â if (!form) return;

Â Â form.classList.add("hidden");
Â Â form.style.display = "none";
Â Â setMediaMode(null);
Â Â isFormOpen = false;

Â Â // æ–°å¢ / å–æ¶ˆ
Â Â if (btnNew) {
Â Â Â Â btnNew.addEventListener("click", () => {
Â Â Â Â Â Â if (!isFormOpen) {
Â Â Â Â Â Â Â Â // é–‹å•Ÿã€Œæ–°å¢ã€æ¨¡å¼
Â Â Â Â Â Â Â Â editState.active = false;
Â Â Â Â Â Â Â Â editState.id = null;
Â Â Â Â Â Â Â Â editState.nickname = "";
Â Â Â Â Â Â Â Â editState.originalText = "";
Â Â Â Â Â Â Â Â editState.waitForSelect = false;

Â Â Â Â Â Â Â Â form.classList.remove("hidden");
Â Â Â Â Â Â Â Â form.style.display = "block";
Â Â Â Â Â Â Â Â btnNew.textContent = "å–æ¶ˆç·¨è¼¯";
Â Â Â Â Â Â Â Â isFormOpen = true;

Â Â Â Â Â Â Â Â setMediaMode(null);
Â Â Â Â Â Â Â Â clearRecordedMediaState();
Â Â Â Â Â Â } else {
Â Â Â Â Â Â Â Â resetFormToAddMode();
Â Â Â Â Â Â }
Â Â Â Â });
Â Â }

Â Â // ä¸‰é¡†åª’é«”æŒ‰éˆ•ï¼šåˆ‡æ›æ¨¡å¼ï¼ˆé»åŒä¸€é¡† â†’ é—œé–‰ï¼‰
Â Â function bindMediaButton(btn, modeName) {
Â Â Â Â if (!btn) return;
Â Â Â Â btn.addEventListener("click", () => {
Â Â Â Â Â Â if (editState.active) return; // ç·¨è¼¯æ¨¡å¼ä¸å…è¨±æ”¹åª’é«”
Â Â Â Â Â Â if (btn.disabled) return;

Â Â Â Â Â Â if (window.currentMediaMode === modeName) {
Â Â Â Â Â Â Â Â setMediaMode(null);
Â Â Â Â Â Â } else {
Â Â Â Â Â Â Â Â setMediaMode(modeName);
Â Â Â Â Â Â }
Â Â Â Â Â Â clearRecordedMediaState();

Â Â Â Â Â Â // åˆ‡æ›åª’é«”æ™‚ï¼ŒæŠŠä¸ç›¸é—œçš„æ¬„ä½æ¸…ä¹¾æ·¨
Â Â Â Â Â Â if (modeName === "youtube") {
Â Â Â Â Â Â Â Â if (videoFile)Â  videoFile.value = "";
Â Â Â Â Â Â Â Â if (videoLabel) videoLabel.textContent = "";
Â Â Â Â Â Â Â Â if (audioFile)Â  audioFile.value = "";
Â Â Â Â Â Â Â Â if (audioLabel) audioLabel.textContent = "";
Â Â Â Â Â Â } else if (modeName === "upload") {
Â Â Â Â Â Â Â Â if (ytEl) Â  Â  ytEl.value = "";
Â Â Â Â Â Â Â Â if (startEl)Â  startEl.value = "";
Â Â Â Â Â Â Â Â if (endEl)Â  Â  endEl.value = "";
Â Â Â Â Â Â Â Â if (audioFile)Â  audioFile.value = "";
Â Â Â Â Â Â Â Â if (audioLabel) audioLabel.textContent = "";
Â Â Â Â Â Â } else if (modeName === "audio") {
Â Â Â Â Â Â Â Â if (ytEl) Â  Â  ytEl.value = "";
Â Â Â Â Â Â Â Â if (startEl)Â  startEl.value = "";
Â Â Â Â Â Â Â Â if (endEl)Â  Â  endEl.value = "";
Â Â Â Â Â Â Â Â if (videoFile)Â  videoFile.value = "";
Â Â Â Â Â Â Â Â if (videoLabel) videoLabel.textContent = "";
Â Â Â Â Â Â }
Â Â Â Â });
Â Â }

Â Â bindMediaButton(btnYoutube, "youtube");
Â Â bindMediaButton(btnUpload,Â  "upload");
Â Â bindMediaButton(btnAudio, Â  "audio");

Â Â // æª”æ¡ˆ change â†’ é¡¯ç¤ºæª”å
Â Â if (videoFile && videoLabel) {
Â Â Â Â videoFile.addEventListener("change", () => {
Â Â Â Â Â Â if (videoFile.files && videoFile.files[0]) {
Â Â Â Â Â Â Â Â videoLabel.textContent = "å·²é¸æ“‡ï¼š" + videoFile.files[0].name;
Â Â Â Â Â Â } else {
Â Â Â Â Â Â Â Â videoLabel.textContent = "";
Â Â Â Â Â Â }
Â Â Â Â });
Â Â }

Â Â if (audioFile && audioLabel) {
Â Â Â Â audioFile.addEventListener("change", () => {
Â Â Â Â Â Â if (audioFile.files && audioFile.files[0]) {
Â Â Â Â Â Â Â Â audioLabel.textContent = "å·²é¸æ“‡ï¼š" + audioFile.files[0].name;
Â Â Â Â Â Â } else {
Â Â Â Â Â Â Â Â audioLabel.textContent = "";
Â Â Â Â Â Â }
Â Â Â Â });
Â Â }

Â Â form.addEventListener("submit", handleSubmit);
}

// ====== [JS-19] DOMContentLoadedï¼šå…¨éƒ¨å•Ÿå‹• ======
document.addEventListener("DOMContentLoaded", () => {
Â Â // å…¨åŸŸåª’é«”ç‹€æ…‹
Â Â window.currentMediaMode = null;

Â Â // å·¥å…·åˆ— / è¡¨å–®
Â Â bindToolbarAndForm();

Â Â // è¡¨æ ¼é»æ“Š
Â Â setupTableClicks();

Â Â // Back éµ
Â Â setupBackButton();

Â Â // ç®¡ç†å“¡å›è¦†å€
Â Â setupAdminReply();

Â Â // é ‚éƒ¨ã€Œç·¨è¼¯ã€æŒ‰éˆ•
Â Â setupEditHeaderButton();

Â Â // From: æŒ‰éˆ•
Â Â setupReplyTargetButton();

Â // å·¦å´éŒ„éŸ³é¢æ¿
Â Â setupAudioRecording();


Â Â // username æ³¨éŸ³çµ„å­—ä¿è­· + Enter é˜²é€å‡º
Â Â setupEditNameGuard();

Â Â // é …ç›®æ¬„ä½ Enter é˜²èª¤é€å‡º
Â Â setupTextInputEnterGuard();

Â Â // ä¸€é–‹å§‹æ¸…ç©ºå½±ç‰‡
Â Â clearVideo();

Â Â // è¼‰å…¥ç•™è¨€åˆ—è¡¨
Â Â loadComments().catch((err) => {
Â Â Â Â console.error(err);
Â Â Â Â alert("è¼‰å…¥åˆ—è¡¨å¤±æ•—ï¼š" + err.message);
Â Â });
});
</script>


</body>
</html>



