<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>StradTone Grid Editor v1</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    body {
      margin: 0;
      font-family: "Microsoft JhengHei", system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      background: #f3f3f3;
    }
    #app {
      display: flex;
      height: 100vh;
      box-sizing: border-box;
    }
    #editorArea {
      flex: 3;
      padding: 16px;
      overflow: auto;
    }
    #sidePanel {
      flex: 1;
      border-left: 1px solid #ddd;
      background: #ffffff;
      padding: 12px;
      box-sizing: border-box;
      font-size: 14px;
    }
    h1 {
      font-size: 20px;
      margin: 0 0 8px;
    }
    .toolbar {
      margin-bottom: 10px;
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }
    button {
      cursor: pointer;
      padding: 4px 10px;
      font-size: 13px;
    }

    /* Grid 本體 */
    .grid {
      max-width: 1200px;
      margin: 0 auto;
      background: #fafafa;
      padding: 10px;
      border-radius: 6px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      display: grid;
      grid-template-columns: repeat(12, 1fr);
      grid-auto-rows: 120px;
      gap: 6px;
    }

    .cell {
      border: 1px dashed #c0c0c0;
      border-radius: 4px;
      background: #ffffff;
      padding: 6px;
      box-sizing: border-box;
      overflow: hidden;
      font-size: 13px;
      position: relative;
      cursor: pointer;
    }
    .cell.empty::before {
      content: "格子";
      position: absolute;
      inset: 4px;
      font-size: 11px;
      color: #bbbbbb;
      display: flex;
      align-items: center;
      justify-content: center;
      pointer-events: none;
    }
    .cell.selected {
      border: 2px solid #0070ff;
    }
    .cell-text {
      font-size: 14px;
      line-height: 1.5;
      word-break: break-word;
    }
    .cell img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 3px;
    }
    .cell iframe {
      width: 100%;
      height: 100%;
      border: none;
      border-radius: 3px;
    }

    /* side panel */
    .field {
      margin-bottom: 10px;
    }
    .field label {
      display: block;
      font-size: 12px;
      margin-bottom: 2px;
      color: #444;
    }
    .field input[type="text"],
    .field textarea,
    .field select {
      width: 100%;
      box-sizing: border-box;
      padding: 4px 6px;
      font-size: 13px;
      border-radius: 3px;
      border: 1px solid #ccc;
      font-family: inherit;
    }
    .field textarea {
      min-height: 70px;
      resize: vertical;
    }
    .field small {
      display: block;
      color: #888;
      font-size: 11px;
    }
    .groupTitle {
      font-weight: bold;
      margin: 6px 0 4px;
      padding-top: 4px;
      border-top: 1px dashed #ddd;
      font-size: 13px;
    }
    #exportArea {
      width: 100%;
      height: 160px;
      margin-top: 8px;
      font-family: monospace;
      font-size: 11px;
      white-space: pre;
    }
  </style>
</head>
<body>
<div id="app">
  <div id="editorArea">
    <h1>StradTone 萬用格子編輯器 v1</h1>
    <div class="toolbar">
      <button id="btnAddRow">＋ 新增一列</button>
      <button id="btnExport">匯出 HTML</button>
      <small>（點格子 → 右側設定內容 / 顏色 / 欄寬）</small>
    </div>
    <div id="grid" class="grid"></div>
  </div>

  <div id="sidePanel">
    <div id="noSelection">
      目前未選取格子。<br>
      請在左邊點選任一格開始編輯。
    </div>

    <div id="editorPanel" style="display:none;">
      <div class="field">
        <label>目前格子位置</label>
        <div id="cellPosition" style="font-size:12px;color:#555;"></div>
      </div>

      <div class="groupTitle">內容類型</div>
      <div class="field">
        <label for="contentType">類型</label>
        <select id="contentType">
          <option value="text">文字</option>
          <option value="image">圖片（網址）</option>
          <option value="video">影片（iframe/YouTube）</option>
          <option value="html">自訂 HTML</option>
        </select>
      </div>

      <div class="field">
        <label for="contentInput">內容</label>
        <textarea id="contentInput"></textarea>
        <small>
          文字：直接輸入文字。<br>
          圖片：填圖片網址。<br>
          影片：填 YouTube embed 或 Google Drive iframe src。<br>
          HTML：貼入完整 HTML 片段。
        </small>
      </div>

      <div class="groupTitle">樣式</div>
      <div class="field">
        <label for="bgColorInput">背景色（例如 #f4e4c1 或 transparent）</label>
        <input type="text" id="bgColorInput" placeholder="#ffffff">
      </div>
      <div class="field">
        <label for="textColorInput">文字顏色（文字型內容適用）</label>
        <input type="text" id="textColorInput" placeholder="#222222">
      </div>

      <div class="groupTitle">欄寬（左右合併 / 拆分）</div>
      <div class="field">
        <label>目前欄寬：<span id="colSpanLabel">1</span> 欄（最多 12）</label>
        <button id="btnWider">⟶ 加寬一欄</button>
        <button id="btnNarrower">⟵ 縮窄一欄</button>
        <small>註：暫時只做左右合併，row-span 之後可以再加。</small>
      </div>
    </div>

    <div class="groupTitle">匯出結果（只讀）</div>
    <textarea id="exportArea" readonly placeholder="按『匯出 HTML』會在這裡出現可貼用的 HTML"></textarea>
  </div>
</div>

<script>
  const COLS = 12;
  let currentRows = 4; // 初始列數
  const gridEl = document.getElementById('grid');
  const editorPanel = document.getElementById('editorPanel');
  const noSelection = document.getElementById('noSelection');

  const cellPositionEl = document.getElementById('cellPosition');
  const contentTypeEl = document.getElementById('contentType');
  const contentInputEl = document.getElementById('contentInput');
  const bgColorInputEl = document.getElementById('bgColorInput');
  const textColorInputEl = document.getElementById('textColorInput');
  const colSpanLabelEl = document.getElementById('colSpanLabel');

  const exportAreaEl = document.getElementById('exportArea');

  let selectedCell = null;

  function createGrid(rows) {
    gridEl.innerHTML = '';
    for (let r = 1; r <= rows; r++) {
      for (let c = 1; c <= COLS; c++) {
        const cell = document.createElement('div');
        cell.className = 'cell empty';
        cell.dataset.row = r;
        cell.dataset.col = c;
        cell.dataset.colSpan = 1;
        cell.addEventListener('click', () => onCellClick(cell));
        gridEl.appendChild(cell);
      }
    }
  }

  function onCellClick(cell) {
    if (selectedCell) {
      selectedCell.classList.remove('selected');
    }
    selectedCell = cell;
    selectedCell.classList.add('selected');

    noSelection.style.display = 'none';
    editorPanel.style.display = 'block';

    const row = cell.dataset.row;
    const col = cell.dataset.col;
    const colSpan = parseInt(cell.dataset.colSpan || '1', 10);

    cellPositionEl.textContent = `第 ${row} 列，第 ${col} 欄，寬度 ${colSpan} 欄`;
    colSpanLabelEl.textContent = colSpan.toString();

    const type = cell.dataset.type || 'text';
    contentTypeEl.value = type;

    contentInputEl.value = cell.dataset.rawContent || '';
    bgColorInputEl.value = cell.style.backgroundColor || '';
    textColorInputEl.value = cell.style.color || '';
  }

  function applyCellContent() {
    if (!selectedCell) return;

    const type = contentTypeEl.value;
    const content = contentInputEl.value.trim();
    const bgColor = bgColorInputEl.value.trim();
    const textColor = textColorInputEl.value.trim();

    selectedCell.dataset.type = type;
    selectedCell.dataset.rawContent = content;

    selectedCell.classList.remove('empty');

    let inner = '';
    if (!content) {
      selectedCell.classList.add('empty');
      selectedCell.innerHTML = '';
    } else {
      if (type === 'text') {
        inner = `<div class="cell-text">${escapeHtml(content).replace(/\n/g, '<br>')}</div>`;
      } else if (type === 'image') {
        inner = `<img src="${content}">`;
      } else if (type === 'video') {
        inner = `<iframe src="${content}" allowfullscreen></iframe>`;
      } else if (type === 'html') {
        inner = content;
      }
      selectedCell.innerHTML = inner;
    }

    selectedCell.style.backgroundColor = bgColor || '';
    selectedCell.style.color = textColor || '';
  }

  function escapeHtml(text) {
    const map = {
      '&': '&amp;',
      '<': '&lt;',
      '>': '&gt;',
      '"': '&quot;',
      "'": '&#039;'
    };
    return text.replace(/[&<>"']/g, m => map[m]);
  }

  contentTypeEl.addEventListener('change', applyCellContent);
  contentInputEl.addEventListener('input', applyCellContent);
  bgColorInputEl.addEventListener('input', applyCellContent);
  textColorInputEl.addEventListener('input', applyCellContent);

  document.getElementById('btnAddRow').addEventListener('click', () => {
    const startRow = currentRows + 1;
    currentRows += 1;
    for (let c = 1; c <= COLS; c++) {
      const cell = document.createElement('div');
      cell.className = 'cell empty';
      cell.dataset.row = startRow;
      cell.dataset.col = c;
      cell.dataset.colSpan = 1;
      cell.addEventListener('click', () => onCellClick(cell));
      gridEl.appendChild(cell);
    }
  });

  document.getElementById('btnWider').addEventListener('click', () => {
    if (!selectedCell) return;
    let colSpan = parseInt(selectedCell.dataset.colSpan || '1', 10);
    const col = parseInt(selectedCell.dataset.col || '1', 10);
    if (col + colSpan - 1 >= COLS) return;
    colSpan += 1;
    selectedCell.dataset.colSpan = colSpan;
    selectedCell.style.gridColumn = `${col} / span ${colSpan}`;
    colSpanLabelEl.textContent = colSpan.toString();
    cellPositionEl.textContent = `第 ${selectedCell.dataset.row} 列，第 ${col} 欄，寬度 ${colSpan} 欄`;
  });

  document.getElementById('btnNarrower').addEventListener('click', () => {
    if (!selectedCell) return;
    let colSpan = parseInt(selectedCell.dataset.colSpan || '1', 10);
    const col = parseInt(selectedCell.dataset.col || '1', 10);
    if (colSpan <= 1) return;
    colSpan -= 1;
    selectedCell.dataset.colSpan = colSpan;
    selectedCell.style.gridColumn = `${col} / span ${colSpan}`;
    colSpanLabelEl.textContent = colSpan.toString();
    cellPositionEl.textContent = `第 ${selectedCell.dataset.row} 列，第 ${col} 欄，寬度 ${colSpan} 欄`;
  });

  document.getElementById('btnExport').addEventListener('click', () => {
    const clone = gridEl.cloneNode(true);
    clone.querySelectorAll('.cell').forEach(cell => {
      cell.classList.remove('selected');
      cell.classList.remove('empty');
      cell.removeAttribute('data-row');
      cell.removeAttribute('data-col');
      cell.removeAttribute('data-col-span');
      cell.removeAttribute('data-type');
      cell.removeAttribute('data-raw-content');
    });
    const html = clone.outerHTML;
    exportAreaEl.value = html;
  });

  createGrid(currentRows);
</script>
</body>
</html>
