<!DOCTYPE html>
<html lang="zh-Hant">
<head>
Â Â <meta charset="UTF-8" />
Â Â <meta name="viewport" content="width=device-width, initial-scale=1.0" />
Â Â <meta name="referrer" content="strict-origin-when-cross-origin" />
Â Â <title>StradTone Violin</title>

Â Â <style>
Â Â Â Â /*
Â Â Â Â Â * ç¨‹å¼ç¢¼å¤¥ä¼´ä¿®æ”¹ï¼š
Â Â Â Â Â * 1. ç§»é™¤ comments-wrapper çš„ overflow-y: autoï¼Œä»¥é¿å…åœ¨ iframe å…§å±¤ç”¢ç”Ÿæ»¾å‹•æ¢ï¼Œ
Â Â Â Â Â * é€²è€Œè§£æ±ºæ‰‹æ©Ÿä¸Šæ‹–æ‹‰é‚Šç•Œä¸å‹•çš„å•é¡Œã€‚
Â Â Â Â Â * 2. åœ¨æ‰‹æ©Ÿç‰ˆä¸­ï¼Œå°‡æ‰€æœ‰ä¸»è¦çš„ç‰ˆé¢çµæ§‹çš„ overflow è¨­ç‚º visibleï¼Œè®“æ»¾å‹•äº¤ç”±å¤–éƒ¨ Google Sites Iframe è™•ç†ã€‚
Â Â Â Â */
Â Â Â Â * { box-sizing: border-box; }

Â Â Â Â body {
Â Â Â Â Â Â margin: 0;
Â Â Â Â Â Â font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Arial, "Microsoft JhengHei", sans-serif;
Â Â Â Â Â Â background: #222629;
Â Â Â Â Â Â color: #f5f5f5;
Â Â Â Â Â Â overflow-y: visible !important;
Â Â Â Â }

Â Â Â Â .page {
Â Â Â Â Â Â min-height: 100vh;
Â Â Â Â Â Â padding: 12px;
Â Â Â Â Â Â max-width: 1100px;
Â Â Â Â Â Â margin: 0 auto;
Â Â Â Â }

Â Â Â Â header {
Â Â Â Â Â Â margin-bottom: 10px;
Â Â Â Â Â Â display: flex;
Â Â Â Â Â Â justify-content: space-between;
Â Â Â Â Â Â align-items: baseline;
Â Â Â Â Â Â gap: 8px;
Â Â Â Â Â Â flex-wrap: wrap;
Â Â Â Â }

Â Â Â Â header h1 { font-size: 20px; margin: 0; }
Â Â Â Â header h2 { font-size: 14px; margin: 0; opacity: 0.8; }
Â Â Â Â header small { font-size: 12px; opacity: 0.7; }

Â Â Â Â main.layout {
Â Â Â Â Â Â display: flex;
Â Â Â Â Â Â gap: 12px;
Â Â Â Â Â Â align-items: stretch;
Â Â Â Â }

Â Â Â Â .panel {
Â Â Â Â Â Â background: #2d3236;
Â Â Â Â Â Â border-radius: 8px;
Â Â Â Â Â Â padding: 10px;
Â Â Â Â Â Â box-shadow: 0 0 8px rgba(0, 0, 0, 0.35);
Â Â Â Â Â Â min-height: 220px;
Â Â Â Â }

Â Â Â Â .panel-leftÂ  { flex: 0 0 40%; max-width: 40%; display: flex; flex-direction: column; }
Â Â Â Â .panel-right { flex: 0 0 60%; max-width: 60%; display: flex; flex-direction: column; }

Â Â Â Â h2 { font-size: 16px; margin: 0 0 4px; }

Â Â Â Â .hint,
Â Â Â Â .reply-note {
Â Â Â Â Â Â font-size: 12px;
Â Â Â Â Â Â line-height: 1.4;
Â Â Â Â Â Â color: #222629;
Â Â Â Â }

Â Â Â Â .hidden { display: none !important; }

Â Â Â Â input::placeholder,
Â Â Â Â textarea::placeholder {
Â Â Â Â Â Â color: #999;
Â Â Â Â Â Â opacity: 0.7;
Â Â Â Â }
Â Â Â Â input::-webkit-input-placeholder,
Â Â Â Â textarea::-webkit-input-placeholder {
Â Â Â Â Â Â color: #999;
Â Â Â Â Â Â opacity: 0.7;
Â Â Â Â }

Â Â Â Â /* å·¦å´ï¼šå·¥å…·åˆ— + è¡¨å–® */

Â Â Â Â .toolbar {
Â Â Â Â Â Â display: flex;
Â Â Â Â Â Â gap: 6px;
Â Â Â Â Â Â margin-bottom: 6px;
Â Â Â Â Â Â flex-wrap: wrap;
Â Â Â Â }

Â Â Â Â .toolbar button {
Â Â Â Â Â Â padding: 4px 10px;
Â Â Â Â Â Â border-radius: 14px;
Â Â Â Â Â Â border: 1px solid #777;
Â Â Â Â Â Â background: #3a3f44;
Â Â Â Â Â Â color: #f5f5f5;
Â Â Â Â Â Â font-size: 12px;
Â Â Â Â Â Â cursor: pointer;
Â Â Â Â }
Â Â Â Â .toolbar button:hover { background: #4a5056; }

Â Â Â Â form#community-form {
Â Â Â Â Â Â display: flex;
Â Â Â Â Â Â flex-direction: column;
Â Â Â Â Â Â gap: 6px;
Â Â Â Â Â Â margin-bottom: 8px;
Â Â Â Â Â Â padding: 10px;
Â Â Â Â Â Â border-radius: 6px;
Â Â Â Â Â Â border: 1px solid #777;
Â Â Â Â Â Â background: #111417;
Â Â Â Â }

Â Â Â Â form#community-form.form-open-state {
Â Â Â Â Â Â border-color: #ffcc55;
Â Â Â Â Â Â box-shadow: 0 0 0 1px #ffcc55;
Â Â Â Â Â Â background: #151b22;
Â Â Â Â }

Â Â Â Â form#community-form label {
Â Â Â Â Â Â font-size: 13px;
Â Â Â Â Â Â display: block;
Â Â Â Â }

Â Â Â Â form#community-form input[type="text"] {
Â Â Â Â Â Â width: 100%;
Â Â Â Â Â Â padding: 4px 6px;
Â Â Â Â Â Â margin-top: 2px;
Â Â Â Â Â Â border-radius: 4px;
Â Â Â Â Â Â border: 1px solid #555;
Â Â Â Â Â Â background: #1f2326;
Â Â Â Â Â Â color: #f5f5f5;
Â Â Â Â Â Â font-size: 13px;
Â Â Â Â }

Â Â Â Â form#community-form input[type="text"]:not(:disabled) {
Â Â Â Â Â Â background: #ffffff;
Â Â Â Â Â Â color: #111;
Â Â Â Â }

Â Â Â Â form#community-form input[type="text"]:disabled {
Â Â Â Â Â Â background: #1f2326;
Â Â Â Â Â Â color: #999;
Â Â Â Â }

Â Â Â Â #record-btn {
Â Â Â Â Â Â padding: 4px 10px;
Â Â Â Â Â Â border-radius: 16px;
Â Â Â Â Â Â border: 1px solid #777;
Â Â Â Â Â Â background: #3a3f44;
Â Â Â Â Â Â color: #f5f5f5;
Â Â Â Â Â Â font-size: 12px;
Â Â Â Â Â Â cursor: not-allowed;
Â Â Â Â Â Â opacity: 0.6;
Â Â Â Â }

Â Â Â Â .form-row-inline {
Â Â Â Â Â Â display: flex;
Â Â Â Â Â Â flex-wrap: wrap;
Â Â Â Â Â Â gap: 6px;
Â Â Â Â Â Â align-items: center;
Â Â Â Â }

Â Â Â Â #video-file-input {
Â Â Â Â Â Â font-size: 11px;
Â Â Â Â }

Â Â Â Â #video-file-label {
Â Â Â Â Â Â font-size: 11px;
Â Â Â Â Â Â opacity: 0.8;
Â Â Â Â }

Â Â Â Â #submit-btn {
Â Â Â Â Â Â padding: 4px 14px;
Â Â Â Â Â Â border-radius: 16px;
Â Â Â Â Â Â border: none;
Â Â Â Â Â Â background: #d1a343;
Â Â Â Â Â Â color: #1d1d1d;
Â Â Â Â Â Â font-size: 13px;
Â Â Â Â Â Â cursor: pointer;
Â Â Â Â }
Â Â Â Â #submit-btn:disabled {
Â Â Â Â Â Â opacity: 0.5;
Â Â Â Â Â Â cursor: default;
Â Â Â Â }
Â Â Â Â #submit-btn:not(:disabled):hover { background: #e0b85f; }

Â Â Â Â .sub-hint {
Â Â Â Â Â Â font-size: 11px;
Â Â Â Â Â Â opacity: 0.8;
Â Â Â Â }

Â Â Â Â .media-select-row {
Â Â Â Â Â Â margin: 4px 0 2px;
Â Â Â Â Â Â gap: 6px;
Â Â Â Â }

Â Â Â Â .media-select-btn {
Â Â Â Â Â Â padding: 3px 10px;
Â Â Â Â Â Â border-radius: 14px;
Â Â Â Â Â Â border: 1px solid #777;
Â Â Â Â Â Â background: #3a3f44;
Â Â Â Â Â Â color: #f5f5f5;
Â Â Â Â Â Â font-size: 12px;
Â Â Â Â Â Â cursor: pointer;
Â Â Â Â Â Â opacity: 0.9;
Â Â Â Â }
Â Â Â Â .media-select-btn#btn-media-youtube {
Â Â Â Â Â Â background: #cc0000;
Â Â Â Â Â Â border-color: #ff0000;
Â Â Â Â }
Â Â Â Â .media-select-btn#btn-media-youtube:hover {
Â Â Â Â Â Â background: #ff0000;
Â Â Â Â }
Â Â Â Â .media-select-btn.active {
Â Â Â Â Â Â border-color: #d1a343;
Â Â Â Â Â Â background: #e0b85f;
Â Â Â Â Â Â color: #1d1d1d;
Â Â Â Â Â Â font-weight: 600;
Â Â Â Â }

Â Â Â Â .media-record-toolbar {
Â Â Â Â Â Â display: flex;
Â Â Â Â Â Â align-items: center;
Â Â Â Â Â Â gap: 6px;
Â Â Â Â Â Â margin-top: 4px;
Â Â Â Â Â Â font-size: 11px;
Â Â Â Â }

Â Â Â Â .media-record-btn {
Â Â Â Â Â Â width: 26px;
Â Â Â Â Â Â height: 26px;
Â Â Â Â Â Â border-radius: 50%;
Â Â Â Â Â Â border: 1px solid #777;
Â Â Â Â Â Â background: #3a3f44;
Â Â Â Â Â Â color: #f5f5f5;
Â Â Â Â Â Â font-size: 14px;
Â Â Â Â Â Â cursor: pointer;
Â Â Â Â Â Â display: flex;
Â Â Â Â Â Â align-items: center;
Â Â Â Â Â Â justify-content: center;
Â Â Â Â }
Â Â Â Â .media-record-btn[disabled] {
Â Â Â Â Â Â opacity: 0.5;
Â Â Â Â Â Â cursor: default;
Â Â Â Â }

Â Â Â Â .media-record-status {
Â Â Â Â Â Â font-size: 11px;
Â Â Â Â Â Â opacity: 0.8;
Â Â Â Â }

Â Â Â Â .rec-preview {
Â Â Â Â Â Â width: 100%;
Â Â Â Â Â Â max-height: 140px;
Â Â Â Â Â Â border-radius: 4px;
Â Â Â Â Â Â border: 1px solid #444;
Â Â Â Â Â Â background: #111;
Â Â Â Â }

Â Â Â Â /* å·¦å´ï¼šç•™è¨€è¡¨æ ¼ - ä¿®æ”¹æ­¤è™•ï¼Œç§»é™¤å…§éƒ¨æ»¾å‹•æ¢ */

Â Â Â Â .comments-wrapper {
Â Â Â Â Â Â flex: 1 1 auto;
Â Â Â Â Â Â overflow-y: visible;
Â Â Â Â Â Â overflow-x: hidden;
Â Â Â Â Â Â border-radius: 6px;
Â Â Â Â Â Â border: 1px solid #444;
Â Â Â Â Â Â background: #202427;
Â Â Â Â Â Â height: auto;
Â Â Â Â }

Â Â Â Â table#comments-table {
Â Â Â Â Â Â width: 100%;
Â Â Â Â Â Â border-collapse: collapse;
Â Â Â Â Â Â font-size: 12px;
Â Â Â Â Â Â table-layout: fixed;
Â Â Â Â }

Â Â Â Â table#comments-table thead {
Â Â Â Â Â Â position: sticky;
Â Â Â Â Â Â top: 0;
Â Â Â Â Â Â background: #33383c;
Â Â Â Â Â Â z-index: 1;
Â Â Â Â }

Â Â Â Â table#comments-table th,
Â Â Â Â table#comments-table td {
Â Â Â Â Â Â border-bottom: 1px solid #333;
Â Â Â Â Â Â padding: 4px 6px;
Â Â Â Â Â Â text-align: left;
Â Â Â Â Â Â vertical-align: top;
Â Â Â Â Â Â word-wrap: break-word;
Â Â Â Â Â Â word-break: break-word;
Â Â Â Â Â Â overflow: hidden;
Â Â Â Â }

Â Â Â Â table#comments-table th {
Â Â Â Â Â Â font-weight: 600;
Â Â Â Â Â Â font-size: 12px;
Â Â Â Â }

Â Â Â Â table#comments-table tbody tr:nth-child(even) {
Â Â Â Â Â Â background: #252a2e;
Â Â Â Â }

Â Â Â Â .col-nickÂ  { width: 80px; white-space: nowrap; }
Â Â Â Â .col-textÂ  { width: auto; }
Â Â Â Â .col-media { width: 40px; text-align: right; }

Â Â Â Â .media-icons {
Â Â Â Â Â Â display: flex;
Â Â Â Â Â Â gap: 4px;
Â Â Â Â Â Â align-items: center;
Â Â Â Â Â Â flex-wrap: wrap;
Â Â Â Â Â Â font-size: 16px;
Â Â Â Â Â Â justify-content: flex-end;
Â Â Â Â }

Â Â Â Â .media-flag {
Â Â Â Â Â Â font-size: 16px;
Â Â Â Â }

Â Â Â Â .play-video-btn {
Â Â Â Â Â Â display: none;
Â Â Â Â }

Â Â Â Â .edit-header-btn {
Â Â Â Â Â Â margin-left: 6px;
Â Â Â Â Â Â padding: 1px 6px;
Â Â Â Â Â Â border-radius: 10px;
Â Â Â Â Â Â border: 1px solid #666;
Â Â Â Â Â Â background: #2f3438;
Â Â Â Â Â Â color: #d0d0d0;
Â Â Â Â Â Â font-size: 10px;
Â Â Â Â Â Â cursor: pointer;
Â Â Â Â Â Â opacity: 0.8;
Â Â Â Â }
Â Â Â Â .edit-header-btn:hover {
Â Â Â Â Â Â opacity: 1;
Â Â Â Â Â Â background: #4a5056;
Â Â Â Â }

Â Â Â Â #comments-tbody tr.selected {
Â Â Â Â Â Â background: #4f7a3b !important;
Â Â Â Â }

Â Â Â Â .row-flash {
Â Â Â Â Â Â animation: rowFlash 0.8s ease-out;
Â Â Â Â }

Â Â Â Â @keyframes rowFlash {
Â Â Â Â Â Â 0% Â  { background-color: #7fbf4f; }
Â Â Â Â Â Â 100% { background-color: inherit; }
Â Â Â Â }

Â Â Â Â /* å³å´ï¼šè¦–è¦ºå€ */

Â Â Â Â .visual-wrapper {
Â Â Â Â Â Â display: flex;
Â Â Â Â Â Â flex-direction: column;
Â Â Â Â Â Â gap: 8px;
Â Â Â Â Â Â height: 100%;
Â Â Â Â Â Â overflow-y: visible;
Â Â Â Â }

Â Â Â Â .visual-header {
Â Â Â Â Â Â font-size: 13px;
Â Â Â Â Â Â display: flex;
Â Â Â Â Â Â justify-content: space-between;
Â Â Â Â Â Â align-items: center;
Â Â Â Â Â Â gap: 8px;
Â Â Â Â }

Â Â Â Â .current-point { font-size: 12px; opacity: 0.9; }
Â Â Â Â .current-point { display: none; }

Â Â Â Â .visual-body {
Â Â Â Â Â Â flex: 1 1 auto;
Â Â Â Â Â Â display: flex;
Â Â Â Â Â Â flex-direction: column;
Â Â Â Â Â Â gap: 8px;
Â Â Â Â Â Â min-height: 260px;
Â Â Â Â Â Â overflow-y: visible;
Â Â Â Â }

Â Â Â Â .top-row {
Â Â Â Â Â Â display: flex;
Â Â Â Â Â Â gap: 8px;
Â Â Â Â Â Â min-height: 170px;
Â Â Â Â }

Â Â Â Â .video-frame-wrap {
Â Â Â Â Â Â flex: 1 1 60%;
Â Â Â Â Â Â background: #111315;
Â Â Â Â Â Â border-radius: 6px;
Â Â Â Â Â Â overflow: hidden;
Â Â Â Â Â Â border: 1px solid #555;
Â Â Â Â Â Â position: relative;
Â Â Â Â Â Â min-height: 150px;
Â Â Â Â }

Â Â Â Â .video-frame-wrap iframe {
Â Â Â Â Â Â width: 100%;
Â Â Â Â Â Â height: 100%;
Â Â Â Â Â Â border: none;
Â Â Â Â }

Â Â Â Â /* YouTube API å®¹å™¨ï¼šç”± YT.Player å»ºç«‹ iframe */
Â Â Â Â #youtube-player {
Â Â Â Â Â Â position: absolute;
Â Â Â Â Â Â top: 0;
Â Â Â Â Â Â left: 0;
Â Â Â Â Â Â width: 100%;
Â Â Â Â Â Â height: 100%;
Â Â Â Â Â Â display: none; /* é è¨­éš±è—ï¼Œæ’­æ”¾ YouTube æ™‚æ‰é¡¯ç¤º */
Â Â Â Â }

Â Â Â Â .video-placeholder {
Â Â Â Â Â Â position: absolute;
Â Â Â Â Â Â inset: 0;
Â Â Â Â Â Â display: flex;
Â Â Â Â Â Â align-items: center;
Â Â Â Â Â Â justify-content: center;
Â Â Â Â Â Â font-size: 12px;
Â Â Â Â Â Â color: #999;
Â Â Â Â Â Â text-align: center;
Â Â Â Â Â Â padding: 8px;
Â Â Â Â }

Â Â Â Â .mute-toggle {
Â Â Â Â Â Â position: absolute;
Â Â Â Â Â Â top: 6px;
Â Â Â Â Â Â right: 6px;
Â Â Â Â Â Â width: 24px;
Â Â Â Â Â Â height: 24px;
Â Â Â Â Â Â background: rgba(0, 0, 0, 0.6);
Â Â Â Â Â Â color: white;
Â Â Â Â Â Â border-radius: 50%;
Â Â Â Â Â Â display: flex;
Â Â Â Â Â Â align-items: center;
Â Â Â Â Â Â justify-content: center;
Â Â Â Â Â Â font-size: 14px;
Â Â Â Â Â Â cursor: pointer;
Â Â Â Â Â Â z-index: 10;
Â Â Â Â Â Â border: 1px solid rgba(255, 255, 255, 0.3);
Â Â Â Â }
Â Â Â Â .mute-toggle.hidden {
Â Â Â Â Â Â display: none !important;
Â Â Â Â }

Â Â Â Â .video-watermark {
Â Â Â Â Â Â position: absolute;
Â Â Â Â Â Â top: 0;
Â Â Â Â Â Â left: 0;
Â Â Â Â Â Â width: 100%;
Â Â Â Â Â Â height: 100%;
Â Â Â Â Â Â display: none;
Â Â Â Â Â Â align-items: center;
Â Â Â Â Â Â justify-content: center;
Â Â Â Â Â Â z-index: 15;
Â Â Â Â Â Â pointer-events: auto;
Â Â Â Â }

Â Â Â Â .video-watermark-content {
Â Â Â Â Â Â background: rgba(0, 0, 0, 0.7);
Â Â Â Â Â Â color: white;
Â Â Â Â Â Â padding: 10px 15px;
Â Â Â Â Â Â border-radius: 8px;
Â Â Â Â Â Â font-size: 16px;
Â Â Â Â Â Â cursor: pointer;
Â Â Â Â Â Â user-select: none;
Â Â Â Â }
Â Â Â Â .video-watermark-content:hover {
Â Â Â Â Â Â background: rgba(0, 0, 0, 0.9);
Â Â Â Â }

Â Â Â Â .circle-area {
Â Â Â Â Â Â flex: 1 1 40%;
Â Â Â Â Â Â display: flex;
Â Â Â Â Â Â justify-content: center;
Â Â Â Â Â Â align-items: center;
Â Â Â Â }

Â Â Â Â .circle-stack {
Â Â Â Â Â Â position: relative;
Â Â Â Â Â Â width: 160px;
Â Â Â Â Â Â height: 160px;
Â Â Â Â Â Â border-radius: 50%;
Â Â Â Â Â Â --ring-main-color: #5c7a5c;
Â Â Â Â Â Â --ring-boundary-color: #9ad09a;
Â Â Â Â Â Â --ring-highlight-color: #70ff70;
Â Â Â Â Â Â --ring-outer-fog: rgba(112, 255, 112, 0.35);
Â Â Â Â Â Â background: radial-gradient(circle at 20% 20%, #555, #111);
Â Â Â Â }

Â Â Â Â .ring {
Â Â Â Â Â Â position: absolute;
Â Â Â Â Â Â border-radius: 50%;
Â Â Â Â Â Â transition: border-color 0.12s ease, box-shadow 0.12s ease, opacity 0.12s ease;
Â Â Â Â }

Â Â Â Â .ring-main {
Â Â Â Â Â Â border: 3px solid var(--ring-main-color);
Â Â Â Â Â Â opacity: 0.8;
Â Â Â Â }
Â Â Â Â .ring-boundary {
Â Â Â Â Â Â border: 1.2px solid var(--ring-boundary-color);
Â Â Â Â Â Â opacity: 0.7;
Â Â Â Â }
Â Â Â Â .ring-b45 {
Â Â Â Â Â Â border: 1px solid transparent;
Â Â Â Â Â Â box-shadow: 0 0 16px var(--ring-outer-fog);
Â Â Â Â Â Â opacity: 0.9;
Â Â Â Â }

Â Â Â Â .ring-b45 { inset: 4%;Â  }
Â Â Â Â .ring-4 Â  { inset: 10%; }
Â Â Â Â .ring-b35 { inset: 20%; }
Â Â Â Â .ring-3 Â  { inset: 26%; }
Â Â Â Â .ring-b25 { inset: 36%; }
Â Â Â Â .ring-2 Â  { inset: 42%; }
Â Â Â Â .ring-b15 { inset: 52%; }
Â Â Â Â .ring-1 Â  { inset: 60%; }

Â Â Â Â .ring.active {
Â Â Â Â Â Â border-color: var(--ring-highlight-color);
Â Â Â Â Â Â opacity: 1;
Â Â Â Â Â Â box-shadow: 0 0 10px rgba(140, 255, 140, 0.9);
Â Â Â Â }

Â Â Â Â .layer-label {
Â Â Â Â Â Â position: absolute;
Â Â Â Â Â Â bottom: 6px;
Â Â Â Â Â Â right: 8px;
Â Â Â Â Â Â font-size: 11px;
Â Â Â Â Â Â color: #cfe9cf;
Â Â Â Â Â Â text-shadow: 0 0 3px #000;
Â Â Â Â Â Â display: none;
Â Â Â Â }

Â Â Â Â .bottom-row {
Â Â Â Â Â Â display: flex;
Â Â Â Â Â Â gap: 8px;
Â Â Â Â Â Â align-items: stretch;
Â Â Â Â Â Â overflow-y: visible;
Â Â Â Â }

Â Â Â Â .reply-area {
Â Â Â Â Â Â flex: 1 1 60%;
Â Â Â Â }

Â Â Â Â .reply-target {
Â Â Â Â Â Â font-size: 12px;
Â Â Â Â Â Â margin-bottom: 4px;
Â Â Â Â Â Â opacity: 0.85;
Â Â Â Â }

Â Â Â Â .reply-target-btn {
Â Â Â Â Â Â padding: 3px 10px;
Â Â Â Â Â Â border-radius: 14px;
Â Â Â Â Â Â border: 1px solid #bbb;
Â Â Â Â Â Â background: #f5f5f5;
Â Â Â Â Â Â color: #222629;
Â Â Â Â Â Â font-size: 12px;
Â Â Â Â Â Â cursor: pointer;
Â Â Â Â Â Â transition: background-color 0.15s ease, border-color 0.15s ease, color 0.15s ease;
Â Â Â Â }
Â Â Â Â .reply-target-btn:disabled {
Â Â Â Â Â Â opacity: 0.6;
Â Â Â Â Â Â cursor: default;
Â Â Â Â }
Â Â Â Â .reply-target-btn.linked {
Â Â Â Â Â Â background: #4f7a3b;
Â Â Â Â Â Â border-color: #4f7a3b;
Â Â Â Â Â Â color: #f5f5f5;
Â Â Â Â }

Â Â Â Â #admin-reply {
Â Â Â Â Â Â width: 100%;
Â Â Â Â Â Â background: #1f2326;
Â Â Â Â Â Â border: 1px solid #555;
Â Â Â Â Â Â color: #f5f5f5;
Â Â Â Â Â Â font-size: 12px;
Â Â Â Â Â Â border-radius: 4px;
Â Â Â Â Â Â min-height: 80px;
Â Â Â Â Â Â resize: none;
Â Â Â Â Â Â overflow: hidden;
Â Â Â Â Â Â line-height: 1.4;
Â Â Â Â }

Â Â Â Â .fingerboard-row {
Â Â Â Â Â Â flex: 1 1 40%;
Â Â Â Â Â Â display: flex;
Â Â Â Â Â Â justify-content: center;
Â Â Â Â Â Â align-items: center;
Â Â Â Â }

Â Â Â Â .fingerboard {
Â Â Â Â Â Â position: relative;
Â Â Â Â Â Â width: 120px;
Â Â Â Â Â Â max-width: 140px;
Â Â Â Â Â Â height: 260px;
Â Â Â Â Â Â background: linear-gradient(180deg, #181a1d, #34383d);
Â Â Â Â Â Â border-radius: 14px;
Â Â Â Â Â Â overflow: hidden;
Â Â Â Â Â Â border: 2px solid #676f78;
Â Â Â Â Â Â box-shadow: 0 0 10px rgba(0, 0, 0, 0.55);
Â Â Â Â }

Â Â Â Â .fb-string {
Â Â Â Â Â Â position: absolute;
Â Â Â Â Â Â top: 6%;
Â Â Â Â Â Â bottom: 6%;
Â Â Â Â Â Â width: 2px;
Â Â Â Â Â Â background: linear-gradient(180deg, #cfcfcf, #888);
Â Â Â Â Â Â opacity: 0.9;
Â Â Â Â }
Â Â Â Â .fb-s1 { left: 20%; transform: skewX(-3deg); }
Â Â Â Â .fb-s2 { left: 40%; transform: skewX(-1.5deg); }
Â Â Â Â .fb-s3 { left: 62%; transform: skewX( 1.5deg); }
Â Â Â Â .fb-s4 { left: 80%; transform: skewX( 3deg); }

Â Â Â Â .fingerboard-note {
Â Â Â Â Â Â position: absolute;
Â Â Â Â Â Â font-size: 10px;
Â Â Â Â Â Â color: #fdf5c5;
Â Â Â Â Â Â opacity: 0.95;
Â Â Â Â Â Â text-shadow: 0 0 2px #000;
Â Â Â Â Â Â pointer-events: none;
Â Â Â Â }

Â Â Â Â /* æ‰‹æ©Ÿç‰ˆ - ç¢ºä¿æ»¾å‹•é †æš¢ */

Â Â Â Â .mobile-fixed-header {
Â Â Â Â Â Â display: none;
Â Â Â Â }

Â Â Â Â @media (max-width: 820px) {
Â Â Â Â Â Â body {
Â Â Â Â Â Â Â Â padding-top: 40px;
Â Â Â Â Â Â }

Â Â Â Â Â Â .mobile-fixed-header {
Â Â Â Â Â Â Â Â display: flex;
Â Â Â Â Â Â Â Â justify-content: space-between;
Â Â Â Â Â Â Â Â align-items: center;
Â Â Â Â Â Â Â Â padding: 8px 12px;
Â Â Â Â Â Â Â Â background: #33383c;
Â Â Â Â Â Â Â Â border-bottom: 1px solid #444;
Â Â Â Â Â Â Â Â position: fixed;
Â Â Â Â Â Â Â Â top: 0;
Â Â Â Â Â Â Â Â left: 0;
Â Â Â Â Â Â Â Â width: 100%;
Â Â Â Â Â Â Â Â z-index: 999;
Â Â Â Â Â Â }

Â Â Â Â Â Â .mobile-fixed-header button {
Â Â Â Â Â Â Â Â padding: 4px 10px;
Â Â Â Â Â Â Â Â border-radius: 14px;
Â Â Â Â Â Â Â Â border: 1px solid #777;
Â Â Â Â Â Â Â Â background: #3a3f44;
Â Â Â Â Â Â Â Â color: #f5f5f5;
Â Â Â Â Â Â Â Â font-size: 12px;
Â Â Â Â Â Â Â Â cursor: pointer;
Â Â Â Â Â Â }

Â Â Â Â Â Â .page {
Â Â Â Â Â Â Â Â padding: 0;
Â Â Â Â Â Â Â Â max-width: 100%;
Â Â Â Â Â Â }

Â Â Â Â Â Â header {
Â Â Â Â Â Â Â Â display: none;
Â Â Â Â Â Â }

Â Â Â Â Â Â main.layout {
Â Â Â Â Â Â Â Â flex-direction: column;
Â Â Â Â Â Â }

Â Â Â Â Â Â #visual-panel {
Â Â Â Â Â Â Â Â order: 1;
Â Â Â Â Â Â Â Â padding-top: 10px;
Â Â Â Â Â Â }

Â Â Â Â Â Â #comments-section {
Â Â Â Â Â Â Â Â order: 2;
Â Â Â Â Â Â Â Â padding-top: 10px;
Â Â Â Â Â Â }

Â Â Â Â Â Â .panel-left,
Â Â Â Â Â Â .panel-right {
Â Â Â Â Â Â Â Â max-width: 100%;
Â Â Â Â Â Â Â Â width: 100%;
Â Â Â Â Â Â Â Â border-radius: 0;
Â Â Â Â Â Â Â Â overflow-y: visible;
Â Â Â Â Â Â Â Â overflow-x: hidden;
Â Â Â Â Â Â }

Â Â Â Â Â Â .panel-left {
Â Â Â Â Â Â Â Â height: auto !important;
Â Â Â Â Â Â Â Â min-height: auto;
Â Â Â Â Â Â }

Â Â Â Â Â Â .comments-wrapper {
Â Â Â Â Â Â Â Â height: auto;
Â Â Â Â Â Â Â Â min-height: 200px;
Â Â Â Â Â Â Â Â overflow-y: visible;
Â Â Â Â Â Â }

Â Â Â Â Â Â .panel-right .visual-body {
Â Â Â Â Â Â Â Â min-height: 420px;
Â Â Â Â Â Â }

Â Â Â Â Â Â .top-row {
Â Â Â Â Â Â Â Â flex-direction: column;
Â Â Â Â Â Â Â Â min-height: 0;
Â Â Â Â Â Â }

Â Â Â Â Â Â .video-frame-wrap {
Â Â Â Â Â Â Â Â width: 100%;
Â Â Â Â Â Â Â Â height: 160px !important;
Â Â Â Â Â Â Â Â min-height: 160px;
Â Â Â Â Â Â }

Â Â Â Â Â Â .circle-area {
Â Â Â Â Â Â Â Â justify-content: center;
Â Â Â Â Â Â Â Â margin-top: 6px;
Â Â Â Â Â Â }

Â Â Â Â Â Â .circle-stack {
Â Â Â Â Â Â Â Â width: 160px;
Â Â Â Â Â Â Â Â height: 160px;
Â Â Â Â Â Â }

Â Â Â Â Â Â .fingerboard {
Â Â Â Â Â Â Â Â height: 220px;
Â Â Â Â Â Â }

Â Â Â Â Â Â .bottom-row {
Â Â Â Â Â Â Â Â flex-direction: row;
Â Â Â Â Â Â }

Â Â Â Â Â Â .reply-area {
Â Â Â Â Â Â Â Â flex: 1 1 60%;
Â Â Â Â Â Â }

Â Â Â Â Â Â .fingerboard-row {
Â Â Â Â Â Â Â Â flex: 1 1 40%;
Â Â Â Â Â Â }
Â Â Â Â }
Â Â </style>
</head>

<body>
Â Â <div class="mobile-fixed-header">
Â Â Â Â <button type="button" id="mobile-back-button">â† å›åˆ°å½±ç‰‡</button>
Â Â Â Â <button type="button" id="mobile-items-button">â˜° é …ç›®</button>
Â Â </div>

Â Â <div class="page">
Â Â Â Â <header>
Â Â Â Â Â Â <h1>StradTone Violin</h1>
Â Â Â Â Â Â <h2>æç´è²å­¸å¯¦é©—å®¤</h2>
Â Â Â Â </header>

Â Â Â Â <main class="layout">
Â Â Â Â Â Â <section class="panel panel-left" id="comments-section">
Â Â Â Â Â Â Â Â <p class="hint">å°æç´</p>

Â Â Â Â Â Â Â Â <div class="toolbar">
Â Â Â Â Â Â Â Â Â Â <button type="button" id="btn-new">æ–°å¢</button>
Â Â Â Â Â Â Â Â Â Â <button type="button" id="btn-edit" class="edit-header-btn">ç·¨è¼¯</button>
Â Â Â Â Â Â Â Â </div>

Â Â Â Â Â Â Â Â <div id="edit-wait-hint" class="sub-hint hidden">
Â Â Â Â Â Â Â Â Â Â ğŸ“Œ è«‹åœ¨ä¸‹æ–¹è¡¨æ ¼é»ä¸€ä¸‹ä½ è¦ç·¨è¼¯çš„é‚£ä¸€åˆ—ã€‚
Â Â Â Â Â Â Â Â </div>

Â Â Â Â Â Â Â Â <form id="community-form" class="hidden">
Â Â Â Â Â Â Â Â Â Â <label>
Â Â Â Â Â Â Â Â Â Â Â Â usernameï¼ˆ5â€“12 å­—å¿…å¡«,ä¿®æ”¹ç·¨è¼¯ç”¨ï¼‰ï¼š
Â Â Â Â Â Â Â Â Â Â Â Â <input
Â Â Â Â Â Â Â Â Â Â Â Â Â Â type="text"
Â Â Â Â Â Â Â Â Â Â Â Â Â Â id="nickname-input"
Â Â Â Â Â Â Â Â Â Â Â Â Â Â maxlength="12"
Â Â Â Â Â Â Â Â Â Â Â Â Â Â placeholder="Mr,s 09â€¦."
Â Â Â Â Â Â Â Â Â Â Â Â />
Â Â Â Â Â Â Â Â Â Â </label>
Â Â Â Â Â Â Â Â Â Â <label>
Â Â Â Â Â Â Â Â Â Â Â Â é …ç›®ï¼ˆ100 å­—å…§ï¼‰ï¼š
Â Â Â Â Â Â Â Â Â Â Â Â <input
Â Â Â Â Â Â Â Â Â Â Â Â Â Â type="text"
Â Â Â Â Â Â Â Â Â Â Â Â Â Â id="text-input"
Â Â Â Â Â Â Â Â Â Â Â Â Â Â maxlength="100"
Â Â Â Â Â Â Â Â Â Â Â Â Â Â placeholder="..."
Â Â Â Â Â Â Â Â Â Â Â Â />
Â Â Â Â Â Â Â Â Â Â </label>

Â Â Â Â Â Â Â Â Â Â <div class="form-row-inline media-select-row">
Â Â Â Â Â Â Â Â Â Â Â Â <button
Â Â Â Â Â Â Â Â Â Â Â Â Â Â type="button"
Â Â Â Â Â Â Â Â Â Â Â Â Â Â class="media-select-btn"
Â Â Â Â Â Â Â Â Â Â Â Â Â Â id="btn-media-youtube"
Â Â Â Â Â Â Â Â Â Â Â Â Â Â data-media="youtube"
Â Â Â Â Â Â Â Â Â Â Â Â >
Â Â Â Â Â Â Â Â Â Â Â Â Â Â YouTube
Â Â Â Â Â Â Â Â Â Â Â Â </button>
Â Â Â Â Â Â Â Â Â Â Â Â <button
Â Â Â Â Â Â Â Â Â Â Â Â Â Â type="button"
Â Â Â Â Â Â Â Â Â Â Â Â Â Â class="media-select-btn"
Â Â Â Â Â Â Â Â Â Â Â Â Â Â id="btn-media-upload"
Â Â Â Â Â Â Â Â Â Â Â Â Â Â data-media="upload"
Â Â Â Â Â Â Â Â Â Â Â Â >
Â Â Â Â Â Â Â Â Â Â Â Â Â Â å½±ç‰‡
Â Â Â Â Â Â Â Â Â Â Â Â </button>
Â Â Â Â Â Â Â Â Â Â Â Â <button
Â Â Â Â Â Â Â Â Â Â Â Â Â Â type="button"
Â Â Â Â Â Â Â Â Â Â Â Â Â Â class="media-select-btn"
Â Â Â Â Â Â Â Â Â Â Â Â Â Â id="btn-media-audio"
Â Â Â Â Â Â Â Â Â Â Â Â Â Â data-media="audio"
Â Â Â Â Â Â Â Â Â Â Â Â >
Â Â Â Â Â Â Â Â Â Â Â Â Â Â éŒ„éŸ³
Â Â Â Â Â Â Â Â Â Â Â Â </button>
Â Â Â Â Â Â Â Â Â Â </div>

Â Â Â Â Â Â Â Â Â Â <div id="video-fields" class="hidden">
Â Â Â Â Â Â Â Â Â Â Â Â <div class="form-row-inline" id="youtube-row" style="margin-top:4px;">
Â Â Â Â Â Â Â Â Â Â Â Â Â Â <input
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â type="text"
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â id="youtube-url-input"
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â placeholder="å½±ç‰‡æˆ–ç¶²é é€£çµï¼ˆå« YouTubeï¼‰"
Â Â Â Â Â Â Â Â Â Â Â Â Â Â />
Â Â Â Â Â Â Â Â Â Â Â Â Â Â <input
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â type="text"
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â id="start-input"
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â placeholder="é–‹å§‹ mm:ss "
Â Â Â Â Â Â Â Â Â Â Â Â Â Â />
Â Â Â Â Â Â Â Â Â Â Â Â Â Â <input
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â type="text"
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â id="end-input"
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â placeholder="çµæŸ mm:ss "
Â Â Â Â Â Â Â Â Â Â Â Â Â Â />
Â Â Â Â Â Â Â Â Â Â Â Â </div>

Â Â Â Â Â Â Â Â Â Â Â Â <div class="form-row-inline" id="video-upload-row" style="margin-top:4px;">
Â Â Â Â Â Â Â Â Â Â Â Â Â Â <input type="file" id="video-file-input" accept="video/*,image/*" />
Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span id="video-file-label" class="sub-hint"></span>
Â Â Â Â Â Â Â Â Â Â Â Â </div>
Â Â Â Â Â Â Â Â Â Â </div>

Â Â Â Â Â Â Â Â Â Â <div id="audio-fields" class="hidden">
Â Â Â Â Â Â Â Â Â Â Â Â <div class="media-record-toolbar" id="audio-record-toolbar">
Â Â Â Â Â Â Â Â Â Â Â Â Â Â <button type="button" class="media-record-btn" id="audio-rec-start" disabled>â—</button>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â <button type="button" class="media-record-btn" id="audio-rec-stop" disabled>â– </button>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â <button type="button" class="media-record-btn" id="audio-rec-cancel" disabled>âœ•</button>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class="media-record-status" id="audio-rec-status">éŒ„éŸ³é å‚™</span>
Â Â Â Â Â Â Â Â Â Â Â Â </div>

Â Â Â Â Â Â Â Â Â Â Â Â <div class="form-row-inline" id="audio-upload-row" style="margin-top:4px;">
Â Â Â Â Â Â Â Â Â Â Â Â Â Â <input type="file" id="audio-file-input" accept="audio/*" />
Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span id="audio-file-label" class="sub-hint"></span>
Â Â Â Â Â Â Â Â Â Â Â Â </div>

Â Â Â Â Â Â Â Â Â Â Â Â <div class="form-row-inline" id="audio-preview-row" style="margin-top:4px;">
Â Â Â Â Â Â Â Â Â Â Â Â Â Â <audio id="audio-rec-preview" class="rec-preview" controls></audio>
Â Â Â Â Â Â Â Â Â Â Â Â </div>
Â Â Â Â Â Â Â Â Â Â </div>

Â Â Â Â Â Â Â Â Â Â <div class="form-row-inline">
Â Â Â Â Â Â Â Â Â Â Â Â <button type="submit" id="submit-btn" disabled>ç™¼è¡¨</button>
Â Â Â Â Â Â Â Â Â Â </div>
Â Â Â Â Â Â Â Â </form>

Â Â Â Â Â Â Â Â <div class="comments-wrapper">
Â Â Â Â Â Â Â Â Â Â <table id="comments-table">
Â Â Â Â Â Â Â Â Â Â Â Â <thead>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â <tr>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <th class="col-nick">username</th>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <th class="col-text">é …ç›®</th>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <th class="col-media">åª’é«”</th>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â </tr>
Â Â Â Â Â Â Â Â Â Â Â Â </thead>
Â Â Â Â Â Â Â Â Â Â Â Â <tbody id="comments-tbody">
Â Â Â Â Â Â Â Â Â Â Â Â </tbody>
Â Â Â Â Â Â Â Â Â Â </table>
Â Â Â Â Â Â Â Â </div>
Â Â Â Â Â Â </section>

Â Â Â Â Â Â <section class="panel panel-right" id="visual-panel">
Â Â Â Â Â Â Â Â <div class="visual-wrapper">
Â Â Â Â Â Â Â Â Â Â <div class="visual-header">
Â Â Â Â Â Â Â Â Â Â Â Â <div class="current-point" id="current-info">
Â Â Â Â Â Â Â Â Â Â Â Â Â Â å°šæœªé¸å–ç•™è¨€
Â Â Â Â Â Â Â Â Â Â Â Â </div>
Â Â Â Â Â Â Â Â Â Â </div>

Â Â Â Â Â Â Â Â Â Â <div class="visual-body">
Â Â Â Â Â Â Â Â Â Â Â Â <div class="top-row">
Â Â Â Â Â Â Â Â Â Â Â Â Â Â <div class="video-frame-wrap">
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <div class="mute-toggle hidden" id="mute-toggle">ğŸ”‡</div>

Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <div class="video-watermark" id="video-watermark">
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <div class="video-watermark-content">
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ğŸ”‡ é»ä¸€ä¸‹é–‹å•Ÿè²éŸ³ / æ’­æ”¾
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â </div>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â </div>

Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <!-- YouTube IFrame API å®¹å™¨ -->
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <div id="youtube-player"></div>

Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <!-- å…¶ä»–ä¾†æºï¼ˆGoogle Drive / é YouTubeï¼‰ä½¿ç”¨çš„ iframe -->
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <iframe
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â id="video-iframe"
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â src=""
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â referrerpolicy="origin-when-cross-origin"
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â allowfullscreen
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â style="display:none;"
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ></iframe>

Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <div class="video-placeholder" id="video-placeholder">
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â è«‹å…ˆé¸æ“‡å·¦å´é …ç›®ã€‚
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â </div>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â </div>

Â Â Â Â Â Â Â Â Â Â Â Â Â Â <div class="circle-area">
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <div class="circle-stack" id="circle-stack">
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <div class="ring ring-main ring-1" data-layer="1"></div>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <div class="ring ring-main ring-2" data-layer="2"></div>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <div class="ring ring-main ring-3" data-layer="3"></div>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <div class="ring ring-main ring-4" data-layer="4"></div>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <div class="ring ring-boundary ring-b15" data-layer="1.5"></div>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <div class="ring ring-boundary ring-b25" data-layer="2.5"></div>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <div class="ring ring-boundary ring-b35" data-layer="3.5"></div>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <div class="ring ring-b45" data-layer="4.5"></div>

Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <div class="layer-label" id="layer-label">
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â layers: â€“
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â </div>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â </div>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â </div>
Â Â Â Â Â Â Â Â Â Â Â Â </div>

Â Â Â Â Â Â Â Â Â Â Â Â <div class="bottom-row">
Â Â Â Â Â Â Â Â Â Â Â Â Â Â <div class="reply-area">
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <div class="reply-target" id="reply-target">
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <button
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â type="button"
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â id="reply-target-btn"
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â class="reply-target-btn"
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â disabled
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â >
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â From: â€”
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â </button>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â </div>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <textarea
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â id="admin-reply"
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â placeholder="æç´è²å­¸å¯¦é©—å®¤ï¼š"
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ></textarea>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â </div>

Â Â Â Â Â Â Â Â Â Â Â Â Â Â <div class="fingerboard-row">
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <div class="fingerboard" id="fingerboard">
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <div class="fb-string fb-s1"></div>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <div class="fb-string fb-s2"></div>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <div class="fb-string fb-s3"></div>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <div class="fb-string fb-s4"></div>

Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <div class="fingerboard-note" style="left:24%; top:8%;">G0</div>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <div class="fingerboard-note" style="left:24%; top:26%;">G3</div>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <div class="fingerboard-note" style="left:38%; top:18%;">D5</div>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <div class="fingerboard-note" style="left:38%; top:40%;">D8</div>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <div class="fingerboard-note" style="left:62%; top:22%;">A7</div>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <div class="fingerboard-note" style="left:62%; top:44%;">A10</div>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <div class="fingerboard-note" style="left:76%; top:30%;">E9</div>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <div class="fingerboard-note" style="left:76%; top:52%;">E12</div>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â </div>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â </div>
Â Â Â Â Â Â Â Â Â Â Â Â </div>
Â Â Â Â Â Â Â Â Â Â </div>
Â Â Â Â Â Â Â Â </div>
Â Â Â Â Â Â </section>
Â Â Â Â </main>
Â Â </div>

<script>
Â Â // ===== å…¨åŸŸç‹€æ…‹ =====
Â Â const API_URL = "https://script.google.com/macros/s/AKfycbwl01SQAIhOcdVdlm5bia7qelXHJW8pjWeypkk7_DxBiY37-WSRN81QKmpO-CyIA-Q58w/exec";

Â Â let commentsCache = [];
Â Â let currentSelectedId = null;

Â Â let isFormOpen = false;
Â Â let isAddModeÂ  = false;

Â Â let editState = {
Â Â Â Â active: false,
Â Â Â Â id: null,
Â Â Â Â nickname: "",
Â Â Â Â originalText: "",
Â Â Â Â waitForSelect: false,
Â Â Â Â nameVerified: false
Â Â };

Â Â window.recordedAudioBlob = null;
Â Â window.recordedVideoBlob = null;

Â Â let carouselInterval = null;
Â Â let carouselIndex = 0;
Â Â let carouselItems = [];
Â Â const CAROUSEL_DURATION = 30000;

Â Â let autoSelectParams = { id: null, nick: null };

Â Â let isVideoMuted = false;
Â Â let isComposingName = false;

Â Â const REPLY_PREFIX = "æç´è²å­¸å¯¦é©—å®¤ï¼š";

Â Â // YouTube IFrame API ç‹€æ…‹
Â Â let ytPlayer = null;
Â Â let ytApiReady = false;
Â Â let pendingYtLoad = null;

Â Â // ===== å°å·¥å…· =====
Â Â function isIOS() {
Â Â Â Â return /iP(ad|hone|od)/.test(navigator.userAgent) || (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1);
Â Â }

Â Â function maskName(name) {
Â Â Â Â const s = (name === null || name === undefined) ? "" : String(name).trim();
Â Â Â Â if (!s) return "åŒ¿å";
Â Â Â Â if (s.length <= 2) return s[0] + "*";
Â Â Â Â const first = s[0];
Â Â Â Â const lastÂ  = s[s.length - 1];
Â Â Â Â const middle = "*".repeat(s.length - 2);
Â Â Â Â return first + middle + last;
Â Â }

Â Â function validateNameLength(name) {
Â Â Â Â const s = String(name || "").trim();
Â Â Â Â if (s.length < 5 || s.length > 12) return false;
Â Â Â Â if (!/^[A-Za-z0-9\u4E00-\u99FF]+$/.test(s)) return false;
Â Â Â Â return true;
Â Â }

Â Â function parseTimeToSec(str) {
Â Â Â Â if (!str) return "";
Â Â Â Â const s = String(str).trim();
Â Â Â Â let m = s.match(/^(\d+):(\d{1,2})$/);
Â Â Â Â if (m) {
Â Â Â Â Â Â const min = Number(m[1]);
Â Â Â Â Â Â const sec = Number(m[2]);
Â Â Â Â Â Â if (!isNaN(min) && !isNaN(sec)) return min * 60 + sec;
Â Â Â Â }
Â Â Â Â m = s.match(/^(\d{3,4})$/);
Â Â Â Â if (m) {
Â Â Â Â Â Â const digits = m[1];
Â Â Â Â Â Â const sec = Number(digits.slice(-2));
Â Â Â Â Â Â const min = Number(digits.slice(0, -2));
Â Â Â Â Â Â if (!isNaN(min) && !isNaN(sec)) return min * 60 + sec;
Â Â Â Â }
Â Â Â Â return "";
Â Â }

Â Â function escapeHtml(str) {
Â Â Â Â return String(str || "").replace(/[&<>"']/g, (c) => {
Â Â Â Â Â Â return (
Â Â Â Â Â Â Â Â {
Â Â Â Â Â Â Â Â Â Â "&": "&amp;",
Â Â Â Â Â Â Â Â Â Â "<": "&lt;",
Â Â Â Â Â Â Â Â Â Â ">": "&gt;",
Â Â Â Â Â Â Â Â Â Â '"': "&quot;",
Â Â Â Â Â Â Â Â Â Â "'": "&#39;",
Â Â Â Â Â Â Â Â }[c] || c
Â Â Â Â Â Â );
Â Â Â Â });
Â Â }

Â Â function extractYoutubeId(url) {
Â Â Â Â if (!url) return "";
Â Â Â Â const m1 = url.match(/youtu\.be\/([^?]+)/);
Â Â Â Â if (m1) return m1[1];
Â Â Â Â const m2 = url.match(/[?&]v=([^&]+)/);
Â Â Â Â if (m2) return m2[1];
Â Â Â Â const m3 = url.match(/youtube\.com\/watch\?v=([^&]+)/);
Â Â Â Â if (m3) return m3[1];
Â Â Â Â return "";
Â Â }

Â Â function isYoutubeUrl(url) {
Â Â Â Â return /youtu\.be|youtube\.com/.test(url || "");
Â Â }

Â Â function buildDriveEmbedUrl(fid) {
Â Â Â Â return fid
Â Â Â Â Â Â ? "https://drive.google.com/file/d/" + fid + "/preview"
Â Â Â Â Â Â : "";
Â Â }

Â Â function readFileAsBase64(file) {
Â Â Â Â return new Promise((resolve, reject) => {
Â Â Â Â Â Â const r = new FileReader();
Â Â Â Â Â Â r.onload = () => {
Â Â Â Â Â Â Â Â const result = r.result || "";
Â Â Â Â Â Â Â Â const idx = String(result).indexOf(",");
Â Â Â Â Â Â Â Â resolve(idx >= 0 ? result.slice(idx + 1) : result);
Â Â Â Â Â Â };
Â Â Â Â Â Â r.onerror = () => reject(r.error);
Â Â Â Â Â Â r.readAsDataURL(file);
Â Â Â Â });
Â Â }

Â Â function findRowById(id) {
Â Â Â Â return commentsCache.find((r) => String(r.id) === String(id));
Â Â }

Â Â // ===== å¤šå±¤åœ“ (ç•¥) =====
Â Â function highlightLayers(layerStr) {
Â Â Â Â const rings = document.querySelectorAll(".ring");
Â Â Â Â rings.forEach((r) => r.classList.remove("active"));
Â Â Â Â if (!layerStr) return;

Â Â Â Â const parts = String(layerStr)
Â Â Â Â Â Â .split(",")
Â Â Â Â Â Â .map((s) => s.trim())
Â Â Â Â Â Â .filter(Boolean);

Â Â Â Â rings.forEach((r) => {
Â Â Â Â Â Â const v = r.getAttribute("data-layer");
Â Â Â Â Â Â if (parts.includes(v)) r.classList.add("active");
Â Â Â Â });
Â Â }

Â Â // ===== å›è¦†å€ï¼šå‰ç¶´ & è‡ªå‹•é«˜åº¦ & å„²å­˜ (ç•¥) =====
Â Â function ensureReplyPrefix() {
Â Â Â Â const box = document.getElementById("admin-reply");
Â Â Â Â if (!box) return;

Â Â Â Â const prefix = REPLY_PREFIX + "\n";
Â Â Â Â let val = box.value || "";

Â Â Â Â if (val.startsWith(REPLY_PREFIX)) {
Â Â Â Â Â Â let rest = val.slice(REPLY_PREFIX.length);
Â Â Â Â Â Â rest = rest.replace(/^\s*\n?/, "");
Â Â Â Â Â Â val = prefix + rest;
Â Â Â Â } else {
Â Â Â Â Â Â val = prefix + val.replace(/^æç´è²å­¸å¯¦é©—å®¤ï¼š\s*/g, "");
Â Â Â Â }

Â Â Â Â const oldPos = box.selectionStart || val.length;
Â Â Â Â box.value = val;

Â Â Â Â const firstNewline = box.value.indexOf("\n");
Â Â Â Â const minPos = firstNewline + 1;
Â Â Â Â const newPos = Math.max(oldPos, minPos);
Â Â Â Â box.setSelectionRange(newPos, newPos);

Â Â Â Â box.onkeydown = (e) => {
Â Â Â Â Â Â const pos = box.selectionStart;
Â Â Â Â Â Â if (pos <= prefix.length && (e.key === "Backspace" || e.key === "Delete")) {
Â Â Â Â Â Â Â Â e.preventDefault();
Â Â Â Â Â Â }
Â Â Â Â };
Â Â Â Â box.oncut = (e) => {
Â Â Â Â Â Â if (box.selectionStart < prefix.length) {
Â Â Â Â Â Â Â Â e.preventDefault();
Â Â Â Â Â Â }
Â Â Â Â };
Â Â }

Â Â function autoResizeReply() {
Â Â Â Â const box = document.getElementById("admin-reply");
Â Â Â Â if (!box) return;

Â Â Â Â let maxH = 260;
Â Â Â Â const fb = document.getElementById("fingerboard");
Â Â Â Â if (fb) {
Â Â Â Â Â Â const rect = fb.getBoundingClientRect();
Â Â Â Â Â Â if (rect.height > 0) maxH = rect.height;
Â Â Â Â }

Â Â Â Â box.style.height = "auto";
Â Â Â Â const scrollH = box.scrollHeight;

Â Â Â Â if (scrollH <= maxH) {
Â Â Â Â Â Â box.style.height = scrollH + "px";
Â Â Â Â Â Â box.style.overflowY = "hidden";
Â Â Â Â Â Â box.style.resize = "none";
Â Â Â Â } else {
Â Â Â Â Â Â box.style.height = maxH + "px";
Â Â Â Â Â Â box.style.overflowY = "auto";
Â Â Â Â Â Â box.style.resize = "vertical";
Â Â Â Â }
Â Â }

Â Â async function saveAdminReply() {
Â Â Â Â const box = document.getElementById("admin-reply");
Â Â Â Â if (!box || !currentSelectedId) return;

Â Â Â Â ensureReplyPrefix();
Â Â Â Â autoResizeReply();

Â Â Â Â const full = box.value || "";

Â Â Â Â try {
Â Â Â Â Â Â const params = new URLSearchParams({
Â Â Â Â Â Â Â Â action: "reply",
Â Â Â Â Â Â Â Â id: String(currentSelectedId),
Â Â Â Â Â Â Â Â reply: full,
Â Â Â Â Â Â });

Â Â Â Â Â Â const resÂ  = await fetch(API_URL + "?" + params.toString());
Â Â Â Â Â Â const data = await res.json();

Â Â Â Â Â Â if (!data || data.status !== "ok") {
Â Â Â Â Â Â Â Â throw new Error(data && data.error ? data.error : "reply å¤±æ•—");
Â Â Â Â Â Â }

Â Â Â Â Â Â const r = findRowById(currentSelectedId);
Â Â Â Â Â Â if (r) r.reply = full;

Â Â Â Â Â Â await loadComments(currentSelectedId);

Â Â Â Â } catch (err) {
Â Â Â Â Â Â console.error(err);
Â Â Â Â Â Â alert("å„²å­˜å›è¦†å¤±æ•—ï¼š" + err.message);
Â Â Â Â }
Â Â }

Â Â // ===== YouTube Player API å»ºç«‹ =====
Â Â function createYoutubePlayer() {
Â Â Â Â const containerId = "youtube-player";
Â Â Â Â const el = document.getElementById(containerId);
Â Â Â Â if (!el || typeof YT === "undefined" || !YT.Player) return;

Â Â Â Â ytPlayer = new YT.Player(containerId, {
Â Â Â Â Â Â playerVars: {
Â Â Â Â Â Â Â Â host: "https://www.youtube-nocookie.com",
Â Â Â Â Â Â Â Â rel: 0,
Â Â Â Â Â Â Â Â controls: 1,
Â Â Â Â Â Â Â Â showinfo: 0,
Â Â Â Â Â Â Â Â playsinline: 1
Â Â Â Â Â Â },
Â Â Â Â Â Â events: {
Â Â Â Â Â Â Â Â onReady: function () {
Â Â Â Â Â Â Â Â Â Â ytApiReady = true;
Â Â Â Â Â Â Â Â Â Â if (pendingYtLoad) {
Â Â Â Â Â Â Â Â Â Â Â Â pendingYtLoad();
Â Â Â Â Â Â Â Â Â Â Â Â pendingYtLoad = null;
Â Â Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â }
Â Â Â Â });
Â Â }

Â Â // YouTube IFrame API æœƒå‘¼å«é€™å€‹å…¨åŸŸå‡½å¼
Â Â function onYouTubeIframeAPIReady() {
Â Â Â Â ytApiReady = true;
Â Â Â Â createYoutubePlayer();
Â Â }

Â Â // ===== å½±ç‰‡é¡¯ç¤º =====

Â // ===== å½±ç‰‡é¡¯ç¤ºï¼ˆç°¡åŒ–ç‰ˆï¼šåªç”¨ iframeï¼Œä¸ç”¨ YouTube APIï¼‰ =====
Â Â function clearVideo() {
Â Â Â Â const iframeÂ  Â  Â  = document.getElementById("video-iframe");
Â Â Â Â const phÂ  Â  Â  Â  Â  = document.getElementById("video-placeholder");
Â Â Â Â const muteToggleÂ  = document.getElementById("mute-toggle");
Â Â Â Â const watermark Â  = document.getElementById("video-watermark");

Â Â Â Â // ä¸å†ç®¡ YouTube Playerï¼ŒåªæŠŠ iframe é—œæ‰
Â Â Â Â if (iframe) {
Â Â Â Â Â Â iframe.src = "";
Â Â Â Â Â Â iframe.style.display = "none";
Â Â Â Â }

Â Â Â Â if (ph) {
Â Â Â Â Â Â ph.style.display = "flex";
Â Â Â Â Â Â ph.textContent Â  = "è«‹å…ˆé¸æ“‡å·¦å´é …ç›®ã€‚";
Â Â Â Â }

Â Â Â Â // é€™å…©å€‹ç›®å‰å…ˆä¸ä½¿ç”¨ï¼Œä½†é †æ‰‹ä¸€èµ·éš±è—
Â Â Â Â if (muteToggle)Â  muteToggle.classList.add("hidden");
Â Â Â Â if (watermark) Â  watermark.style.display = "none";

Â Â Â Â // ä¹Ÿé †ä¾¿æŠŠå¤šå±¤åœ“æ•ˆæœæ¸…æ‰
Â Â Â Â highlightLayers("");
Â Â }

Â Â function showVideoForRow(row, isCarousel = false) {
Â Â Â Â if (!row) return;
Â Â Â Â clearVideo();

Â Â Â Â const iframe = document.getElementById("video-iframe");
Â Â Â Â const ph Â  Â  = document.getElementById("video-placeholder");

Â Â Â Â // ===== 1. ç´”éŸ³è¨Šï¼ˆæ²’æœ‰ç•«é¢ï¼Œåªé¡¯ç¤ºæç¤ºæ–‡å­—ï¼‰ =====
Â Â Â Â if (row.type === "audio" && (row.hasAudio || row.driveAudioId)) {
Â Â Â Â Â Â if (ph) {
Â Â Â Â Â Â Â Â ph.style.display = "flex";
Â Â Â Â Â Â Â Â ph.textContent Â  = `éŸ³è¨Šé …ç›®ï¼š${row.text || ""}`;
Â Â Â Â Â Â }
Â Â Â Â Â Â return;
Â Â Â Â }

Â Â Â Â // ===== 2. YouTube å½±ç‰‡ï¼ˆç›´æ¥ç”¨ embed é€£çµï¼Œå¸¶ autoplayï¼‰ =====
Â Â Â Â if (row.type === "youtube" && row.youtubeUrl && isYoutubeUrl(row.youtubeUrl)) {
Â Â Â Â Â Â const videoId = extractYoutubeId(row.youtubeUrl);
Â Â Â Â Â Â if (!videoId) {
Â Â Â Â Â Â Â Â if (ph) {
Â Â Â Â Â Â Â Â Â Â ph.style.display = "flex";
Â Â Â Â Â Â Â Â Â Â ph.textContent Â  = "ç„¡æ³•è§£æ YouTube å½±ç‰‡é€£çµã€‚";
Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â return;
Â Â Â Â Â Â }

Â Â Â Â Â Â const startSec = row.startSec ?? "";
Â Â Â Â Â Â const endSec Â  = row.endSec Â  ?? "";

Â Â Â Â Â Â // åŸºæœ¬ embedç¶²å€ï¼ˆå·²ç¶“ä¸å†ç”¨ youtube-nocookieï¼‰
Â Â Â Â Â Â let src = `https://www.youtube.com/embed/${videoId}?autoplay=1&rel=0&playsinline=1`;

Â Â Â Â Â Â const extra = [];
Â Â Â Â Â Â const sNum = Number(startSec);
Â Â Â Â Â Â const eNum = Number(endSec);

Â Â Â Â Â Â // æœ‰è¨­å®šèµ·å§‹/çµæŸç§’æ•¸æ‰åŠ åƒæ•¸
Â Â Â Â Â Â if (startSec !== "" && !isNaN(sNum)) extra.push("start=" + sNum);
Â Â Â Â Â Â if (endSec Â  !== "" && !isNaN(eNum)) extra.push("end=" Â  + eNum);

Â Â Â Â Â Â if (extra.length) {
Â Â Â Â Â Â Â Â src += "&" + extra.join("&");
Â Â Â Â Â Â }

Â Â Â Â Â Â if (iframe) {
Â Â Â Â Â Â Â Â iframe.srcÂ  Â  Â  Â  Â  = src;
Â Â Â Â Â Â Â Â iframe.style.display = "block";
Â Â Â Â Â Â }
Â Â Â Â Â Â if (ph) ph.style.display = "none";

Â Â Â Â Â Â // é€™è£¡æ²’æœ‰å†åšéœéŸ³è™•ç†ï¼Œç›´æ¥å˜—è©¦å¸¶è²éŸ³è‡ªå‹•æ’­æ”¾
Â Â Â Â Â Â // ï¼ˆè‹¥ç€è¦½å™¨æ”¿ç­–ä¸å…è¨±æœ‰è²è‡ªå‹•æ’­æ”¾ï¼Œæœƒè‡ªå‹•æ”¹æˆéœ€è¦æ‰‹å‹•æŒ‰ä¸€ä¸‹ï¼‰
Â Â Â Â Â Â return;
Â Â Â Â }

Â Â Â Â // ===== 3. å…¶ä»–ä¸Šå‚³ / ä¸€èˆ¬é€£çµï¼ˆDrive æˆ–é YouTube ç¶²å€ï¼‰ =====
Â Â Â Â let url = "";

Â Â Â Â // Google Drive ä¸Šå‚³çš„å½±ç‰‡
Â Â Â Â if (row.type === "upload" && row.driveFileId) {
Â Â Â Â Â Â url = buildDriveEmbedUrl(row.driveFileId);
Â Â Â Â }
Â Â Â Â // å…¶ä»–æƒ…æ³ï¼Œå¦‚æœæœ‰ç¶²å€ï¼Œå°±ç›´æ¥ç•¶ä¸€èˆ¬é€£çµè™•ç†
Â Â Â Â else if (row.youtubeUrl) {
Â Â Â Â Â Â url = row.youtubeUrl;
Â Â Â Â }

Â Â Â Â if (url) {
Â Â Â Â Â Â // å˜—è©¦åŠ ä¸Š autoplay åƒæ•¸ï¼ˆä¸æ˜¯æ¯å€‹ç¶²ç«™éƒ½æœƒç†æœƒï¼Œä½†åŠ ä¸Šä¸æœƒå£ï¼‰
Â Â Â Â Â Â if (!/[?]/.test(url)) {
Â Â Â Â Â Â Â Â url += "?autoplay=1";
Â Â Â Â Â Â } else if (!/[?&]autoplay=1/.test(url)) {
Â Â Â Â Â Â Â Â url += "&autoplay=1";
Â Â Â Â Â Â }

Â Â Â Â Â Â if (iframe) {
Â Â Â Â Â Â Â Â iframe.src Â  Â  Â  Â  Â  = url;
Â Â Â Â Â Â Â Â iframe.style.display = "block";
Â Â Â Â Â Â }
Â Â Â Â Â Â if (ph) ph.style.display = "none";
Â Â Â Â } else {
Â Â Â Â Â Â // å®Œå…¨æ²’æœ‰å¯æ’­çš„åª’é«” â†’ é¡¯ç¤ºæ–‡å­—æç¤º
Â Â Â Â Â Â if (ph) {
Â Â Â Â Â Â Â Â ph.style.display = "flex";
Â Â Â Â Â Â Â Â ph.textContent Â  = `é¸å–é …ç›®ï¼š${row.text || ""}ï¼ˆç„¡å¯æ’­æ”¾åª’é«”ï¼‰`;
Â Â Â Â Â Â }
Â Â Â Â }
Â Â }


Â Â // ===== å›è¦†æ¨™çš„æŒ‰éˆ• (ç•¥) =====
Â Â function resetReplyTargetButton() {
Â Â Â Â const btn = document.getElementById("reply-target-btn");
Â Â Â Â if (!btn) return;
Â Â Â Â btn.textContent = "From: â€”";
Â Â Â Â btn.disabled = true;
Â Â Â Â btn.removeAttribute("data-id");
Â Â Â Â btn.classList.remove("linked");
Â Â }

Â Â function selectRowForReply(row, isCarousel = false) {
Â Â Â Â if (!row) return;

Â Â Â Â if (isCarousel && isFormOpen) {
Â Â Â Â Â Â stopCarousel();
Â Â Â Â Â Â return;
Â Â Â Â }

Â Â Â Â if (!isCarousel && isAddMode) {
Â Â Â Â Â Â resetFormToAddMode();
Â Â Â Â }

Â Â Â Â if (editState.active && !editState.nameVerified && editState.waitForSelect) {
Â Â Â Â Â Â return;
Â Â Â Â }

Â Â Â Â if (!isCarousel && editState.active && String(row.id) !== String(currentSelectedId)) {
Â Â Â Â Â Â resetFormToAddMode();
Â Â Â Â }

Â Â Â Â currentSelectedId = row.id;

Â Â Â Â const tbody = document.getElementById("comments-tbody");
Â Â Â Â if (tbody) {
Â Â Â Â Â Â Array.from(tbody.querySelectorAll("tr")).forEach((tr) => {
Â Â Â Â Â Â Â Â const isThis = tr.getAttribute("data-id") === String(row.id);
Â Â Â Â Â Â Â Â tr.classList.toggle("selected", isThis);
Â Â Â Â Â Â Â Â tr.classList.remove("row-flash");
Â Â Â Â Â Â Â Â if (isThis && isCarousel) {
Â Â Â Â Â Â Â Â Â Â tr.classList.add("row-flash");
Â Â Â Â Â Â Â Â Â Â setTimeout(() => tr.classList.remove("row-flash"), 800);
Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â });

Â Â Â Â Â Â if (isCarousel) {
Â Â Â Â Â Â Â Â const tr = tbody.querySelector(`tr[data-id="${row.id}"]`);
Â Â Â Â Â Â Â Â if (tr) {
Â Â Â Â Â Â Â Â Â Â tr.scrollIntoView({ behavior: "smooth", block: "center" });
Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â }
Â Â Â Â }

Â Â Â Â const btn = document.getElementById("reply-target-btn");
Â Â Â Â if (btn) {
Â Â Â Â Â Â btn.textContent = "From: " + maskName(row.nickname);
Â Â Â Â Â Â btn.disabled = false;
Â Â Â Â Â Â btn.setAttribute("data-id", String(row.id));
Â Â Â Â Â Â btn.classList.add("linked");
Â Â Â Â }

Â Â Â Â const box = document.getElementById("admin-reply");
Â Â Â Â if (box) {
Â Â Â Â Â Â const raw = row.reply || "";
Â Â Â Â Â Â if (!raw || !raw.startsWith(REPLY_PREFIX)) {
Â Â Â Â Â Â Â Â box.value = REPLY_PREFIX + "\n";
Â Â Â Â Â Â } else {
Â Â Â Â Â Â Â Â box.value = raw;
Â Â Â Â Â Â }
Â Â Â Â Â Â ensureReplyPrefix();
Â Â Â Â Â Â autoResizeReply();
Â Â Â Â }

Â Â Â Â showVideoForRow(row, isCarousel);

Â Â Â Â if (!isCarousel) {
Â Â Â Â Â Â stopCarousel();
Â Â Â Â }
Â Â }

Â Â // ===== è¡¨å–®æ¨¡å¼ï¼æ¸…é™¤ (ç•¥) =====
Â Â function setMediaMode(modeName) {
Â Â Â Â window.currentMediaMode = modeName || null;

Â Â Â Â const btnYoutube = document.getElementById("btn-media-youtube");
Â Â Â Â const btnUploadÂ  = document.getElementById("btn-media-upload");
Â Â Â Â const btnAudio Â  = document.getElementById("btn-media-audio");

Â Â Â Â const videoFields = document.getElementById("video-fields");
Â Â Â Â const audioFields = document.getElementById("audio-fields");

Â Â Â Â [btnYoutube, btnUpload, btnAudio].forEach((btn) => {
Â Â Â Â Â Â if (!btn) return;
Â Â Â Â Â Â btn.classList.toggle("active", btn.dataset.media === modeName);
Â Â Â Â });

Â Â Â Â if (videoFields) {
Â Â Â Â Â Â videoFields.classList.toggle("hidden", modeName !== "youtube" && modeName !== "upload");
Â Â Â Â }
Â Â Â Â if (audioFields) {
Â Â Â Â Â Â audioFields.classList.toggle("hidden", modeName !== "audio");
Â Â Â Â }
Â Â }

Â Â function clearRecordedMediaState() {
Â Â Â Â window.recordedAudioBlob = null;
Â Â Â Â window.recordedVideoBlob = null;

Â Â Â Â const audioPreview = document.getElementById("audio-rec-preview");
Â Â Â Â if (audioPreview) {
Â Â Â Â Â Â audioPreview.src = "";
Â Â Â Â }
Â Â }

Â Â function resetFormToAddMode() {
Â Â Â Â const formÂ  Â  Â  = document.getElementById("community-form");
Â Â Â Â const btnNewÂ  Â  = document.getElementById("btn-new");
Â Â Â Â const submitBtn = document.getElementById("submit-btn");
Â Â Â Â const nickElÂ  Â  = document.getElementById("nickname-input");
Â Â Â Â const textElÂ  Â  = document.getElementById("text-input");

Â Â Â Â if (form) {
Â Â Â Â Â Â form.reset?.();
Â Â Â Â Â Â form.classList.add("hidden");
Â Â Â Â Â Â form.style.display = "none";
Â Â Â Â Â Â form.classList.remove("form-open-state");
Â Â Â Â }

Â Â Â Â if (btnNew) {
Â Â Â Â Â Â btnNew.textContent = "æ–°å¢";
Â Â Â Â }

Â Â Â Â if (submitBtn) {
Â Â Â Â Â Â submitBtn.textContent = "ç™¼è¡¨";
Â Â Â Â Â Â submitBtn.disabled = true;
Â Â Â Â }

Â Â Â Â if (nickEl) {
Â Â Â Â Â Â nickEl.disabled = false;
Â Â Â Â Â Â nickEl.placeholder = "Mr,s 09â€¦.";
Â Â Â Â }
Â Â Â Â if (textEl) {
Â Â Â Â Â Â textEl.disabled = false;
Â Â Â Â Â Â textEl.style.opacity = "1";
Â Â Â Â }

Â Â Â Â setMediaMode(null);
Â Â Â Â clearRecordedMediaState();

Â Â Â Â isFormOpen = false;
Â Â Â Â isAddModeÂ  = false;
Â Â Â Â editState.active = false;
Â Â Â Â editState.waitForSelect = false;
Â Â Â Â editState.nameVerified = false;

Â Â Â Â const hint = document.getElementById("edit-wait-hint");
Â Â Â Â if (hint) hint.classList.add("hidden");
Â Â }

Â Â // ===== åç¨±é©—è­‰ / é€å‡ºæŒ‰éˆ•ç‹€æ…‹ (ç•¥) =====
Â Â function tryUnlockEditByName() {
Â Â Â Â const nickElÂ  Â  = document.getElementById("nickname-input");
Â Â Â Â const textElÂ  Â  = document.getElementById("text-input");
Â Â Â Â const submitBtn = document.getElementById("submit-btn");
Â Â Â Â if (!nickEl || !textEl || !submitBtn) return;
Â Â Â Â if (!editState.active) return;
Â Â Â Â if (isComposingName) return;

Â Â Â Â const inputName = String(nickEl.value || "").trim();
Â Â Â Â const originalÂ  = String(editState.nickname || "").trim();

Â Â Â Â if (inputName && inputName === original) {
Â Â Â Â Â Â editState.nameVerified = true;
Â Â Â Â Â Â textEl.disabled = false;
Â Â Â Â Â Â textEl.style.opacity = "1";
Â Â Â Â Â Â submitBtn.disabled = !textEl.value.trim();
Â Â Â Â } else {
Â Â Â Â Â Â editState.nameVerified = false;
Â Â Â Â Â Â textEl.disabled = true;
Â Â Â Â Â Â textEl.style.opacity = "0.6";
Â Â Â Â Â Â submitBtn.disabled = true;
Â Â Â Â }
Â Â }

Â Â function updateSubmitButtonState() {
Â Â Â Â const nickElÂ  Â  = document.getElementById("nickname-input");
Â Â Â Â const textElÂ  Â  = document.getElementById("text-input");
Â Â Â Â const submitBtn = document.getElementById("submit-btn");
Â Â Â Â if (!nickEl || !textEl || !submitBtn) return;

Â Â Â Â const nickname = (nickEl.value || "").trim();
Â Â Â Â const text Â  Â  = (textEl.value || "").trim();

Â Â Â Â if (editState.active) {
Â Â Â Â Â Â submitBtn.disabled = !(editState.nameVerified && text.length > 0 && text.length <= 100);
Â Â Â Â } else {
Â Â Â Â Â Â const okName = validateNameLength(nickname);
Â Â Â Â Â Â const okText = text.length > 0 && text.length <= 100;
Â Â Â Â Â Â submitBtn.disabled = !(okName && okText);
Â Â Â Â }
Â Â }

Â Â // ===== è³‡æ–™è¼‰å…¥ & è¡¨æ ¼æ¸²æŸ“ (ç•¥) =====
Â Â async function loadComments(postActionRowId = null) {
Â Â Â Â const res = await fetch(API_URL + "?action=list", { cache: "no-cache" });
Â Â Â Â const data = await res.json();
Â Â Â Â commentsCache = data.posts || [];
Â Â Â Â renderCommentsTable();

Â Â Â Â if (autoSelectParams.id) {
Â Â Â Â Â Â checkUrlForAutoSelect(true);
Â Â Â Â } else if (postActionRowId) {
Â Â Â Â Â Â const row = findRowById(postActionRowId);
Â Â Â Â Â Â if (row) {
Â Â Â Â Â Â Â Â selectRowForReply(row, false);
Â Â Â Â Â Â }
Â Â Â Â } else {
Â Â Â Â Â Â startCarousel();
Â Â Â Â }
Â Â }

Â Â function renderCommentsTable() {
Â Â Â Â const tbody = document.getElementById("comments-tbody");
Â Â Â Â if (!tbody) return;

Â Â Â Â if (!commentsCache.length) {
Â Â Â Â Â Â tbody.innerHTML = `<tr><td colspan="3">ç›®å‰å°šç„¡é …ç›®</td></tr>`;
Â Â Â Â Â Â return;
Â Â Â Â }

Â Â Â Â const rows = commentsCache.slice().reverse();

Â Â Â Â const html = rows.map((row) => {
Â Â Â Â Â Â const nick = maskName(row.nickname);
Â Â Â Â Â Â const full = String(row.text || "");
Â Â Â Â Â Â const displayLongText = escapeHtml(full);

Â Â Â Â Â Â const type = row.type || "text";
Â Â Â Â Â Â const hasYoutube = type === "youtube" && row.youtubeUrl;
Â Â Â Â Â Â const hasDrive Â  = type === "upload" && row.driveFileId;
Â Â Â Â Â Â const hasAudio Â  = type === "audio" && (row.hasAudio || row.driveAudioId);
Â Â Â Â Â Â const hasReply Â  = row.reply && String(row.reply).trim().length > 0;

Â Â Â Â Â Â const icons = [];
Â Â Â Â Â Â if (hasAudio)Â  icons.push(`<span class="media-flag" title="éŒ„éŸ³">ğŸµ</span>`);
Â Â Â Â Â Â if (hasYoutube) icons.push(`<span class="media-flag" title="å½±ç‰‡">â–¶ï¸</span>`);
Â Â Â Â Â Â else if (hasDrive) icons.push(`<span class="media-flag" title="ä¸Šå‚³">ğŸ–¼ï¸</span>`);
Â Â Â Â Â Â if (hasReply) icons.push(`<span class="media-flag" title="å·²å›è¦†">ğŸ’¬</span>`);

Â Â Â Â Â Â const mediaHtml = icons.length
Â Â Â Â Â Â Â Â ? `<div class="media-icons">${icons.join("")}</div>`
Â Â Â Â Â Â Â Â : `<div class="media-icons"><span style="opacity:.5">â€”</span></div>`;

Â Â Â Â Â Â const selected =
Â Â Â Â Â Â Â Â String(row.id) === String(currentSelectedId) ? ` class="selected"` : "";

Â Â Â Â Â Â return `
Â Â Â Â Â Â Â Â <tr data-id="${row.id}"${selected}>
Â Â Â Â Â Â Â Â Â Â <td class="col-nick">${escapeHtml(nick)}</td>
Â Â Â Â Â Â Â Â Â Â <td class="col-text">${displayLongText}</td>
Â Â Â Â Â Â Â Â Â Â <td class="col-media">${mediaHtml}</td>
Â Â Â Â Â Â Â Â </tr>
Â Â Â Â Â Â `;
Â Â Â Â }).join("");

Â Â Â Â tbody.innerHTML = html;
Â Â }

Â Â // ===== ç·¨è¼¯ header æŒ‰éˆ• (ç•¥) =====
Â Â function setupEditHeaderButton() {
Â Â Â Â const btn = document.getElementById("btn-edit");
Â Â Â Â if (!btn) return;

Â Â Â Â btn.addEventListener("click", () => {
Â Â Â Â Â Â editState.waitForSelect = true;
Â Â Â Â Â Â editState.active = false;
Â Â Â Â Â Â isAddMode = false;

Â Â Â Â Â Â const hint = document.getElementById("edit-wait-hint");
Â Â Â Â Â Â if (hint) hint.classList.remove("hidden");
Â Â Â Â });
Â Â }

Â Â function startEditForRow(row) {
Â Â Â Â if (!row) return;

Â Â Â Â selectRowForReply(row, false);

Â Â Â Â const hint = document.getElementById("edit-wait-hint");
Â Â Â Â if (hint) hint.classList.add("hidden");

Â Â Â Â editState.active Â  Â  Â  = true;
Â Â Â Â editState.id Â  Â  Â  Â  Â  = row.id;
Â Â Â Â editState.nickname Â  Â  = row.nickname;
Â Â Â Â editState.originalText = row.text || "";
Â Â Â Â editState.waitForSelect = false;
Â Â Â Â editState.nameVerified = false;

Â Â Â Â const formÂ  Â  Â  = document.getElementById("community-form");
Â Â Â Â const btnNewÂ  Â  = document.getElementById("btn-new");
Â Â Â Â const nickElÂ  Â  = document.getElementById("nickname-input");
Â Â Â Â const textElÂ  Â  = document.getElementById("text-input");
Â Â Â Â const submitBtn = document.getElementById("submit-btn");

Â Â Â Â if (form) {
Â Â Â Â Â Â form.classList.remove("hidden");
Â Â Â Â Â Â form.style.display = "block";
Â Â Â Â Â Â form.classList.add("form-open-state");
Â Â Â Â }
Â Â Â Â isFormOpen = true;
Â Â Â Â isAddModeÂ  = false;

Â Â Â Â if (btnNew) btnNew.textContent = "å–æ¶ˆç·¨è¼¯";

Â Â Â Â if (submitBtn) {
Â Â Â Â Â Â submitBtn.textContent = "å„²å­˜ä¿®æ”¹";
Â Â Â Â Â Â submitBtn.disabled = true;
Â Â Â Â }

Â Â Â Â if (nickEl) {
Â Â Â Â Â Â nickEl.disabled = false;
Â Â Â Â Â Â nickEl.value = "";
Â Â Â Â Â Â nickEl.placeholder = "è«‹è¼¸å…¥ç•¶åˆçš„ usernameï¼ˆå®Œå…¨ä¸€è‡´ï¼‰";
Â Â Â Â Â Â nickEl.focus();
Â Â Â Â }

Â Â Â Â if (textEl) {
Â Â Â Â Â Â textEl.value = editState.originalText;
Â Â Â Â Â Â textEl.disabled = true;
Â Â Â Â Â Â textEl.style.opacity = "0.6";
Â Â Â Â }

Â Â Â Â setMediaMode(null);
Â Â Â Â clearRecordedMediaState();
Â Â }

Â Â // ===== è¡¨æ ¼é»æ“Š (ç•¥) =====
Â Â function setupTableClicks() {
Â Â Â Â const tbody = document.getElementById("comments-tbody");
Â Â Â Â if (!tbody) return;

Â Â Â Â tbody.addEventListener("click", (e) => {
Â Â Â Â Â Â const tr = e.target.closest("tr[data-id]");
Â Â Â Â Â Â if (!tr) return;

Â Â Â Â Â Â const idÂ  = tr.getAttribute("data-id");
Â Â Â Â Â Â const row = findRowById(id);
Â Â Â Â Â Â if (!row) return;

Â Â Â Â Â Â if (editState.waitForSelect) {
Â Â Â Â Â Â Â Â startEditForRow(row);
Â Â Â Â Â Â Â Â return;
Â Â Â Â Â Â }

Â Â Â Â Â Â selectRowForReply(row, false);
Â Â Â Â });
Â Â }

Â Â // ===== å°è¦½æŒ‰éˆ•ï¼ˆæ‰‹æ©Ÿé ‚ç«¯ Back / é …ç›®ï¼‰ (ç•¥) =====
Â Â function setupNavigationButtons() {
Â Â Â Â const mobileBackButtonÂ  = document.getElementById("mobile-back-button");
Â Â Â Â const mobileItemsButton = document.getElementById("mobile-items-button");

Â Â Â Â if (mobileBackButton) {
Â Â Â Â Â Â mobileBackButton.addEventListener("click", () => {
Â Â Â Â Â Â Â Â window.scrollTo({ top: 0, behavior: "smooth" });
Â Â Â Â Â Â });
Â Â Â Â }

Â Â Â Â if (mobileItemsButton) {
Â Â Â Â Â Â mobileItemsButton.addEventListener("click", () => {
Â Â Â Â Â Â Â Â const el = document.getElementById("comments-section");
Â Â Â Â Â Â Â Â if (el) {
Â Â Â Â Â Â Â Â Â Â el.scrollIntoView({ behavior: "smooth", block: "start" });
Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â });
Â Â Â Â }
Â Â }

Â Â // ===== From: æŒ‰éˆ• (ç•¥) =====
Â Â function setupReplyTargetButton() {
Â Â Â Â const btn = document.getElementById("reply-target-btn");
Â Â Â Â if (!btn) return;

Â Â Â Â btn.addEventListener("click", () => {
Â Â Â Â Â Â const id = btn.getAttribute("data-id");
Â Â Â Â Â Â if (!id) return;

Â Â Â Â Â Â const tbody = document.getElementById("comments-tbody");
Â Â Â Â Â Â if (!tbody) return;

Â Â Â Â Â Â const tr = tbody.querySelector(`tr[data-id="${id}"]`);
Â Â Â Â Â Â if (!tr) return;

Â Â Â Â Â Â tr.scrollIntoView({ behavior: "smooth", block: "center" });
Â Â Â Â Â Â tr.classList.add("row-flash");
Â Â Â Â Â Â setTimeout(() => tr.classList.remove("row-flash"), 800);
Â Â Â Â });
Â Â }

Â Â // ===== å›è¦†å€åˆå§‹åŒ– (ç•¥) =====
Â Â function setupAdminReply() {
Â Â Â Â const box = document.getElementById("admin-reply");
Â Â Â Â if (!box) return;

Â Â Â Â ensureReplyPrefix();
Â Â Â Â autoResizeReply();

Â Â Â Â box.addEventListener("input", () => {
Â Â Â Â Â Â ensureReplyPrefix();
Â Â Â Â Â Â autoResizeReply();
Â Â Â Â });

Â Â Â Â box.addEventListener("click", () => {
Â Â Â Â Â Â ensureReplyPrefix();
Â Â Â Â });

Â Â Â Â box.addEventListener("blur", () => {
Â Â Â Â Â Â saveAdminReply();
Â Â Â Â });
Â Â }

Â Â // ===== username è¼¸å…¥é˜²å‘† (ç•¥) =====
Â Â function setupEditNameGuard() {
Â Â Â Â const nickEl = document.getElementById("nickname-input");
Â Â Â Â if (!nickEl) return;

Â Â Â Â nickEl.addEventListener("compositionstart", () => {
Â Â Â Â Â Â isComposingName = true;
Â Â Â Â });
Â Â Â Â nickEl.addEventListener("compositionend", () => {
Â Â Â Â Â Â isComposingName = false;
Â Â Â Â Â Â tryUnlockEditByName();
Â Â Â Â Â Â updateSubmitButtonState();
Â Â Â Â });

Â Â Â Â nickEl.addEventListener("input", () => {
Â Â Â Â Â Â tryUnlockEditByName();
Â Â Â Â Â Â updateSubmitButtonState();
Â Â Â Â });
Â Â Â Â nickEl.addEventListener("change", tryUnlockEditByName);
Â Â Â Â nickEl.addEventListener("blur", Â  tryUnlockEditByName);

Â Â Â Â nickEl.addEventListener("keydown", (ev) => {
Â Â Â Â Â Â if (ev.key === "Enter") {
Â Â Â Â Â Â Â Â ev.preventDefault();
Â Â Â Â Â Â Â Â tryUnlockEditByName();
Â Â Â Â Â Â }
Â Â Â Â });
Â Â }

Â Â // ===== é …ç›®è¼¸å…¥æ¬„é˜² Enter (ç•¥) =====
Â Â function setupTextInputEnterGuard() {
Â Â Â Â const textEl = document.getElementById("text-input");
Â Â Â Â if (!textEl) return;

Â Â Â Â textEl.addEventListener("input", updateSubmitButtonState);

Â Â Â Â textEl.addEventListener("keydown", (ev) => {
Â Â Â Â Â Â if (ev.key === "Enter") {
Â Â Â Â Â Â Â Â ev.preventDefault();
Â Â Â Â Â Â }
Â Â Â Â });
Â Â }

Â Â // ===== æ–°å¢ï¼ç·¨è¼¯é€å‡º (ç•¥) =====
Â Â async function handleSubmit(e) {
Â Â Â Â e.preventDefault();

Â Â Â Â const submitBtn = document.getElementById("submit-btn");
Â Â Â Â if (submitBtn && submitBtn.disabled) return;

Â Â Â Â const nickElÂ  Â  = document.getElementById("nickname-input");
Â Â Â Â const textElÂ  Â  = document.getElementById("text-input");
Â Â Â Â const ytElÂ  Â  Â  = document.getElementById("youtube-url-input");
Â Â Â Â const startEl Â  = document.getElementById("start-input");
Â Â Â Â const endEl Â  Â  = document.getElementById("end-input");
Â Â Â Â const videoFile = document.getElementById("video-file-input");
Â Â Â Â const audioFile = document.getElementById("audio-file-input");

Â Â Â Â const nicknameÂ  = (nickEl?.value || "").trim();
Â Â Â Â const textÂ  Â  Â  = (textEl?.value || "").trim();
Â Â Â Â const youtubeUrl= (ytEl?.value || "").trim();
Â Â Â Â const startSecÂ  = parseTimeToSec(startEl?.value);
Â Â Â Â const endSecÂ  Â  = parseTimeToSec(endEl?.value);
Â Â Â Â const vFile Â  Â  = videoFile && videoFile.files[0];
Â Â Â Â const aFile Â  Â  = audioFile && audioFile.files[0];

Â Â Â Â const isEditing = editState.active && editState.id;

Â Â Â Â if (!validateNameLength(nickname)) {
Â Â Â Â Â Â alert("username è«‹ä½¿ç”¨ 5â€“12 å€‹ä¸­è‹±æ–‡æˆ–æ•¸å­—ï¼ˆä¸å«ç©ºç™½èˆ‡ç¬¦è™Ÿï¼‰ã€‚");
Â Â Â Â Â Â if (nickEl) nickEl.focus();
Â Â Â Â Â Â return;
Â Â Â Â }

Â Â Â Â if (!text) {
Â Â Â Â Â Â alert("è«‹å…ˆè¼¸å…¥ã€Œé …ç›®ã€èªªæ˜ï¼ˆ100 å­—å…§ï¼‰ã€‚");
Â Â Â Â Â Â if (textEl) textEl.focus();
Â Â Â Â Â Â return;
Â Â Â Â }
Â Â Â Â if (text.length > 100) {
Â Â Â Â Â Â alert("èªªæ˜è«‹æ§åˆ¶åœ¨ 100 å­—ä»¥å…§ã€‚");
Â Â Â Â Â Â if (textEl) textEl.focus();
Â Â Â Â Â Â return;
Â Â Â Â }

Â Â Â Â if (isEditing) {
Â Â Â Â Â Â if (!editState.nameVerified) {
Â Â Â Â Â Â Â Â alert("è«‹å…ˆè¼¸å…¥ç•¶åˆå¡«å¯«çš„ username ä¸¦ç¢ºä¿å®Œå…¨ä¸€è‡´ä»¥é€²è¡Œç·¨è¼¯é©—è­‰ã€‚");
Â Â Â Â Â Â Â Â if (nickEl) nickEl.focus();
Â Â Â Â Â Â Â Â return;
Â Â Â Â Â Â }
Â Â Â Â } else {
Â Â Â Â Â Â if (youtubeUrl && (vFile || aFile || window.recordedAudioBlob)) {
Â Â Â Â Â Â Â Â alert("å½±ç‰‡/ç¶²é é€£çµä¸å¯åŒæ™‚æ­é…å½±ç‰‡æª” / éŒ„éŸ³ï¼Œè«‹æ“‡ä¸€ç¨®åª’é«”ä¾†æºã€‚");
Â Â Â Â Â Â Â Â return;
Â Â Â Â Â Â }
Â Â Â Â Â Â if (aFile && window.recordedAudioBlob) {
Â Â Â Â Â Â Â Â alert("éŸ³æª”ä¸Šå‚³èˆ‡éŒ„éŸ³è«‹æ“‡ä¸€ã€‚");
Â Â Â Â Â Â Â Â return;
Â Â Â Â Â Â }
Â Â Â Â }

Â Â Â Â try {
Â Â Â Â Â Â if (isEditing) {
Â Â Â Â Â Â Â Â const params = new URLSearchParams({
Â Â Â Â Â Â Â Â Â Â action: "edit",
Â Â Â Â Â Â Â Â Â Â id: String(editState.id),
Â Â Â Â Â Â Â Â Â Â text
Â Â Â Â Â Â Â Â });
Â Â Â Â Â Â Â Â const resÂ  = await fetch(API_URL + "?" + params.toString());
Â Â Â Â Â Â Â Â const data = await res.json();

Â Â Â Â Â Â Â Â if (!data || data.status !== "ok") {
Â Â Â Â Â Â Â Â Â Â throw new Error(data && data.error ? data.error : "edit å¤±æ•—");
Â Â Â Â Â Â Â Â }

Â Â Â Â Â Â Â Â const editedId = editState.id;
Â Â Â Â Â Â Â Â resetFormToAddMode();
Â Â Â Â Â Â Â Â await loadComments(editedId);
Â Â Â Â Â Â Â Â return;
Â Â Â Â Â Â }

Â Â Â Â Â Â // æ–°å¢æ¨¡å¼
Â Â Â Â Â Â let type = "text";
Â Â Â Â Â Â const payload = {
Â Â Â Â Â Â Â Â action: "add",
Â Â Â Â Â Â Â Â nickname,
Â Â Â Â Â Â Â Â text,
Â Â Â Â Â Â Â Â startSec: (startSec === "" ? "" : String(startSec)),
Â Â Â Â Â Â Â Â endSec: Â  (endSec Â  === "" ? "" : String(endSec))
Â Â Â Â Â Â };

Â Â Â Â Â Â if (youtubeUrl) {
Â Â Â Â Â Â Â Â type = "youtube";
Â Â Â Â Â Â Â Â payload.type = type;
Â Â Â Â Â Â Â Â payload.youtubeUrl = youtubeUrl;
Â Â Â Â Â Â } else if (vFile) {
Â Â Â Â Â Â Â Â type = "upload";
Â Â Â Â Â Â Â Â payload.type = type;

Â Â Â Â Â Â Â Â const base64 Â  = await readFileAsBase64(vFile);
Â Â Â Â Â Â Â Â const mimeType = vFile.type || "application/octet-stream";
Â Â Â Â Â Â Â Â const fileName = vFile.name || ("video_" + Date.now());
Â Â Â Â Â Â Â Â payload.videoBase64 = base64;
Â Â Â Â Â Â Â Â payload.mimeTypeÂ  Â  = mimeType;
Â Â Â Â Â Â Â Â payload.fileNameÂ  Â  = fileName;
Â Â Â Â Â Â } else if (aFile || window.recordedAudioBlob) {
Â Â Â Â Â Â Â Â type = "audio";
Â Â Â Â Â Â Â Â payload.type = type;

Â Â Â Â Â Â Â Â let blobToUse = null;
Â Â Â Â Â Â Â Â let mimeTypeÂ  = "audio/webm";
Â Â Â Â Â Â Â Â let fileNameÂ  = "audio_" + Date.now() + ".webm";
Â Â Â Â Â Â Â Â if (aFile) {
Â Â Â Â Â Â Â Â Â Â blobToUse = aFile;
Â Â Â Â Â Â Â Â Â Â mimeTypeÂ  = aFile.type || mimeType;
Â Â Â Â Â Â Â Â Â Â fileNameÂ  = aFile.name || fileName;
Â Â Â Â Â Â Â Â } else if (window.recordedAudioBlob) {
Â Â Â Â Â Â Â Â Â Â blobToUse = window.recordedAudioBlob;
Â Â Â Â Â Â Â Â Â Â mimeTypeÂ  = window.recordedAudioBlob.type || mimeType;
Â Â Â Â Â Â Â Â }

Â Â Â Â Â Â Â Â if (blobToUse) {
Â Â Â Â Â Â Â Â Â Â const base64 = await readFileAsBase64(blobToUse);
Â Â Â Â Â Â Â Â Â Â payload.audioBase64Â  Â  = base64;
Â Â Â Â Â Â Â Â Â Â payload.audioMimeTypeÂ  = mimeType;
Â Â Â Â Â Â Â Â Â Â payload.audioFileNameÂ  = fileName;
Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â } else {
Â Â Â Â Â Â Â Â payload.type = "text";
Â Â Â Â Â Â }

Â Â Â Â Â Â const res = await fetch(API_URL, {
Â Â Â Â Â Â Â Â method: "POST",
Â Â Â Â Â Â Â Â headers: { "Content-Type": "text/plain;charset=utf-8" },
Â Â Â Â Â Â Â Â body: JSON.stringify(payload),
Â Â Â Â Â Â });

Â Â Â Â Â Â let data;
Â Â Â Â Â Â try {
Â Â Â Â Â Â Â Â data = await res.json();
Â Â Â Â Â Â } catch (err) {
Â Â Â Â Â Â Â Â throw new Error("ç„¡æ³•è§£æä¼ºæœå™¨å›æ‡‰ï¼ˆå¯èƒ½æ˜¯æ¬Šé™æˆ– CORS å•é¡Œï¼‰");
Â Â Â Â Â Â }

Â Â Â Â Â Â if (!data || data.status !== "ok" || !data.id) {
Â Â Â Â Â Â Â Â throw new Error(data && data.error ? data.error : "add å¤±æ•—");
Â Â Â Â Â Â }

Â Â Â Â Â Â const newRowId = data.id;
Â Â Â Â Â Â resetFormToAddMode();
Â Â Â Â Â Â await loadComments(newRowId);

Â Â Â Â } catch (err) {
Â Â Â Â Â Â console.error(err);
Â Â Â Â Â Â alert((isEditing ? "å„²å­˜æ–‡å­—ä¿®æ”¹å¤±æ•—ï¼š" : "é€å‡ºç•™è¨€å¤±æ•—ï¼š") + err.message);
Â Â Â Â }
Â Â }

Â Â function bindToolbarAndForm() {
Â Â Â Â const form Â  Â  Â  = document.getElementById("community-form");
Â Â Â Â const btnNew Â  Â  = document.getElementById("btn-new");
Â Â Â Â const btnYoutube = document.getElementById("btn-media-youtube");
Â Â Â Â const btnUploadÂ  = document.getElementById("btn-media-upload");
Â Â Â Â const btnAudio Â  = document.getElementById("btn-media-audio");

Â Â Â Â if (!form) return;

Â Â Â Â form.classList.add("hidden");
Â Â Â Â form.style.display = "none";
Â Â Â Â setMediaMode(null);
Â Â Â Â isFormOpen = false;
Â Â Â Â isAddModeÂ  = false;

Â Â Â Â if (btnNew) {
Â Â Â Â Â Â btnNew.addEventListener("click", () => {
Â Â Â Â Â Â Â Â if (!isFormOpen) {
Â Â Â Â Â Â Â Â Â Â stopCarousel();

Â Â Â Â Â Â Â Â Â Â editState.active = false;
Â Â Â Â Â Â Â Â Â Â editState.waitForSelect = false;
Â Â Â Â Â Â Â Â Â Â isAddMode = true;

Â Â Â Â Â Â Â Â Â Â form.classList.remove("hidden");
Â Â Â Â Â Â Â Â Â Â form.style.display = "block";
Â Â Â Â Â Â Â Â Â Â form.classList.add("form-open-state");
Â Â Â Â Â Â Â Â Â Â btnNew.textContent = "å–æ¶ˆæ–°å¢";
Â Â Â Â Â Â Â Â Â Â isFormOpen = true;

Â Â Â Â Â Â Â Â Â Â const nickEl = document.getElementById("nickname-input");
Â Â Â Â Â Â Â Â Â Â const textEl = document.getElementById("text-input");
Â Â Â Â Â Â Â Â Â Â if (nickEl) {
Â Â Â Â Â Â Â Â Â Â Â Â nickEl.disabled = false;
Â Â Â Â Â Â Â Â Â Â Â Â nickEl.placeholder = "Mr,s 09â€¦.";
Â Â Â Â Â Â Â Â Â Â Â Â nickEl.value = "";
Â Â Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â Â Â if (textEl) {
Â Â Â Â Â Â Â Â Â Â Â Â textEl.disabled = false;
Â Â Â Â Â Â Â Â Â Â Â Â textEl.style.opacity = "1";
Â Â Â Â Â Â Â Â Â Â Â Â textEl.value = "";
Â Â Â Â Â Â Â Â Â Â }

Â Â Â Â Â Â Â Â Â Â setMediaMode(null);
Â Â Â Â Â Â Â Â Â Â clearRecordedMediaState();
Â Â Â Â Â Â Â Â Â Â updateSubmitButtonState();
Â Â Â Â Â Â Â Â } else {
Â Â Â Â Â Â Â Â Â Â resetFormToAddMode();
Â Â Â Â Â Â Â Â Â Â if (!currentSelectedId) {
Â Â Â Â Â Â Â Â Â Â Â Â startCarousel();
Â Â Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â });
Â Â Â Â }

Â Â Â Â function bindMediaButton(btn, modeName) {
Â Â Â Â Â Â if (!btn) return;
Â Â Â Â Â Â btn.addEventListener("click", () => {
Â Â Â Â Â Â Â Â if (editState.active) return;
Â Â Â Â Â Â Â Â if (btn.disabled) return;

Â Â Â Â Â Â Â Â if (window.currentMediaMode === modeName) {
Â Â Â Â Â Â Â Â Â Â setMediaMode(null);
Â Â Â Â Â Â Â Â } else {
Â Â Â Â Â Â Â Â Â Â setMediaMode(modeName);
Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â clearRecordedMediaState();

Â Â Â Â Â Â Â Â const ytEl Â  Â  Â  = document.getElementById("youtube-url-input");
Â Â Â Â Â Â Â Â const startElÂ  Â  = document.getElementById("start-input");
Â Â Â Â Â Â Â Â const endElÂ  Â  Â  = document.getElementById("end-input");
Â Â Â Â Â Â Â Â const videoFileÂ  = document.getElementById("video-file-input");
Â Â Â Â Â Â Â Â const videoLabel = document.getElementById("video-file-label");
Â Â Â Â Â Â Â Â const audioFileÂ  = document.getElementById("audio-file-input");
Â Â Â Â Â Â Â Â const audioLabel = document.getElementById("audio-file-label");

Â Â Â Â Â Â Â Â if (modeName === "youtube") {
Â Â Â Â Â Â Â Â Â Â if (videoFile)Â  videoFile.value = "";
Â Â Â Â Â Â Â Â Â Â if (videoLabel) videoLabel.textContent = "";
Â Â Â Â Â Â Â Â Â Â if (audioFile)Â  audioFile.value = "";
Â Â Â Â Â Â Â Â Â Â if (audioLabel) audioLabel.textContent = "";
Â Â Â Â Â Â Â Â } else if (modeName === "upload") {
Â Â Â Â Â Â Â Â Â Â if (ytEl) Â  Â  ytEl.value = "";
Â Â Â Â Â Â Â Â Â Â if (startEl)Â  startEl.value = "";
Â Â Â Â Â Â Â Â Â Â if (endEl)Â  Â  endEl.value = "";
Â Â Â Â Â Â Â Â Â Â if (audioFile)Â  audioFile.value = "";
Â Â Â Â Â Â Â Â Â Â if (audioLabel) audioLabel.textContent = "";
Â Â Â Â Â Â Â Â } else if (modeName === "audio") {
Â Â Â Â Â Â Â Â Â Â if (ytEl) Â  Â  ytEl.value = "";
Â Â Â Â Â Â Â Â Â Â if (startEl)Â  startEl.value = "";
Â Â Â Â Â Â Â Â Â Â if (endEl)Â  Â  endEl.value = "";
Â Â Â Â Â Â Â Â Â Â if (videoFile)Â  videoFile.value = "";
Â Â Â Â Â Â Â Â Â Â if (videoLabel) videoLabel.textContent = "";
Â Â Â Â Â Â Â Â }

Â Â Â Â Â Â Â Â updateSubmitButtonState();
Â Â Â Â Â Â });
Â Â Â Â }

Â Â Â Â bindMediaButton(btnYoutube, "youtube");
Â Â Â Â bindMediaButton(btnUpload,Â  "upload");
Â Â Â Â bindMediaButton(btnAudio, Â  "audio");

Â Â Â Â const videoFileÂ  = document.getElementById("video-file-input");
Â Â Â Â const videoLabel = document.getElementById("video-file-label");
Â Â Â Â const audioFileÂ  = document.getElementById("audio-file-input");
Â Â Â Â const audioLabel = document.getElementById("audio-file-label");

Â Â Â Â if (videoFile && videoLabel) {
Â Â Â Â Â Â videoFile.addEventListener("change", () => {
Â Â Â Â Â Â Â Â if (videoFile.files && videoFile.files[0]) {
Â Â Â Â Â Â Â Â Â Â videoLabel.textContent = "å·²é¸æ“‡ï¼š" + videoFile.files[0].name;
Â Â Â Â Â Â Â Â } else {
Â Â Â Â Â Â Â Â Â Â videoLabel.textContent = "";
Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â updateSubmitButtonState();
Â Â Â Â Â Â });
Â Â Â Â }

Â Â Â Â if (audioFile && audioLabel) {
Â Â Â Â Â Â audioFile.addEventListener("change", () => {
Â Â Â Â Â Â Â Â if (audioFile.files && audioFile.files[0]) {
Â Â Â Â Â Â Â Â Â Â audioLabel.textContent = "å·²é¸æ“‡ï¼š" + audioFile.files[0].name;
Â Â Â Â Â Â Â Â } else {
Â Â Â Â Â Â Â Â Â Â audioLabel.textContent = "";
Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â updateSubmitButtonState();
Â Â Â Â Â Â });
Â Â Â Â }

Â Â Â Â form.addEventListener("submit", handleSubmit);
Â Â }

Â Â // ===== å½±ç‰‡æµ®æ°´å°ï¼ˆæ‰“é–‹è²éŸ³ / æ’­æ”¾ï¼‰ =====
Â Â function setupVideoWatermark() {
Â Â Â Â const watermark = document.getElementById("video-watermark");
Â Â Â Â if (!watermark) return;

Â Â Â Â const watermarkContent = watermark.querySelector(".video-watermark-content");
Â Â Â Â if (!watermarkContent) return;

Â Â Â Â watermark.addEventListener("click", () => {
Â Â Â Â Â Â isVideoMuted = false;
Â Â Â Â Â Â watermark.style.display = "none";

Â Â Â Â Â Â const currentId = currentSelectedId;
Â Â Â Â Â Â if (currentId) {
Â Â Â Â Â Â Â Â const row = findRowById(currentId);
Â Â Â Â Â Â Â Â if (row && row.type === "youtube" && ytPlayer) {
Â Â Â Â Â Â Â Â Â Â try {
Â Â Â Â Â Â Â Â Â Â Â Â ytPlayer.unMute();
Â Â Â Â Â Â Â Â Â Â Â Â ytPlayer.playVideo();
Â Â Â Â Â Â Â Â Â Â } catch (e) {}
Â Â Â Â Â Â Â Â } else if (row) {
Â Â Â Â Â Â Â Â Â Â // é YouTubeï¼Œå°±é‡æ–°é¡¯ç¤ºä¸€æ¬¡
Â Â Â Â Â Â Â Â Â Â showVideoForRow(row, false);
Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â }

Â Â Â Â Â Â handleUserInteraction();
Â Â Â Â });
Â Â }

Â Â // ===== è¼ªæ’­æ§åˆ¶ (ç•¥) =====
Â Â function startCarousel() {
Â Â Â Â stopCarousel();

Â Â Â Â carouselItems = commentsCache
Â Â Â Â Â Â .slice()
Â Â Â Â Â Â .filter(row => {
Â Â Â Â Â Â Â Â const hasMedia =
Â Â Â Â Â Â Â Â Â Â (row.type === "youtube" && row.youtubeUrl) ||
Â Â Â Â Â Â Â Â Â Â (row.type === "upload"Â  && row.driveFileId) ||
Â Â Â Â Â Â Â Â Â Â (row.type === "audio" Â  && (row.hasAudio || row.driveAudioId));
Â Â Â Â Â Â Â Â const hasReply = row.reply && String(row.reply).trim().length > 0;
Â Â Â Â Â Â Â Â return hasMedia || hasReply;
Â Â Â Â Â Â })
Â Â Â Â Â Â .reverse();

Â Â Â Â if (carouselItems.length < 1) {
Â Â Â Â Â Â return;
Â Â Â Â }

Â Â Â Â const initialRow = carouselItems[0];
Â Â Â Â if (initialRow) {
Â Â Â Â Â Â isVideoMuted = true;
Â Â Â Â Â Â setTimeout(() => {
Â Â Â Â Â Â Â Â selectRowForReply(initialRow, true);
Â Â Â Â Â Â }, 500);
Â Â Â Â }

Â Â Â Â if (carouselItems.length > 1) {
Â Â Â Â Â Â carouselIndex = 0;
Â Â Â Â Â Â carouselInterval = setInterval(() => {
Â Â Â Â Â Â Â Â carouselIndex = (carouselIndex + 1) % carouselItems.length;
Â Â Â Â Â Â Â Â const nextRow = carouselItems[carouselIndex];
Â Â Â Â Â Â Â Â if (nextRow) {
Â Â Â Â Â Â Â Â Â Â isVideoMuted = true;
Â Â Â Â Â Â Â Â Â Â selectRowForReply(nextRow, true);
Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â }, CAROUSEL_DURATION);
Â Â Â Â }
Â Â }

Â Â function stopCarousel() {
Â Â Â Â if (carouselInterval) {
Â Â Â Â Â Â clearInterval(carouselInterval);
Â Â Â Â Â Â carouselInterval = null;
Â Â Â Â }
Â Â }

Â Â function handleUserInteraction() {
Â Â Â Â if (carouselInterval) {
Â Â Â Â Â Â stopCarousel();
Â Â Â Â }
Â Â Â Â isVideoMuted = false;
Â Â }

Â Â function setupUserInteractionListeners() {
Â Â Â Â window.addEventListener('click', handleUserInteraction);
Â Â Â Â window.addEventListener('wheel', handleUserInteraction);
Â Â Â Â window.addEventListener('keydown', handleUserInteraction);
Â Â Â Â window.addEventListener('touchstart', handleUserInteraction);
Â Â }

Â Â // ===== URL è‡ªå‹•é¸å– / ç·¨è¼¯ (ç•¥) =====
Â Â function checkUrlForAutoSelect(isInitialLoad = false) {
Â Â Â Â const urlParams = new URLSearchParams(window.location.search);
Â Â Â Â const id Â  = urlParams.get('editId');
Â Â Â Â const nick = urlParams.get('editNick');

Â Â Â Â if (id) {
Â Â Â Â Â Â stopCarousel();

Â Â Â Â Â Â const row = findRowById(id);
Â Â Â Â Â Â if (row) {
Â Â Â Â Â Â Â Â selectRowForReply(row, false);
Â Â Â Â Â Â Â Â startEditFromUrl(id, nick || "");

Â Â Â Â Â Â Â Â if (isInitialLoad && window.history.replaceState) {
Â Â Â Â Â Â Â Â Â Â const cleanUrl = window.location.pathname;
Â Â Â Â Â Â Â Â Â Â window.history.replaceState({}, document.title, cleanUrl);
Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â return true;
Â Â Â Â Â Â }
Â Â Â Â }
Â Â Â Â return false;
Â Â }

Â Â function startEditFromUrl(id, nickname) {
Â Â Â Â const row = findRowById(id);
Â Â Â Â if (!row) return;

Â Â Â Â editState.active Â  Â  Â  = true;
Â Â Â Â editState.id Â  Â  Â  Â  Â  = id;
Â Â Â Â editState.nickname Â  Â  = nickname.trim();
Â Â Â Â editState.originalText = row.text || '';
Â Â Â Â editState.nameVerified = false;
Â Â Â Â editState.waitForSelect = false;

Â Â Â Â const formÂ  Â  Â  = document.getElementById("community-form");
Â Â Â Â const btnNewÂ  Â  = document.getElementById("btn-new");
Â Â Â Â const nickElÂ  Â  = document.getElementById("nickname-input");
Â Â Â Â const textElÂ  Â  = document.getElementById("text-input");
Â Â Â Â const submitBtn = document.getElementById("submit-btn");

Â Â Â Â if (form) {
Â Â Â Â Â Â form.classList.remove("hidden");
Â Â Â Â Â Â form.style.display = "block";
Â Â Â Â Â Â form.classList.add("form-open-state");
Â Â Â Â }
Â Â Â Â if (btnNew) btnNew.textContent = "å–æ¶ˆç·¨è¼¯";
Â Â Â Â if (submitBtn) {
Â Â Â Â Â Â submitBtn.textContent = "å„²å­˜ä¿®æ”¹";
Â Â Â Â Â Â submitBtn.disabled = true;
Â Â Â Â }
Â Â Â Â isFormOpen = true;
Â Â Â Â isAddModeÂ  = false;

Â Â Â Â if (nickEl) {
Â Â Â Â Â Â nickEl.disabled = false;
Â Â Â Â Â Â nickEl.value = '';
Â Â Â Â Â Â nickEl.placeholder = `è«‹è¼¸å…¥åŸæœ¬ usernameï¼š${(nickname || "").slice(0, 4)}...`;
Â Â Â Â Â Â nickEl.focus();
Â Â Â Â }

Â Â Â Â if (textEl) {
Â Â Â Â Â Â textEl.value = editState.originalText;
Â Â Â Â Â Â textEl.disabled = true;
Â Â Â Â Â Â textEl.style.opacity = "0.6";
Â Â Â Â }

Â Â Â Â setMediaMode(null);
Â Â Â Â updateSubmitButtonState();
Â Â }

Â Â // ===== DOMContentLoaded =====
Â Â document.addEventListener("DOMContentLoaded", () => {
Â Â Â Â const urlParams = new URLSearchParams(window.location.search);
Â Â Â Â const id Â  = urlParams.get('editId');
Â Â Â Â const nick = urlParams.get('editNick');
Â Â Â Â if (id) {
Â Â Â Â Â Â autoSelectParams.id Â  = id;
Â Â Â Â Â Â autoSelectParams.nick = nick;
Â Â Â Â }

Â Â Â Â window.currentMediaMode = null;

Â Â Â Â // è¼‰å…¥ YouTube IFrame API
Â Â Â Â const ytTag = document.createElement("script");
Â Â Â Â ytTag.src = "https://www.youtube.com/iframe_api";
Â Â Â Â document.head.appendChild(ytTag);

Â Â Â Â bindToolbarAndForm();
Â Â Â Â setupTableClicks();
Â Â Â Â setupNavigationButtons();
Â Â Â Â setupAdminReply();
Â Â Â Â setupEditHeaderButton();
Â Â Â Â setupReplyTargetButton();
Â Â Â Â setupEditNameGuard();
Â Â Â Â setupTextInputEnterGuard();
Â Â Â Â setupVideoWatermark();
Â Â Â Â clearVideo();
Â Â Â Â setupUserInteractionListeners();
Â Â Â setupAudioRecording();

Â Â Â Â loadComments().catch((err) => {
Â Â Â Â Â Â console.error(err);
Â Â Â Â Â Â alert("è¼‰å…¥åˆ—è¡¨å¤±æ•—ï¼š" + err.message);
Â Â Â Â });
Â Â });


Â // ===== éŒ„éŸ³åŠŸèƒ½è¨­å®š =====
Â Â function setupAudioRecording() {
Â Â Â Â const startBtnÂ  = document.getElementById("audio-rec-start");
Â Â Â Â const stopBtn Â  = document.getElementById("audio-rec-stop");
Â Â Â Â const cancelBtn = document.getElementById("audio-rec-cancel");
Â Â Â Â const statusElÂ  = document.getElementById("audio-rec-status");
Â Â Â Â const previewEl = document.getElementById("audio-rec-preview");
Â Â Â Â const audioFile = document.getElementById("audio-file-input");
Â Â Â Â const audioLabel = document.getElementById("audio-file-label");

Â Â Â Â if (!startBtn || !stopBtn || !cancelBtn || !statusEl || !previewEl) return;

Â Â Â Â // ç€è¦½å™¨ä¸æ”¯æ´
Â Â Â Â if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
Â Â Â Â Â Â statusEl.textContent = "æ­¤ç€è¦½å™¨ä¸æ”¯æ´éŒ„éŸ³ï¼Œè«‹æ”¹ç”¨éŸ³æª”ä¸Šå‚³ã€‚";
Â Â Â Â Â Â startBtn.disabled = true;
Â Â Â Â Â Â stopBtn.disabled = true;
Â Â Â Â Â Â cancelBtn.disabled = true;
Â Â Â Â Â Â return;
Â Â Â Â }

Â Â Â Â let mediaRecorder = null;
Â Â Â Â let chunks = [];
Â Â Â Â let streamRef = null;

Â Â Â Â function resetButtons() {
Â Â Â Â Â Â startBtn.disabledÂ  = false;
Â Â Â Â Â Â stopBtn.disabled Â  = true;
Â Â Â Â Â Â cancelBtn.disabled = false;
Â Â Â Â }

Â Â Â Â function stopStream() {
Â Â Â Â Â Â if (streamRef) {
Â Â Â Â Â Â Â Â streamRef.getTracks().forEach(t => t.stop());
Â Â Â Â Â Â Â Â streamRef = null;
Â Â Â Â Â Â }
Â Â Â Â }

Â Â Â Â // é–‹å§‹éŒ„éŸ³
Â Â Â Â startBtn.disabledÂ  = false;
Â Â Â Â stopBtn.disabled Â  = true;
Â Â Â Â cancelBtn.disabled = false;
Â Â Â Â statusEl.textContent = "éŒ„éŸ³é å‚™";

Â Â Â Â startBtn.addEventListener("click", async () => {
Â Â Â Â Â Â try {
Â Â Â Â Â Â Â Â // åˆ‡åˆ°ã€ŒéŒ„éŸ³ã€æ¨¡å¼
Â Â Â Â Â Â Â Â if (typeof setMediaMode === "function") {
Â Â Â Â Â Â Â Â Â Â setMediaMode("audio");
Â Â Â Â Â Â Â Â }

Â Â Â Â Â Â Â Â // æ¸…æ‰åŸæœ¬é¸çš„éŸ³æª”èˆ‡éŒ„éŸ³
Â Â Â Â Â Â Â Â window.recordedAudioBlob = null;
Â Â Â Â Â Â Â Â if (audioFile) {
Â Â Â Â Â Â Â Â Â Â audioFile.value = "";
Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â if (audioLabel) {
Â Â Â Â Â Â Â Â Â Â audioLabel.textContent = "";
Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â previewEl.src = "";

Â Â Â Â Â Â Â Â const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
Â Â Â Â Â Â Â Â streamRef = stream;
Â Â Â Â Â Â Â Â chunks = [];
Â Â Â Â Â Â Â Â mediaRecorder = new MediaRecorder(stream);

Â Â Â Â Â Â Â Â mediaRecorder.ondataavailable = (e) => {
Â Â Â Â Â Â Â Â Â Â if (e.data && e.data.size > 0) {
Â Â Â Â Â Â Â Â Â Â Â Â chunks.push(e.data);
Â Â Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â };

Â Â Â Â Â Â Â Â mediaRecorder.onstop = () => {
Â Â Â Â Â Â Â Â Â Â // æŠŠéŒ„åˆ°çš„è³‡æ–™è®Šæˆ Blob
Â Â Â Â Â Â Â Â Â Â if (chunks.length) {
Â Â Â Â Â Â Â Â Â Â Â Â const blob = new Blob(chunks, { type: "audio/webm" });
Â Â Â Â Â Â Â Â Â Â Â Â window.recordedAudioBlob = blob;
Â Â Â Â Â Â Â Â Â Â Â Â const url = URL.createObjectURL(blob);
Â Â Â Â Â Â Â Â Â Â Â Â previewEl.src = url;
Â Â Â Â Â Â Â Â Â Â Â Â statusEl.textContent = "éŒ„éŸ³å®Œæˆï¼Œå¯æŒ‰æ’­æ”¾é è¦½ã€‚";
Â Â Â Â Â Â Â Â Â Â } else {
Â Â Â Â Â Â Â Â Â Â Â Â statusEl.textContent = "æ²’æœ‰éŒ„åˆ°è²éŸ³ï¼Œè«‹å†è©¦ä¸€æ¬¡ã€‚";
Â Â Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â Â Â stopStream();
Â Â Â Â Â Â Â Â Â Â resetButtons();
Â Â Â Â Â Â Â Â Â Â updateSubmitButtonState();
Â Â Â Â Â Â Â Â };

Â Â Â Â Â Â Â Â mediaRecorder.start();
Â Â Â Â Â Â Â Â startBtn.disabled = true;
Â Â Â Â Â Â Â Â stopBtn.disabled = false;
Â Â Â Â Â Â Â Â cancelBtn.disabled = false;
Â Â Â Â Â Â Â Â statusEl.textContent = "éŒ„éŸ³ä¸­â€¦ å†æŒ‰ â–  åœæ­¢ã€‚";

Â Â Â Â Â Â } catch (err) {
Â Â Â Â Â Â Â Â console.error(err);
Â Â Â Â Â Â Â Â statusEl.textContent = "ç„¡æ³•é–‹å§‹éŒ„éŸ³ï¼š" + err.message;
Â Â Â Â Â Â Â Â stopStream();
Â Â Â Â Â Â Â Â resetButtons();
Â Â Â Â Â Â }
Â Â Â Â });

Â Â Â Â // åœæ­¢éŒ„éŸ³ï¼ˆä¿ç•™çµæœï¼‰
Â Â Â Â stopBtn.addEventListener("click", () => {
Â Â Â Â Â Â if (mediaRecorder && mediaRecorder.state === "recording") {
Â Â Â Â Â Â Â Â mediaRecorder.stop();
Â Â Â Â Â Â Â Â statusEl.textContent = "è™•ç†éŒ„éŸ³ä¸­â€¦";
Â Â Â Â Â Â }
Â Â Â Â });

Â Â Â Â // å–æ¶ˆéŒ„éŸ³ï¼ˆä¸ä¿ç•™ï¼‰
Â Â Â Â cancelBtn.addEventListener("click", () => {
Â Â Â Â Â Â if (mediaRecorder && mediaRecorder.state === "recording") {
Â Â Â Â Â Â Â Â mediaRecorder.stop();
Â Â Â Â Â Â }
Â Â Â Â Â Â chunks = [];
Â Â Â Â Â Â window.recordedAudioBlob = null;
Â Â Â Â Â Â previewEl.src = "";
Â Â Â Â Â Â statusEl.textContent = "å·²å–æ¶ˆéŒ„éŸ³ã€‚";
Â Â Â Â Â Â stopStream();
Â Â Â Â Â Â resetButtons();
Â Â Â Â Â Â updateSubmitButtonState();
Â Â Â Â });
Â Â }
</script>

</body>
</html>
